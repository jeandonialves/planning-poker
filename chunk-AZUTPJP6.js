import{$ as Go,$a as Bn,A as At,B as V,C as I,D as ve,Da as Yo,F as Bo,G as St,H as oe,K as Tn,N as Zi,P as Tt,Pa as Ot,Q as Dn,Qa as Fn,R as Wo,Ra as Ee,S as er,T as Nn,V as L,W as tr,X as Dt,Xa as ca,Y as Ie,Ya as Vn,Za as Ln,_ as jo,_a as Un,a as Et,aa as Nt,b as In,ba as kn,c as No,ca as nr,d as wt,da as Ho,e as An,f as he,g as ye,h as ko,ha as kt,i as O,j as Ro,ja as $o,k as bt,l as Po,m as Mo,ma as Rt,n as xo,na as Ko,o as Fo,p as Qi,q as Oo,r as Xi,ra as qo,s as Vo,t as se,u as Ji,ua as zo,v as Lo,va as Pt,w as Uo,wa as Ae,x as Sn,xa as ir,y as It,z as Z}from"./chunk-FKFA34IM.js";import{$ as Ft,A as ta,B as Pn,C as R,D as na,E as ia,F as ee,G as Se,H as Mn,I as Mt,K as ra,M as sa,N as g,O as $,P,Q as sr,R as oa,S as xt,U as W,V as Ce,W as xn,X as or,Y as aa,Z as Qe,a as B,b as z,ba as la,c as ku,d as ue,fa as Xe,ga as On,i as f,j as Ye,k as Rn,l as Qo,m as Xo,n as M,o as Jo,q as rr,t as Zo,v as de,w as ea}from"./chunk-GKK2QUJP.js";var Ha=ku(()=>{"use strict"});var Wn=class n{setItem(e,t){localStorage.setItem(e,t)}getItem(e){return localStorage.getItem(e)}removeItem(e){localStorage.removeItem(e)}clear(){localStorage.clear()}static \u0275fac=function(t){return new(t||n)};static \u0275prov=Z({token:n,factory:n.\u0275fac,providedIn:"root"})};var Ze=class n{KEY_PLAYER="player";storageService=ve(Wn);register(e){this.storageService.setItem(this.KEY_PLAYER,JSON.stringify(e))}update(e){this.storageService.setItem(this.KEY_PLAYER,JSON.stringify(e))}get(){let e=this.storageService.getItem(this.KEY_PLAYER);return e?JSON.parse(e):null}static \u0275fac=function(t){return new(t||n)};static \u0275prov=Z({token:n,factory:n.\u0275fac,providedIn:"root"})};var ya=(()=>{class n{constructor(t,i){this._renderer=t,this._elementRef=i,this.onChange=r=>{},this.onTouched=()=>{}}setProperty(t,i){this._renderer.setProperty(this._elementRef.nativeElement,t,i)}registerOnTouched(t){this.onTouched=t}registerOnChange(t){this.onChange=t}setDisabledState(t){this.setProperty("disabled",t)}static{this.\u0275fac=function(i){return new(i||n)(L(tr),L(er))}}static{this.\u0275dir=oe({type:n})}}return n})(),Ru=(()=>{class n extends ya{static{this.\u0275fac=(()=>{let t;return function(r){return(t||(t=Zi(n)))(r||n)}})()}static{this.\u0275dir=oe({type:n,features:[Ie]})}}return n})(),va=new V("");var Pu={provide:va,useExisting:It(()=>Zn),multi:!0};function Mu(){let n=ir()?ir().getUserAgent():"";return/android (\d+)/.test(n.toLowerCase())}var xu=new V(""),Zn=(()=>{class n extends ya{constructor(t,i,r){super(t,i),this._compositionMode=r,this._composing=!1,this._compositionMode==null&&(this._compositionMode=!Mu())}writeValue(t){let i=t??"";this.setProperty("value",i)}_handleInput(t){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(t)}_compositionStart(){this._composing=!0}_compositionEnd(t){this._composing=!1,this._compositionMode&&this.onChange(t)}static{this.\u0275fac=function(i){return new(i||n)(L(tr),L(er),L(xu,8))}}static{this.\u0275dir=oe({type:n,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(i,r){i&1&&kt("input",function(o){return r._handleInput(o.target.value)})("blur",function(){return r.onTouched()})("compositionstart",function(){return r._compositionStart()})("compositionend",function(o){return r._compositionEnd(o.target.value)})},features:[Rt([Pu]),Ie]})}}return n})();function Te(n){return n==null||(typeof n=="string"||Array.isArray(n))&&n.length===0}function Ca(n){return n!=null&&typeof n.length=="number"}var dr=new V(""),Ea=new V(""),Fu=/^(?=.{1,254}$)(?=.{1,64}@)[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+)*@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/,Hn=class{static min(e){return Ou(e)}static max(e){return Vu(e)}static required(e){return wa(e)}static requiredTrue(e){return Lu(e)}static email(e){return Uu(e)}static minLength(e){return Bu(e)}static maxLength(e){return Wu(e)}static pattern(e){return ju(e)}static nullValidator(e){return $n(e)}static compose(e){return Da(e)}static composeAsync(e){return ka(e)}};function Ou(n){return e=>{if(Te(e.value)||Te(n))return null;let t=parseFloat(e.value);return!isNaN(t)&&t<n?{min:{min:n,actual:e.value}}:null}}function Vu(n){return e=>{if(Te(e.value)||Te(n))return null;let t=parseFloat(e.value);return!isNaN(t)&&t>n?{max:{max:n,actual:e.value}}:null}}function wa(n){return Te(n.value)?{required:!0}:null}function Lu(n){return n.value===!0?null:{required:!0}}function Uu(n){return Te(n.value)||Fu.test(n.value)?null:{email:!0}}function Bu(n){return e=>Te(e.value)||!Ca(e.value)?null:e.value.length<n?{minlength:{requiredLength:n,actualLength:e.value.length}}:null}function Wu(n){return e=>Ca(e.value)&&e.value.length>n?{maxlength:{requiredLength:n,actualLength:e.value.length}}:null}function ju(n){if(!n)return $n;let e,t;return typeof n=="string"?(t="",n.charAt(0)!=="^"&&(t+="^"),t+=n,n.charAt(n.length-1)!=="$"&&(t+="$"),e=new RegExp(t)):(t=n.toString(),e=n),i=>{if(Te(i.value))return null;let r=i.value;return e.test(r)?null:{pattern:{requiredPattern:t,actualValue:r}}}}function $n(n){return null}function ba(n){return n!=null}function Ia(n){return qo(n)?he(n):n}function Aa(n){let e={};return n.forEach(t=>{e=t!=null?B(B({},e),t):e}),Object.keys(e).length===0?null:e}function Sa(n,e){return e.map(t=>t(n))}function Gu(n){return!n.validate}function Ta(n){return n.map(e=>Gu(e)?e:t=>e.validate(t))}function Da(n){if(!n)return null;let e=n.filter(ba);return e.length==0?null:function(t){return Aa(Sa(t,e))}}function Na(n){return n!=null?Da(Ta(n)):null}function ka(n){if(!n)return null;let e=n.filter(ba);return e.length==0?null:function(t){let i=Sa(t,e).map(Ia);return Ro(i).pipe(O(Aa))}}function Ra(n){return n!=null?ka(Ta(n)):null}function ua(n,e){return n===null?[e]:Array.isArray(n)?[...n,e]:[n,e]}function Pa(n){return n._rawValidators}function Ma(n){return n._rawAsyncValidators}function ar(n){return n?Array.isArray(n)?n:[n]:[]}function Kn(n,e){return Array.isArray(n)?n.includes(e):n===e}function ha(n,e){let t=ar(e);return ar(n).forEach(r=>{Kn(t,r)||t.push(r)}),t}function da(n,e){return ar(e).filter(t=>!Kn(n,t))}var qn=class{constructor(){this._rawValidators=[],this._rawAsyncValidators=[],this._onDestroyCallbacks=[]}get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_setValidators(e){this._rawValidators=e||[],this._composedValidatorFn=Na(this._rawValidators)}_setAsyncValidators(e){this._rawAsyncValidators=e||[],this._composedAsyncValidatorFn=Ra(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_registerOnDestroy(e){this._onDestroyCallbacks.push(e)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(e=>e()),this._onDestroyCallbacks=[]}reset(e=void 0){this.control&&this.control.reset(e)}hasError(e,t){return this.control?this.control.hasError(e,t):!1}getError(e,t){return this.control?this.control.getError(e,t):null}},nt=class extends qn{get formDirective(){return null}get path(){return null}},Wt=class extends qn{constructor(){super(...arguments),this._parent=null,this.name=null,this.valueAccessor=null}},zn=class{constructor(e){this._cd=e}get isTouched(){return this._cd?.control?._touched?.(),!!this._cd?.control?.touched}get isUntouched(){return!!this._cd?.control?.untouched}get isPristine(){return this._cd?.control?._pristine?.(),!!this._cd?.control?.pristine}get isDirty(){return!!this._cd?.control?.dirty}get isValid(){return this._cd?.control?._status?.(),!!this._cd?.control?.valid}get isInvalid(){return!!this._cd?.control?.invalid}get isPending(){return!!this._cd?.control?.pending}get isSubmitted(){return this._cd?._submitted?.(),!!this._cd?.submitted}},Hu={"[class.ng-untouched]":"isUntouched","[class.ng-touched]":"isTouched","[class.ng-pristine]":"isPristine","[class.ng-dirty]":"isDirty","[class.ng-valid]":"isValid","[class.ng-invalid]":"isInvalid","[class.ng-pending]":"isPending"},E_=z(B({},Hu),{"[class.ng-submitted]":"isSubmitted"}),xa=(()=>{class n extends zn{constructor(t){super(t)}static{this.\u0275fac=function(i){return new(i||n)(L(Wt,2))}}static{this.\u0275dir=oe({type:n,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(i,r){i&2&&Nt("ng-untouched",r.isUntouched)("ng-touched",r.isTouched)("ng-pristine",r.isPristine)("ng-dirty",r.isDirty)("ng-valid",r.isValid)("ng-invalid",r.isInvalid)("ng-pending",r.isPending)},features:[Ie]})}}return n})(),Fa=(()=>{class n extends zn{constructor(t){super(t)}static{this.\u0275fac=function(i){return new(i||n)(L(nt,10))}}static{this.\u0275dir=oe({type:n,selectors:[["","formGroupName",""],["","formArrayName",""],["","ngModelGroup",""],["","formGroup",""],["form",3,"ngNoForm",""],["","ngForm",""]],hostVars:16,hostBindings:function(i,r){i&2&&Nt("ng-untouched",r.isUntouched)("ng-touched",r.isTouched)("ng-pristine",r.isPristine)("ng-dirty",r.isDirty)("ng-valid",r.isValid)("ng-invalid",r.isInvalid)("ng-pending",r.isPending)("ng-submitted",r.isSubmitted)},features:[Ie]})}}return n})();var Vt="VALID",jn="INVALID",et="PENDING",Lt="DISABLED",De=class{},Yn=class extends De{constructor(e,t){super(),this.value=e,this.source=t}},Ut=class extends De{constructor(e,t){super(),this.pristine=e,this.source=t}},Bt=class extends De{constructor(e,t){super(),this.touched=e,this.source=t}},tt=class extends De{constructor(e,t){super(),this.status=e,this.source=t}},lr=class extends De{constructor(e){super(),this.source=e}},cr=class extends De{constructor(e){super(),this.source=e}};function fr(n){return(ei(n)?n.validators:n)||null}function $u(n){return Array.isArray(n)?Na(n):n||null}function pr(n,e){return(ei(e)?e.asyncValidators:n)||null}function Ku(n){return Array.isArray(n)?Ra(n):n||null}function ei(n){return n!=null&&!Array.isArray(n)&&typeof n=="object"}function Oa(n,e,t){let i=n.controls;if(!(e?Object.keys(i):i).length)throw new Sn(1e3,"");if(!i[t])throw new Sn(1001,"")}function Va(n,e,t){n._forEachChild((i,r)=>{if(t[r]===void 0)throw new Sn(1002,"")})}var it=class{constructor(e,t){this._pendingDirty=!1,this._hasOwnPendingAsyncValidator=null,this._pendingTouched=!1,this._onCollectionChange=()=>{},this._parent=null,this._status=Pt(()=>this.statusReactive()),this.statusReactive=Dt(void 0),this._pristine=Pt(()=>this.pristineReactive()),this.pristineReactive=Dt(!0),this._touched=Pt(()=>this.touchedReactive()),this.touchedReactive=Dt(!1),this._events=new In,this.events=this._events.asObservable(),this._onDisabledChange=[],this._assignValidators(e),this._assignAsyncValidators(t)}get validator(){return this._composedValidatorFn}set validator(e){this._rawValidators=this._composedValidatorFn=e}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(e){this._rawAsyncValidators=this._composedAsyncValidatorFn=e}get parent(){return this._parent}get status(){return Ae(this.statusReactive)}set status(e){Ae(()=>this.statusReactive.set(e))}get valid(){return this.status===Vt}get invalid(){return this.status===jn}get pending(){return this.status==et}get disabled(){return this.status===Lt}get enabled(){return this.status!==Lt}get pristine(){return Ae(this.pristineReactive)}set pristine(e){Ae(()=>this.pristineReactive.set(e))}get dirty(){return!this.pristine}get touched(){return Ae(this.touchedReactive)}set touched(e){Ae(()=>this.touchedReactive.set(e))}get untouched(){return!this.touched}get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(e){this._assignValidators(e)}setAsyncValidators(e){this._assignAsyncValidators(e)}addValidators(e){this.setValidators(ha(e,this._rawValidators))}addAsyncValidators(e){this.setAsyncValidators(ha(e,this._rawAsyncValidators))}removeValidators(e){this.setValidators(da(e,this._rawValidators))}removeAsyncValidators(e){this.setAsyncValidators(da(e,this._rawAsyncValidators))}hasValidator(e){return Kn(this._rawValidators,e)}hasAsyncValidator(e){return Kn(this._rawAsyncValidators,e)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(e={}){let t=this.touched===!1;this.touched=!0;let i=e.sourceControl??this;this._parent&&!e.onlySelf&&this._parent.markAsTouched(z(B({},e),{sourceControl:i})),t&&e.emitEvent!==!1&&this._events.next(new Bt(!0,i))}markAllAsTouched(e={}){this.markAsTouched({onlySelf:!0,emitEvent:e.emitEvent,sourceControl:this}),this._forEachChild(t=>t.markAllAsTouched(e))}markAsUntouched(e={}){let t=this.touched===!0;this.touched=!1,this._pendingTouched=!1;let i=e.sourceControl??this;this._forEachChild(r=>{r.markAsUntouched({onlySelf:!0,emitEvent:e.emitEvent,sourceControl:i})}),this._parent&&!e.onlySelf&&this._parent._updateTouched(e,i),t&&e.emitEvent!==!1&&this._events.next(new Bt(!1,i))}markAsDirty(e={}){let t=this.pristine===!0;this.pristine=!1;let i=e.sourceControl??this;this._parent&&!e.onlySelf&&this._parent.markAsDirty(z(B({},e),{sourceControl:i})),t&&e.emitEvent!==!1&&this._events.next(new Ut(!1,i))}markAsPristine(e={}){let t=this.pristine===!1;this.pristine=!0,this._pendingDirty=!1;let i=e.sourceControl??this;this._forEachChild(r=>{r.markAsPristine({onlySelf:!0,emitEvent:e.emitEvent})}),this._parent&&!e.onlySelf&&this._parent._updatePristine(e,i),t&&e.emitEvent!==!1&&this._events.next(new Ut(!0,i))}markAsPending(e={}){this.status=et;let t=e.sourceControl??this;e.emitEvent!==!1&&(this._events.next(new tt(this.status,t)),this.statusChanges.emit(this.status)),this._parent&&!e.onlySelf&&this._parent.markAsPending(z(B({},e),{sourceControl:t}))}disable(e={}){let t=this._parentMarkedDirty(e.onlySelf);this.status=Lt,this.errors=null,this._forEachChild(r=>{r.disable(z(B({},e),{onlySelf:!0}))}),this._updateValue();let i=e.sourceControl??this;e.emitEvent!==!1&&(this._events.next(new Yn(this.value,i)),this._events.next(new tt(this.status,i)),this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors(z(B({},e),{skipPristineCheck:t}),this),this._onDisabledChange.forEach(r=>r(!0))}enable(e={}){let t=this._parentMarkedDirty(e.onlySelf);this.status=Vt,this._forEachChild(i=>{i.enable(z(B({},e),{onlySelf:!0}))}),this.updateValueAndValidity({onlySelf:!0,emitEvent:e.emitEvent}),this._updateAncestors(z(B({},e),{skipPristineCheck:t}),this),this._onDisabledChange.forEach(i=>i(!1))}_updateAncestors(e,t){this._parent&&!e.onlySelf&&(this._parent.updateValueAndValidity(e),e.skipPristineCheck||this._parent._updatePristine({},t),this._parent._updateTouched({},t))}setParent(e){this._parent=e}getRawValue(){return this.value}updateValueAndValidity(e={}){if(this._setInitialStatus(),this._updateValue(),this.enabled){let i=this._cancelExistingSubscription();this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===Vt||this.status===et)&&this._runAsyncValidator(i,e.emitEvent)}let t=e.sourceControl??this;e.emitEvent!==!1&&(this._events.next(new Yn(this.value,t)),this._events.next(new tt(this.status,t)),this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!e.onlySelf&&this._parent.updateValueAndValidity(z(B({},e),{sourceControl:t}))}_updateTreeValidity(e={emitEvent:!0}){this._forEachChild(t=>t._updateTreeValidity(e)),this.updateValueAndValidity({onlySelf:!0,emitEvent:e.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?Lt:Vt}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(e,t){if(this.asyncValidator){this.status=et,this._hasOwnPendingAsyncValidator={emitEvent:t!==!1};let i=Ia(this.asyncValidator(this));this._asyncValidationSubscription=i.subscribe(r=>{this._hasOwnPendingAsyncValidator=null,this.setErrors(r,{emitEvent:t,shouldHaveEmitted:e})})}}_cancelExistingSubscription(){if(this._asyncValidationSubscription){this._asyncValidationSubscription.unsubscribe();let e=this._hasOwnPendingAsyncValidator?.emitEvent??!1;return this._hasOwnPendingAsyncValidator=null,e}return!1}setErrors(e,t={}){this.errors=e,this._updateControlsErrors(t.emitEvent!==!1,this,t.shouldHaveEmitted)}get(e){let t=e;return t==null||(Array.isArray(t)||(t=t.split(".")),t.length===0)?null:t.reduce((i,r)=>i&&i._find(r),this)}getError(e,t){let i=t?this.get(t):this;return i&&i.errors?i.errors[e]:null}hasError(e,t){return!!this.getError(e,t)}get root(){let e=this;for(;e._parent;)e=e._parent;return e}_updateControlsErrors(e,t,i){this.status=this._calculateStatus(),e&&this.statusChanges.emit(this.status),(e||i)&&this._events.next(new tt(this.status,t)),this._parent&&this._parent._updateControlsErrors(e,t,i)}_initObservables(){this.valueChanges=new Tt,this.statusChanges=new Tt}_calculateStatus(){return this._allControlsDisabled()?Lt:this.errors?jn:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(et)?et:this._anyControlsHaveStatus(jn)?jn:Vt}_anyControlsHaveStatus(e){return this._anyControls(t=>t.status===e)}_anyControlsDirty(){return this._anyControls(e=>e.dirty)}_anyControlsTouched(){return this._anyControls(e=>e.touched)}_updatePristine(e,t){let i=!this._anyControlsDirty(),r=this.pristine!==i;this.pristine=i,this._parent&&!e.onlySelf&&this._parent._updatePristine(e,t),r&&this._events.next(new Ut(this.pristine,t))}_updateTouched(e={},t){this.touched=this._anyControlsTouched(),this._events.next(new Bt(this.touched,t)),this._parent&&!e.onlySelf&&this._parent._updateTouched(e,t)}_registerOnCollectionChange(e){this._onCollectionChange=e}_setUpdateStrategy(e){ei(e)&&e.updateOn!=null&&(this._updateOn=e.updateOn)}_parentMarkedDirty(e){let t=this._parent&&this._parent.dirty;return!e&&!!t&&!this._parent._anyControlsDirty()}_find(e){return null}_assignValidators(e){this._rawValidators=Array.isArray(e)?e.slice():e,this._composedValidatorFn=$u(this._rawValidators)}_assignAsyncValidators(e){this._rawAsyncValidators=Array.isArray(e)?e.slice():e,this._composedAsyncValidatorFn=Ku(this._rawAsyncValidators)}},Qn=class extends it{constructor(e,t,i){super(fr(t),pr(i,t)),this.controls=e,this._initObservables(),this._setUpdateStrategy(t),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}registerControl(e,t){return this.controls[e]?this.controls[e]:(this.controls[e]=t,t.setParent(this),t._registerOnCollectionChange(this._onCollectionChange),t)}addControl(e,t,i={}){this.registerControl(e,t),this.updateValueAndValidity({emitEvent:i.emitEvent}),this._onCollectionChange()}removeControl(e,t={}){this.controls[e]&&this.controls[e]._registerOnCollectionChange(()=>{}),delete this.controls[e],this.updateValueAndValidity({emitEvent:t.emitEvent}),this._onCollectionChange()}setControl(e,t,i={}){this.controls[e]&&this.controls[e]._registerOnCollectionChange(()=>{}),delete this.controls[e],t&&this.registerControl(e,t),this.updateValueAndValidity({emitEvent:i.emitEvent}),this._onCollectionChange()}contains(e){return this.controls.hasOwnProperty(e)&&this.controls[e].enabled}setValue(e,t={}){Va(this,!0,e),Object.keys(e).forEach(i=>{Oa(this,!0,i),this.controls[i].setValue(e[i],{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t)}patchValue(e,t={}){e!=null&&(Object.keys(e).forEach(i=>{let r=this.controls[i];r&&r.patchValue(e[i],{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t))}reset(e={},t={}){this._forEachChild((i,r)=>{i.reset(e?e[r]:null,{onlySelf:!0,emitEvent:t.emitEvent})}),this._updatePristine(t,this),this._updateTouched(t,this),this.updateValueAndValidity(t)}getRawValue(){return this._reduceChildren({},(e,t,i)=>(e[i]=t.getRawValue(),e))}_syncPendingControls(){let e=this._reduceChildren(!1,(t,i)=>i._syncPendingControls()?!0:t);return e&&this.updateValueAndValidity({onlySelf:!0}),e}_forEachChild(e){Object.keys(this.controls).forEach(t=>{let i=this.controls[t];i&&e(i,t)})}_setUpControls(){this._forEachChild(e=>{e.setParent(this),e._registerOnCollectionChange(this._onCollectionChange)})}_updateValue(){this.value=this._reduceValue()}_anyControls(e){for(let[t,i]of Object.entries(this.controls))if(this.contains(t)&&e(i))return!0;return!1}_reduceValue(){let e={};return this._reduceChildren(e,(t,i,r)=>((i.enabled||this.disabled)&&(t[r]=i.value),t))}_reduceChildren(e,t){let i=e;return this._forEachChild((r,s)=>{i=t(i,r,s)}),i}_allControlsDisabled(){for(let e of Object.keys(this.controls))if(this.controls[e].enabled)return!1;return Object.keys(this.controls).length>0||this.disabled}_find(e){return this.controls.hasOwnProperty(e)?this.controls[e]:null}};var ur=class extends Qn{};var La=new V("CallSetDisabledState",{providedIn:"root",factory:()=>_r}),_r="always";function qu(n,e){return[...e.path,n]}function fa(n,e,t=_r){gr(n,e),e.valueAccessor.writeValue(n.value),(n.disabled||t==="always")&&e.valueAccessor.setDisabledState?.(n.disabled),Yu(n,e),Xu(n,e),Qu(n,e),zu(n,e)}function pa(n,e,t=!0){let i=()=>{};e.valueAccessor&&(e.valueAccessor.registerOnChange(i),e.valueAccessor.registerOnTouched(i)),Jn(n,e),n&&(e._invokeOnDestroyCallbacks(),n._registerOnCollectionChange(()=>{}))}function Xn(n,e){n.forEach(t=>{t.registerOnValidatorChange&&t.registerOnValidatorChange(e)})}function zu(n,e){if(e.valueAccessor.setDisabledState){let t=i=>{e.valueAccessor.setDisabledState(i)};n.registerOnDisabledChange(t),e._registerOnDestroy(()=>{n._unregisterOnDisabledChange(t)})}}function gr(n,e){let t=Pa(n);e.validator!==null?n.setValidators(ua(t,e.validator)):typeof t=="function"&&n.setValidators([t]);let i=Ma(n);e.asyncValidator!==null?n.setAsyncValidators(ua(i,e.asyncValidator)):typeof i=="function"&&n.setAsyncValidators([i]);let r=()=>n.updateValueAndValidity();Xn(e._rawValidators,r),Xn(e._rawAsyncValidators,r)}function Jn(n,e){let t=!1;if(n!==null){if(e.validator!==null){let r=Pa(n);if(Array.isArray(r)&&r.length>0){let s=r.filter(o=>o!==e.validator);s.length!==r.length&&(t=!0,n.setValidators(s))}}if(e.asyncValidator!==null){let r=Ma(n);if(Array.isArray(r)&&r.length>0){let s=r.filter(o=>o!==e.asyncValidator);s.length!==r.length&&(t=!0,n.setAsyncValidators(s))}}}let i=()=>{};return Xn(e._rawValidators,i),Xn(e._rawAsyncValidators,i),t}function Yu(n,e){e.valueAccessor.registerOnChange(t=>{n._pendingValue=t,n._pendingChange=!0,n._pendingDirty=!0,n.updateOn==="change"&&Ua(n,e)})}function Qu(n,e){e.valueAccessor.registerOnTouched(()=>{n._pendingTouched=!0,n.updateOn==="blur"&&n._pendingChange&&Ua(n,e),n.updateOn!=="submit"&&n.markAsTouched()})}function Ua(n,e){n._pendingDirty&&n.markAsDirty(),n.setValue(n._pendingValue,{emitModelToViewChange:!1}),e.viewToModelUpdate(n._pendingValue),n._pendingChange=!1}function Xu(n,e){let t=(i,r)=>{e.valueAccessor.writeValue(i),r&&e.viewToModelUpdate(i)};n.registerOnChange(t),e._registerOnDestroy(()=>{n._unregisterOnChange(t)})}function Ju(n,e){n==null,gr(n,e)}function Zu(n,e){return Jn(n,e)}function eh(n,e){if(!n.hasOwnProperty("model"))return!1;let t=n.model;return t.isFirstChange()?!0:!Object.is(e,t.currentValue)}function th(n){return Object.getPrototypeOf(n.constructor)===Ru}function nh(n,e){n._syncPendingControls(),e.forEach(t=>{let i=t.control;i.updateOn==="submit"&&i._pendingChange&&(t.viewToModelUpdate(i._pendingValue),i._pendingChange=!1)})}function ih(n,e){if(!e)return null;Array.isArray(e);let t,i,r;return e.forEach(s=>{s.constructor===Zn?t=s:th(s)?i=s:r=s}),r||i||t||null}function rh(n,e){let t=n.indexOf(e);t>-1&&n.splice(t,1)}function _a(n,e){let t=n.indexOf(e);t>-1&&n.splice(t,1)}function ga(n){return typeof n=="object"&&n!==null&&Object.keys(n).length===2&&"value"in n&&"disabled"in n}var Gn=class extends it{constructor(e=null,t,i){super(fr(t),pr(i,t)),this.defaultValue=null,this._onChange=[],this._pendingChange=!1,this._applyFormState(e),this._setUpdateStrategy(t),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),ei(t)&&(t.nonNullable||t.initialValueIsDefault)&&(ga(e)?this.defaultValue=e.value:this.defaultValue=e)}setValue(e,t={}){this.value=this._pendingValue=e,this._onChange.length&&t.emitModelToViewChange!==!1&&this._onChange.forEach(i=>i(this.value,t.emitViewToModelChange!==!1)),this.updateValueAndValidity(t)}patchValue(e,t={}){this.setValue(e,t)}reset(e=this.defaultValue,t={}){this._applyFormState(e),this.markAsPristine(t),this.markAsUntouched(t),this.setValue(this.value,t),this._pendingChange=!1}_updateValue(){}_anyControls(e){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(e){this._onChange.push(e)}_unregisterOnChange(e){_a(this._onChange,e)}registerOnDisabledChange(e){this._onDisabledChange.push(e)}_unregisterOnDisabledChange(e){_a(this._onDisabledChange,e)}_forEachChild(e){}_syncPendingControls(){return this.updateOn==="submit"&&(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),this._pendingChange)?(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),!0):!1}_applyFormState(e){ga(e)?(this.value=this._pendingValue=e.value,e.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=e}};var sh=n=>n instanceof Gn;var Ba=(()=>{class n{static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275dir=oe({type:n,selectors:[["form",3,"ngNoForm","",3,"ngNativeValidate",""]],hostAttrs:["novalidate",""]})}}return n})();var Wa=new V("");var oh={provide:nt,useExisting:It(()=>mr)},mr=(()=>{class n extends nt{get submitted(){return Ae(this._submittedReactive)}set submitted(t){this._submittedReactive.set(t)}constructor(t,i,r){super(),this.callSetDisabledState=r,this._submitted=Pt(()=>this._submittedReactive()),this._submittedReactive=Dt(!1),this._onCollectionChange=()=>this._updateDomValue(),this.directives=[],this.form=null,this.ngSubmit=new Tt,this._setValidators(t),this._setAsyncValidators(i)}ngOnChanges(t){this._checkFormPresent(),t.hasOwnProperty("form")&&(this._updateValidators(),this._updateDomValue(),this._updateRegistrations(),this._oldForm=this.form)}ngOnDestroy(){this.form&&(Jn(this.form,this),this.form._onCollectionChange===this._onCollectionChange&&this.form._registerOnCollectionChange(()=>{}))}get formDirective(){return this}get control(){return this.form}get path(){return[]}addControl(t){let i=this.form.get(t.path);return fa(i,t,this.callSetDisabledState),i.updateValueAndValidity({emitEvent:!1}),this.directives.push(t),i}getControl(t){return this.form.get(t.path)}removeControl(t){pa(t.control||null,t,!1),rh(this.directives,t)}addFormGroup(t){this._setUpFormContainer(t)}removeFormGroup(t){this._cleanUpFormContainer(t)}getFormGroup(t){return this.form.get(t.path)}addFormArray(t){this._setUpFormContainer(t)}removeFormArray(t){this._cleanUpFormContainer(t)}getFormArray(t){return this.form.get(t.path)}updateModel(t,i){this.form.get(t.path).setValue(i)}onSubmit(t){return this._submittedReactive.set(!0),nh(this.form,this.directives),this.ngSubmit.emit(t),this.form._events.next(new lr(this.control)),t?.target?.method==="dialog"}onReset(){this.resetForm()}resetForm(t=void 0){this.form.reset(t),this._submittedReactive.set(!1),this.form._events.next(new cr(this.form))}_updateDomValue(){this.directives.forEach(t=>{let i=t.control,r=this.form.get(t.path);i!==r&&(pa(i||null,t),sh(r)&&(fa(r,t,this.callSetDisabledState),t.control=r))}),this.form._updateTreeValidity({emitEvent:!1})}_setUpFormContainer(t){let i=this.form.get(t.path);Ju(i,t),i.updateValueAndValidity({emitEvent:!1})}_cleanUpFormContainer(t){if(this.form){let i=this.form.get(t.path);i&&Zu(i,t)&&i.updateValueAndValidity({emitEvent:!1})}}_updateRegistrations(){this.form._registerOnCollectionChange(this._onCollectionChange),this._oldForm&&this._oldForm._registerOnCollectionChange(()=>{})}_updateValidators(){gr(this.form,this),this._oldForm&&Jn(this._oldForm,this)}_checkFormPresent(){this.form}static{this.\u0275fac=function(i){return new(i||n)(L(dr,10),L(Ea,10),L(La,8))}}static{this.\u0275dir=oe({type:n,selectors:[["","formGroup",""]],hostBindings:function(i,r){i&1&&kt("submit",function(o){return r.onSubmit(o)})("reset",function(){return r.onReset()})},inputs:{form:[0,"formGroup","form"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],features:[Rt([oh]),Ie,Tn]})}}return n})();var ah={provide:Wt,useExisting:It(()=>yr)},yr=(()=>{class n extends Wt{set isDisabled(t){}static{this._ngModelWarningSentOnce=!1}constructor(t,i,r,s,o){super(),this._ngModelWarningConfig=o,this._added=!1,this.name=null,this.update=new Tt,this._ngModelWarningSent=!1,this._parent=t,this._setValidators(i),this._setAsyncValidators(r),this.valueAccessor=ih(this,s)}ngOnChanges(t){this._added||this._setUpControl(),eh(t,this.viewModel)&&(this.viewModel=this.model,this.formDirective.updateModel(this,this.model))}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}viewToModelUpdate(t){this.viewModel=t,this.update.emit(t)}get path(){return qu(this.name==null?this.name:this.name.toString(),this._parent)}get formDirective(){return this._parent?this._parent.formDirective:null}_checkParentType(){}_setUpControl(){this._checkParentType(),this.control=this.formDirective.addControl(this),this._added=!0}static{this.\u0275fac=function(i){return new(i||n)(L(nt,13),L(dr,10),L(Ea,10),L(va,10),L(Wa,8))}}static{this.\u0275dir=oe({type:n,selectors:[["","formControlName",""]],inputs:{name:[0,"formControlName","name"],isDisabled:[0,"disabled","isDisabled"],model:[0,"ngModel","model"]},outputs:{update:"ngModelChange"},features:[Rt([ah]),Ie,Tn]})}}return n})();var lh=(()=>{class n{constructor(){this._validator=$n}ngOnChanges(t){if(this.inputName in t){let i=this.normalizeInput(t[this.inputName].currentValue);this._enabled=this.enabled(i),this._validator=this._enabled?this.createValidator(i):$n,this._onChange&&this._onChange()}}validate(t){return this._validator(t)}registerOnValidatorChange(t){this._onChange=t}enabled(t){return t!=null}static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275dir=oe({type:n,features:[Tn]})}}return n})();var ch={provide:dr,useExisting:It(()=>vr),multi:!0};var vr=(()=>{class n extends lh{constructor(){super(...arguments),this.inputName="required",this.normalizeInput=zo,this.createValidator=t=>wa}enabled(t){return t}static{this.\u0275fac=(()=>{let t;return function(r){return(t||(t=Zi(n)))(r||n)}})()}static{this.\u0275dir=oe({type:n,selectors:[["","required","","formControlName","",3,"type","checkbox"],["","required","","formControl","",3,"type","checkbox"],["","required","","ngModel","",3,"type","checkbox"]],hostVars:1,hostBindings:function(i,r){i&2&&jo("required",r._enabled?"":null)},inputs:{required:"required"},features:[Rt([ch]),Ie]})}}return n})();var uh=(()=>{class n{static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275mod=St({type:n})}static{this.\u0275inj=At({})}}return n})(),hr=class extends it{constructor(e,t,i){super(fr(t),pr(i,t)),this.controls=e,this._initObservables(),this._setUpdateStrategy(t),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}at(e){return this.controls[this._adjustIndex(e)]}push(e,t={}){this.controls.push(e),this._registerControl(e),this.updateValueAndValidity({emitEvent:t.emitEvent}),this._onCollectionChange()}insert(e,t,i={}){this.controls.splice(e,0,t),this._registerControl(t),this.updateValueAndValidity({emitEvent:i.emitEvent})}removeAt(e,t={}){let i=this._adjustIndex(e);i<0&&(i=0),this.controls[i]&&this.controls[i]._registerOnCollectionChange(()=>{}),this.controls.splice(i,1),this.updateValueAndValidity({emitEvent:t.emitEvent})}setControl(e,t,i={}){let r=this._adjustIndex(e);r<0&&(r=0),this.controls[r]&&this.controls[r]._registerOnCollectionChange(()=>{}),this.controls.splice(r,1),t&&(this.controls.splice(r,0,t),this._registerControl(t)),this.updateValueAndValidity({emitEvent:i.emitEvent}),this._onCollectionChange()}get length(){return this.controls.length}setValue(e,t={}){Va(this,!1,e),e.forEach((i,r)=>{Oa(this,!1,r),this.at(r).setValue(i,{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t)}patchValue(e,t={}){e!=null&&(e.forEach((i,r)=>{this.at(r)&&this.at(r).patchValue(i,{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t))}reset(e=[],t={}){this._forEachChild((i,r)=>{i.reset(e[r],{onlySelf:!0,emitEvent:t.emitEvent})}),this._updatePristine(t,this),this._updateTouched(t,this),this.updateValueAndValidity(t)}getRawValue(){return this.controls.map(e=>e.getRawValue())}clear(e={}){this.controls.length<1||(this._forEachChild(t=>t._registerOnCollectionChange(()=>{})),this.controls.splice(0),this.updateValueAndValidity({emitEvent:e.emitEvent}))}_adjustIndex(e){return e<0?e+this.length:e}_syncPendingControls(){let e=this.controls.reduce((t,i)=>i._syncPendingControls()?!0:t,!1);return e&&this.updateValueAndValidity({onlySelf:!0}),e}_forEachChild(e){this.controls.forEach((t,i)=>{e(t,i)})}_updateValue(){this.value=this.controls.filter(e=>e.enabled||this.disabled).map(e=>e.value)}_anyControls(e){return this.controls.some(t=>t.enabled&&e(t))}_setUpControls(){this._forEachChild(e=>this._registerControl(e))}_allControlsDisabled(){for(let e of this.controls)if(e.enabled)return!1;return this.controls.length>0||this.disabled}_registerControl(e){e.setParent(this),e._registerOnCollectionChange(this._onCollectionChange)}_find(e){return this.at(e)??null}};function ma(n){return!!n&&(n.asyncValidators!==void 0||n.validators!==void 0||n.updateOn!==void 0)}var ja=(()=>{class n{constructor(){this.useNonNullable=!1}get nonNullable(){let t=new n;return t.useNonNullable=!0,t}group(t,i=null){let r=this._reduceControls(t),s={};return ma(i)?s=i:i!==null&&(s.validators=i.validator,s.asyncValidators=i.asyncValidator),new Qn(r,s)}record(t,i=null){let r=this._reduceControls(t);return new ur(r,i)}control(t,i,r){let s={};return this.useNonNullable?(ma(i)?s=i:(s.validators=i,s.asyncValidators=r),new Gn(t,z(B({},s),{nonNullable:!0}))):new Gn(t,i,r)}array(t,i,r){let s=t.map(o=>this._createControl(o));return new hr(s,i,r)}_reduceControls(t){let i={};return Object.keys(t).forEach(r=>{i[r]=this._createControl(t[r])}),i}_createControl(t){if(t instanceof Gn)return t;if(t instanceof it)return t;if(Array.isArray(t)){let i=t[0],r=t.length>1?t[1]:null,s=t.length>2?t[2]:null;return this.control(i,r,s)}else return this.control(t)}static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275prov=Z({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();var Ga=(()=>{class n{static withConfig(t){return{ngModule:n,providers:[{provide:Wa,useValue:t.warnOnNgModelWithFormControl??"always"},{provide:La,useValue:t.callSetDisabledState??_r}]}}static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275mod=St({type:n})}static{this.\u0275inj=At({imports:[uh]})}}return n})();function ti(n){var e=new Error(n);return e.source="ulid",e}var Cr="0123456789ABCDEFGHJKMNPQRSTVWXYZ",jt=Cr.length,$a=Math.pow(2,48)-1,dh=10,fh=16;function ph(n){var e=Math.floor(n()*jt);return e===jt&&(e=jt-1),Cr.charAt(e)}function _h(n,e){if(isNaN(n))throw new Error(n+" must be a number");if(n>$a)throw ti("cannot encode time greater than "+$a);if(n<0)throw ti("time must be positive");if(Number.isInteger(n)===!1)throw ti("time must be an integer");for(var t=void 0,i="";e>0;e--)t=n%jt,i=Cr.charAt(t)+i,n=(n-t)/jt;return i}function gh(n,e){for(var t="";n>0;n--)t=ph(e)+t;return t}function mh(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,e=arguments[1];e||(e=typeof window<"u"?window:null);var t=e&&(e.crypto||e.msCrypto);if(t)return function(){var r=new Uint8Array(1);return t.getRandomValues(r),r[0]/255};try{var i=Ha();return function(){return i.randomBytes(1).readUInt8()/255}}catch{}if(n){try{console.error("secure crypto unusable, falling back to insecure Math.random()!")}catch{}return function(){return Math.random()}}throw ti("secure crypto unusable, insecure Math.random not allowed")}function yh(n){return n||(n=mh()),function(t){return isNaN(t)&&(t=Date.now()),_h(t,dh)+gh(fh,n)}}var ni=yh();var Ka=class n{submit$=Wo();userForm;fb=ve(ja);playerService=ve(Ze);constructor(){this.userForm=this.fb.group({name:["",Hn.required]})}submitHandler(e){if(e.invalid)return;let t={id:ni(),name:e.controls.name.value,roomId:""};this.playerService.register(t),this.submit$.emit()}static \u0275fac=function(t){return new(t||n)};static \u0275cmp=Bo({type:n,selectors:[["app-user-form"]],outputs:{submit$:"submit$"},standalone:!0,features:[Ko],decls:5,vars:3,consts:[[3,"ngSubmit","formGroup"],[1,"form-field"],["formControlName","name","placeholder","Digite o seu nome","required","",1,"form-control"],["type","submit",1,"btn","btn-primary"]],template:function(t,i){t&1&&(kn(0,"form",0),kt("ngSubmit",function(){return i.submitHandler(i.userForm)}),kn(1,"div",1),Ho(2,"input",2),nr(),kn(3,"button",3),$o(4,"Iniciar o jogo"),nr()()),t&2&&(Nt("was-validated",i.userForm.touched),Go("formGroup",i.userForm))},dependencies:[Ga,Ba,Zn,xa,Fa,vr,mr,yr],styles:["form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:24px}"]})};var Eh=new Map,wh={activated:!1,tokenObservers:[]},bh={initialized:!1,enabled:!1};function ae(n){return Eh.get(n)||Object.assign({},wh)}function Xa(){return bh}var Ih="https://content-firebaseappcheck.googleapis.com/v1";var Ah="exchangeDebugToken",qa={OFFSET_DURATION:5*60*1e3,RETRIAL_MIN_WAIT:30*1e3,RETRIAL_MAX_WAIT:16*60*1e3},G_=24*60*60*1e3;var wr=class{constructor(e,t,i,r,s){if(this.operation=e,this.retryPolicy=t,this.getWaitDuration=i,this.lowerBound=r,this.upperBound=s,this.pending=null,this.nextErrorWaitInterval=r,r>s)throw new Error("Proactive refresh lower bound greater than upper bound!")}start(){this.nextErrorWaitInterval=this.lowerBound,this.process(!0).catch(()=>{})}stop(){this.pending&&(this.pending.reject("cancelled"),this.pending=null)}isRunning(){return!!this.pending}process(e){return ue(this,null,function*(){this.stop();try{this.pending=new M,this.pending.promise.catch(t=>{}),yield Sh(this.getNextRun(e)),this.pending.resolve(),yield this.pending.promise,this.pending=new M,this.pending.promise.catch(t=>{}),yield this.operation(),this.pending.resolve(),yield this.pending.promise,this.process(!0).catch(()=>{})}catch(t){this.retryPolicy(t)?this.process(!1).catch(()=>{}):this.stop()}})}getNextRun(e){if(e)return this.nextErrorWaitInterval=this.lowerBound,this.getWaitDuration();{let t=this.nextErrorWaitInterval;return this.nextErrorWaitInterval*=2,this.nextErrorWaitInterval>this.upperBound&&(this.nextErrorWaitInterval=this.upperBound),t}}};function Sh(n){return new Promise(e=>{setTimeout(e,n)})}var Th={"already-initialized":"You have already called initializeAppCheck() for FirebaseApp {$appName} with different options. To avoid this error, call initializeAppCheck() with the same options as when it was originally called. This will return the already initialized instance.","use-before-activation":"App Check is being used before initializeAppCheck() is called for FirebaseApp {$appName}. Call initializeAppCheck() before instantiating other Firebase services.","fetch-network-error":"Fetch failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.","fetch-parse-error":"Fetch client could not parse response. Original error: {$originalErrorMessage}.","fetch-status-error":"Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.","storage-open":"Error thrown when opening storage. Original error: {$originalErrorMessage}.","storage-get":"Error thrown when reading from storage. Original error: {$originalErrorMessage}.","storage-set":"Error thrown when writing to storage. Original error: {$originalErrorMessage}.","recaptcha-error":"ReCAPTCHA error.",throttled:"Requests throttled due to {$httpStatus} error. Attempts allowed again after {$time}"},Ne=new ta("appCheck","AppCheck",Th);function Ja(n){if(!ae(n).activated)throw Ne.create("use-before-activation",{appName:n.name})}function Za(i,r){return ue(this,arguments,function*({url:n,body:e},t){let s={"Content-Type":"application/json"},o=t.getImmediate({optional:!0});if(o){let p=yield o.getHeartbeatsHeader();p&&(s["X-Firebase-Client"]=p)}let a={method:"POST",body:JSON.stringify(e),headers:s},l;try{l=yield fetch(n,a)}catch(p){throw Ne.create("fetch-network-error",{originalErrorMessage:p?.message})}if(l.status!==200)throw Ne.create("fetch-status-error",{httpStatus:l.status});let c;try{c=yield l.json()}catch(p){throw Ne.create("fetch-parse-error",{originalErrorMessage:p?.message})}let u=c.ttl.match(/^([\d.]+)(s)$/);if(!u||!u[2]||isNaN(Number(u[1])))throw Ne.create("fetch-parse-error",{originalErrorMessage:`ttl field (timeToLive) is not in standard Protobuf Duration format: ${c.ttl}`});let h=Number(u[1])*1e3,d=Date.now();return{token:c.token,expireTimeMillis:d+h,issuedAtTimeMillis:d}})}function el(n,e){let{projectId:t,appId:i,apiKey:r}=n.options;return{url:`${Ih}/projects/${t}/apps/${i}:${Ah}?key=${r}`,body:{debug_token:e}}}var Dh="firebase-app-check-database",Nh=1,br="firebase-app-check-store";var ii=null;function kh(){return ii||(ii=new Promise((n,e)=>{try{let t=indexedDB.open(Dh,Nh);t.onsuccess=i=>{n(i.target.result)},t.onerror=i=>{var r;e(Ne.create("storage-open",{originalErrorMessage:(r=i.target.error)===null||r===void 0?void 0:r.message}))},t.onupgradeneeded=i=>{let r=i.target.result;switch(i.oldVersion){case 0:r.createObjectStore(br,{keyPath:"compositeKey"})}}}catch(t){e(Ne.create("storage-open",{originalErrorMessage:t?.message}))}}),ii)}function Rh(n,e){return Ph(Mh(n),e)}function Ph(n,e){return ue(this,null,function*(){let i=(yield kh()).transaction(br,"readwrite"),s=i.objectStore(br).put({compositeKey:n,value:e});return new Promise((o,a)=>{s.onsuccess=l=>{o()},i.onerror=l=>{var c;a(Ne.create("storage-set",{originalErrorMessage:(c=l.target.error)===null||c===void 0?void 0:c.message}))}})})}function Mh(n){return`${n.options.appId}-${n.name}`}var Ir=new Qe("@firebase/app-check");function Er(n,e){return ea()?Rh(n,e).catch(t=>{Ir.warn(`Failed to write token to IndexedDB. Error: ${t}`)}):Promise.resolve()}function tl(){return Xa().enabled}function nl(){return ue(this,null,function*(){let n=Xa();if(n.enabled&&n.token)return n.token.promise;throw Error(`
            Can't get debug token in production mode.
        `)})}var xh={error:"UNKNOWN_ERROR"};function Fh(n){return Rn.encodeString(JSON.stringify(n),!1)}function Ar(n,e=!1){return ue(this,null,function*(){let t=n.app;Ja(t);let i=ae(t),r=i.token,s;if(r&&!Gt(r)&&(i.token=void 0,r=void 0),!r){let l=yield i.cachedTokenPromise;l&&(Gt(l)?r=l:yield Er(t,void 0))}if(!e&&r&&Gt(r))return{token:r.token};let o=!1;if(tl()){i.exchangeTokenPromise||(i.exchangeTokenPromise=Za(el(t,yield nl()),n.heartbeatServiceProvider).finally(()=>{i.exchangeTokenPromise=void 0}),o=!0);let l=yield i.exchangeTokenPromise;return yield Er(t,l),i.token=l,{token:l.token}}try{i.exchangeTokenPromise||(i.exchangeTokenPromise=i.provider.getToken().finally(()=>{i.exchangeTokenPromise=void 0}),o=!0),r=yield ae(t).exchangeTokenPromise}catch(l){l.code==="appCheck/throttled"?Ir.warn(l.message):Ir.error(l),s=l}let a;return r?s?Gt(r)?a={token:r.token,internalError:s}:a=Ya(s):(a={token:r.token},i.token=r,yield Er(t,r)):a=Ya(s),o&&Uh(t,a),a})}function Oh(n){return ue(this,null,function*(){let e=n.app;Ja(e);let{provider:t}=ae(e);if(tl()){let i=yield nl(),{token:r}=yield Za(el(e,i),n.heartbeatServiceProvider);return{token:r}}else{let{token:i}=yield t.getToken();return{token:i}}})}function Vh(n,e,t,i){let{app:r}=n,s=ae(r),o={next:t,error:i,type:e};if(s.tokenObservers=[...s.tokenObservers,o],s.token&&Gt(s.token)){let a=s.token;Promise.resolve().then(()=>{t({token:a.token}),za(n)}).catch(()=>{})}s.cachedTokenPromise.then(()=>za(n))}function il(n,e){let t=ae(n),i=t.tokenObservers.filter(r=>r.next!==e);i.length===0&&t.tokenRefresher&&t.tokenRefresher.isRunning()&&t.tokenRefresher.stop(),t.tokenObservers=i}function za(n){let{app:e}=n,t=ae(e),i=t.tokenRefresher;i||(i=Lh(n),t.tokenRefresher=i),!i.isRunning()&&t.isTokenAutoRefreshEnabled&&i.start()}function Lh(n){let{app:e}=n;return new wr(()=>ue(this,null,function*(){let t=ae(e),i;if(t.token?i=yield Ar(n,!0):i=yield Ar(n),i.error)throw i.error;if(i.internalError)throw i.internalError}),()=>!0,()=>{let t=ae(e);if(t.token){let i=t.token.issuedAtTimeMillis+(t.token.expireTimeMillis-t.token.issuedAtTimeMillis)*.5+3e5,r=t.token.expireTimeMillis-5*60*1e3;return i=Math.min(i,r),Math.max(0,i-Date.now())}else return 0},qa.RETRIAL_MIN_WAIT,qa.RETRIAL_MAX_WAIT)}function Uh(n,e){let t=ae(n).tokenObservers;for(let i of t)try{i.type==="EXTERNAL"&&e.error!=null?i.error(e.error):i.next(e)}catch{}}function Gt(n){return n.expireTimeMillis-Date.now()>0}function Ya(n){return{token:Fh(xh),error:n}}var Sr=class{constructor(e,t){this.app=e,this.heartbeatServiceProvider=t}_delete(){let{tokenObservers:e}=ae(this.app);for(let t of e)il(this.app,t.next);return Promise.resolve()}};function Bh(n,e){return new Sr(n,e)}function Wh(n){return{getToken:e=>Ar(n,e),getLimitedUseToken:()=>Oh(n),addTokenListener:e=>Vh(n,"INTERNAL",e),removeTokenListener:e=>il(n.app,e)}}var jh="@firebase/app-check",Gh="0.8.8";var Hh="app-check",Qa="app-check-internal";function $h(){Ft(new Ce(Hh,n=>{let e=n.getProvider("app").getImmediate(),t=n.getProvider("heartbeat");return Bh(e,t)},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((n,e,t)=>{n.getProvider(Qa).initialize()})),Ft(new Ce(Qa,n=>{let e=n.getProvider("app-check").getImmediate();return Wh(e)},"PUBLIC").setInstantiationMode("EXPLICIT")),Xe(jh,Gh)}$h();var Kh=["localhost","0.0.0.0","127.0.0.1"],tg=typeof window<"u"&&Kh.includes(window.location.hostname);var Tr=new V("angularfire2.auth.use-emulator"),Dr=new V("angularfire2.auth.settings"),Nr=new V("angularfire2.auth.tenant-id"),kr=new V("angularfire2.auth.langugage-code"),Rr=new V("angularfire2.auth.use-device-language"),Pr=new V("angularfire.auth.persistence"),Mr=(n,e,t,i,r,s,o,a)=>Bn(`${n.name}.auth`,"AngularFireAuth",n.name,()=>{let l=e.runOutsideAngular(()=>n.auth());if(t&&l.useEmulator(...t),i&&(l.tenantId=i),l.languageCode=r,s&&l.useDeviceLanguage(),o)for(let[c,u]of Object.entries(o))l.settings[c]=u;return a&&l.setPersistence(a),l},[t,i,r,s,o,a]),sl=(()=>{class n{authState;idToken;user;idTokenResult;credential;constructor(t,i,r,s,o,a,l,c,u,h,d,p){let _=new In,E=ye(void 0).pipe(wt(o.outsideAngular),se(()=>s.runOutsideAngular(()=>import("./chunk-ZNMJVPXJ.js"))),O(()=>Un(t,s,i)),O(A=>Mr(A,s,a,c,u,h,l,d)),Xi({bufferSize:1,refCount:!1}));if(Yo(r))this.authState=this.user=this.idToken=this.idTokenResult=this.credential=ye(null);else{E.pipe(Fo()).subscribe();let A=E.pipe(se(D=>D.getRedirectResult().then(re=>re,()=>null)),Ee,Xi({bufferSize:1,refCount:!1})),K=E.pipe(se(D=>new Et(re=>({unsubscribe:s.runOutsideAngular(()=>D.onAuthStateChanged(Ue=>re.next(Ue),Ue=>re.error(Ue),()=>re.complete()))})))),q=E.pipe(se(D=>new Et(re=>({unsubscribe:s.runOutsideAngular(()=>D.onIdTokenChanged(Ue=>re.next(Ue),Ue=>re.error(Ue),()=>re.complete()))}))));this.authState=A.pipe(Ji(K),An(o.outsideAngular),wt(o.insideAngular)),this.user=A.pipe(Ji(q),An(o.outsideAngular),wt(o.insideAngular)),this.idToken=this.user.pipe(se(D=>D?he(D.getIdToken()):ye(null))),this.idTokenResult=this.user.pipe(se(D=>D?he(D.getIdTokenResult()):ye(null))),this.credential=bt(A,_,this.authState.pipe(Po(D=>!D))).pipe(O(D=>D?.user?D:null),An(o.outsideAngular),wt(o.insideAngular))}return ca(this,E,s,{spy:{apply:(A,K,q)=>{(A.startsWith("signIn")||A.startsWith("createUser"))&&q.then(D=>_.next(D))}}})}static \u0275fac=function(i){return new(i||n)(I(Vn),I(Ln,8),I(Nn),I(Dn),I(Fn),I(Tr,8),I(Dr,8),I(Nr,8),I(kr,8),I(Rr,8),I(Pr,8),I(Ot,8))};static \u0275prov=Z({token:n,factory:n.\u0275fac,providedIn:"any"})}return n})();var ol="@firebase/database",al="1.0.8";var $s="";function Ks(n){$s=n}var Wr=class{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){t==null?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),R(t))}get(e){let t=this.domStorage_.getItem(this.prefixedName_(e));return t==null?null:Pn(t)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}};var jr=class{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){t==null?delete this.cache_[e]:this.cache_[e]=t}get(e){return ee(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}};var Ll=function(n){try{if(typeof window<"u"&&typeof window[n]<"u"){let e=window[n];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new Wr(e)}}catch{}return new jr},We=Ll("localStorage"),Gr=Ll("sessionStorage");var at=new Qe("@firebase/database"),Ul=function(){let n=1;return function(){return n++}}(),Bl=function(n){let e=oa(n),t=new sa;t.update(e);let i=t.digest();return Rn.encodeByteArray(i)},pn=function(...n){let e="";for(let t=0;t<n.length;t++){let i=n[t];Array.isArray(i)||i&&typeof i=="object"&&typeof i.length=="number"?e+=pn.apply(null,i):typeof i=="object"?e+=R(i):e+=i,e+=" "}return e},je=null,ll=!0,Wl=function(n,e){f(!e||n===!0||n===!1,"Can't turn on custom loggers persistently."),n===!0?(at.logLevel=aa.VERBOSE,je=at.log.bind(at),e&&Gr.set("logging_enabled",!0)):typeof n=="function"?je=n:(je=null,Gr.remove("logging_enabled"))},x=function(...n){if(ll===!0&&(ll=!1,je===null&&Gr.get("logging_enabled")===!0&&Wl(!0)),je){let e=pn.apply(null,n);je(e)}},_n=function(n){return function(...e){x(n,...e)}},Hr=function(...n){let e="FIREBASE INTERNAL ERROR: "+pn(...n);at.error(e)},_e=function(...n){let e=`FIREBASE FATAL ERROR: ${pn(...n)}`;throw at.error(e),new Error(e)},U=function(...n){let e="FIREBASE WARNING: "+pn(...n);at.warn(e)},Qh=function(){typeof window<"u"&&window.location&&window.location.protocol&&window.location.protocol.indexOf("https:")!==-1&&U("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},Ri=function(n){return typeof n=="number"&&(n!==n||n===Number.POSITIVE_INFINITY||n===Number.NEGATIVE_INFINITY)},Xh=function(n){if(de()||document.readyState==="complete")n();else{let e=!1,t=function(){if(!document.body){setTimeout(t,Math.floor(10));return}e||(e=!0,n())};document.addEventListener?(document.addEventListener("DOMContentLoaded",t,!1),window.addEventListener("load",t,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{document.readyState==="complete"&&t()}),window.attachEvent("onload",t))}},Me="[MIN_NAME]",we="[MAX_NAME]",He=function(n,e){if(n===e)return 0;if(n===Me||e===we)return-1;if(e===Me||n===we)return 1;{let t=cl(n),i=cl(e);return t!==null?i!==null?t-i===0?n.length-e.length:t-i:-1:i!==null?1:n<e?-1:1}},Jh=function(n,e){return n===e?0:n<e?-1:1},Ht=function(n,e){if(e&&n in e)return e[n];throw new Error("Missing required key ("+n+") in object: "+R(e))},qs=function(n){if(typeof n!="object"||n===null)return R(n);let e=[];for(let i in n)e.push(i);e.sort();let t="{";for(let i=0;i<e.length;i++)i!==0&&(t+=","),t+=R(e[i]),t+=":",t+=qs(n[e[i]]);return t+="}",t},jl=function(n,e){let t=n.length;if(t<=e)return[n];let i=[];for(let r=0;r<t;r+=e)r+e>t?i.push(n.substring(r,t)):i.push(n.substring(r,r+e));return i};function F(n,e){for(let t in n)n.hasOwnProperty(t)&&e(t,n[t])}var Gl=function(n){f(!Ri(n),"Invalid JSON number");let e=11,t=52,i=(1<<e-1)-1,r,s,o,a,l;n===0?(s=0,o=0,r=1/n===-1/0?1:0):(r=n<0,n=Math.abs(n),n>=Math.pow(2,1-i)?(a=Math.min(Math.floor(Math.log(n)/Math.LN2),i),s=a+i,o=Math.round(n*Math.pow(2,t-a)-Math.pow(2,t))):(s=0,o=Math.round(n/Math.pow(2,1-i-t))));let c=[];for(l=t;l;l-=1)c.push(o%2?1:0),o=Math.floor(o/2);for(l=e;l;l-=1)c.push(s%2?1:0),s=Math.floor(s/2);c.push(r?1:0),c.reverse();let u=c.join(""),h="";for(l=0;l<64;l+=8){let d=parseInt(u.substr(l,8),2).toString(16);d.length===1&&(d="0"+d),h=h+d}return h.toLowerCase()},Zh=function(){return!!(typeof window=="object"&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))},ed=function(){return typeof Windows=="object"&&typeof Windows.UI=="object"};function td(n,e){let t="Unknown Error";n==="too_big"?t="The data requested exceeds the maximum size that can be accessed with a single request.":n==="permission_denied"?t="Client doesn't have permission to access the desired data.":n==="unavailable"&&(t="The service is unavailable");let i=new Error(n+" at "+e._path.toString()+": "+t);return i.code=n.toUpperCase(),i}var nd=new RegExp("^-?(0*)\\d{1,10}$"),id=-2147483648,rd=2147483647,cl=function(n){if(nd.test(n)){let e=Number(n);if(e>=id&&e<=rd)return e}return null},gt=function(n){try{n()}catch(e){setTimeout(()=>{let t=e.stack||"";throw U("Exception was thrown by user callback.",t),e},Math.floor(0))}},sd=function(){return(typeof window=="object"&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},zt=function(n,e){let t=setTimeout(n,e);return typeof t=="number"&&typeof Deno<"u"&&Deno.unrefTimer?Deno.unrefTimer(t):typeof t=="object"&&t.unref&&t.unref(),t};var $r=class{constructor(e,t){this.appName_=e,this.appCheckProvider=t,this.appCheck=t?.getImmediate({optional:!0}),this.appCheck||t?.get().then(i=>this.appCheck=i)}getToken(e){return this.appCheck?this.appCheck.getToken(e):new Promise((t,i)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(t,i):t(null)},0)})}addTokenChangeListener(e){var t;(t=this.appCheckProvider)===null||t===void 0||t.get().then(i=>i.addTokenListener(e))}notifyForInvalidToken(){U(`Provided AppCheck credentials for the app named "${this.appName_}" are invalid. This usually indicates your app was not initialized correctly.`)}};var Kr=class{constructor(e,t,i){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=i,this.auth_=null,this.auth_=i.getImmediate({optional:!0}),this.auth_||i.onInit(r=>this.auth_=r)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(t=>t&&t.code==="auth/token-not-initialized"?(x("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(t)):new Promise((t,i)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(t,i):t(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(t=>t.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(t=>t.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',U(e)}},Yt=(()=>{class n{constructor(t){this.accessToken=t}getToken(t){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(t){t(this.accessToken)}removeTokenChangeListener(t){}notifyForInvalidToken(){}}n.OWNER="owner";return n})(),si="5",Hl="v",$l="s",Kl="r",ql="f",zl=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,Yl="ls",Ql="p",qr="ac",Xl="websocket",Jl="long_polling";var oi=class{constructor(e,t,i,r,s=!1,o="",a=!1,l=!1){this.secure=t,this.namespace=i,this.webSocketOnly=r,this.nodeAdmin=s,this.persistenceKey=o,this.includeNamespaceInQueryParams=a,this.isUsingEmulator=l,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=We.get("host:"+e)||this._host}isCacheableHost(){return this.internalHost.substr(0,2)==="s-"}isCustomHost(){return this._domain!=="firebaseio.com"&&this._domain!=="firebaseio-demo.com"}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&We.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){let e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${t}`}};function od(n){return n.host!==n.internalHost||n.isCustomHost()||n.includeNamespaceInQueryParams}function Zl(n,e,t){f(typeof e=="string","typeof type must == string"),f(typeof t=="object","typeof params must == object");let i;if(e===Xl)i=(n.secure?"wss://":"ws://")+n.internalHost+"/.ws?";else if(e===Jl)i=(n.secure?"https://":"http://")+n.internalHost+"/.lp?";else throw new Error("Unknown connection type: "+e);od(n)&&(t.ns=n.namespace);let r=[];return F(t,(s,o)=>{r.push(s+"="+o)}),i+r.join("&")}var zr=class{constructor(){this.counters_={}}incrementCounter(e,t=1){ee(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return Xo(this.counters_)}};var xr={},Fr={};function zs(n){let e=n.toString();return xr[e]||(xr[e]=new zr),xr[e]}function ad(n,e){let t=n.toString();return Fr[t]||(Fr[t]=e()),Fr[t]}var Yr=class{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){let i=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let r=0;r<i.length;++r)i[r]&&gt(()=>{this.onMessage_(i[r])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}};var ul="start",ld="close",cd="pLPCommand",ud="pRTLPCB",ec="id",tc="pw",nc="ser",hd="cb",dd="seg",fd="ts",pd="d",_d="dframe",ic=1870,rc=30,gd=ic-rc,md=25e3,yd=3e4,Zt=class n{constructor(e,t,i,r,s,o,a){this.connId=e,this.repoInfo=t,this.applicationId=i,this.appCheckToken=r,this.authToken=s,this.transportSessionId=o,this.lastSessionId=a,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=_n(e),this.stats_=zs(t),this.urlFn=l=>(this.appCheckToken&&(l[qr]=this.appCheckToken),Zl(t,Jl,l))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new Yr(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(yd)),Xh(()=>{if(this.isClosed_)return;this.scriptTagHolder=new Qr((...s)=>{let[o,a,l,c,u]=s;if(this.incrementIncomingBytes_(s),!!this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,o===ul)this.id=a,this.password=l;else if(o===ld)a?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(a,()=>{this.onClosed_()})):this.onClosed_();else throw new Error("Unrecognized command received: "+o)},(...s)=>{let[o,a]=s;this.incrementIncomingBytes_(s),this.myPacketOrderer.handleResponse(o,a)},()=>{this.onClosed_()},this.urlFn);let i={};i[ul]="t",i[nc]=Math.floor(Math.random()*1e8),this.scriptTagHolder.uniqueCallbackIdentifier&&(i[hd]=this.scriptTagHolder.uniqueCallbackIdentifier),i[Hl]=si,this.transportSessionId&&(i[$l]=this.transportSessionId),this.lastSessionId&&(i[Yl]=this.lastSessionId),this.applicationId&&(i[Ql]=this.applicationId),this.appCheckToken&&(i[qr]=this.appCheckToken),typeof location<"u"&&location.hostname&&zl.test(location.hostname)&&(i[Kl]=ql);let r=this.urlFn(i);this.log_("Connecting via long-poll to "+r),this.scriptTagHolder.addTag(r,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){n.forceAllow_=!0}static forceDisallow(){n.forceDisallow_=!0}static isAvailable(){return de()?!1:n.forceAllow_?!0:!n.forceDisallow_&&typeof document<"u"&&document.createElement!=null&&!Zh()&&!ed()}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){let t=R(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);let i=Qo(t),r=jl(i,gd);for(let s=0;s<r.length;s++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,r.length,r[s]),this.curSegmentNum++}addDisconnectPingFrame(e,t){if(de())return;this.myDisconnFrame=document.createElement("iframe");let i={};i[_d]="t",i[ec]=e,i[tc]=t,this.myDisconnFrame.src=this.urlFn(i),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){let t=R(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}},Qr=class n{constructor(e,t,i,r){if(this.onDisconnect=i,this.urlFn=r,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(Math.random()*1e8),this.sendNewPolls=!0,de())this.commandCB=e,this.onMessageCB=t;else{this.uniqueCallbackIdentifier=Ul(),window[cd+this.uniqueCallbackIdentifier]=e,window[ud+this.uniqueCallbackIdentifier]=t,this.myIFrame=n.createIFrame_();let s="";this.myIFrame.src&&this.myIFrame.src.substr(0,11)==="javascript:"&&(s='<script>document.domain="'+document.domain+'";<\/script>');let o="<html><body>"+s+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(o),this.myIFrame.doc.close()}catch(a){x("frame writing exception"),a.stack&&x(a.stack),x(a)}}}static createIFrame_(){let e=document.createElement("iframe");if(e.style.display="none",document.body){document.body.appendChild(e);try{e.contentWindow.document||x("No IE domain setting required")}catch{let i=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+i+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{this.myIFrame!==null&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));let e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;let e={};e[ec]=this.myID,e[tc]=this.myPW,e[nc]=this.currentSerial;let t=this.urlFn(e),i="",r=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+rc+i.length<=ic;){let o=this.pendingSegs.shift();i=i+"&"+dd+r+"="+o.seg+"&"+fd+r+"="+o.ts+"&"+pd+r+"="+o.d,r++}return t=t+i,this.addLongPollTag_(t,this.currentSerial),!0}else return!1}enqueueSegment(e,t,i){this.pendingSegs.push({seg:e,ts:t,d:i}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);let i=()=>{this.outstandingRequests.delete(t),this.newRequest_()},r=setTimeout(i,Math.floor(md)),s=()=>{clearTimeout(r),i()};this.addTag(e,s)}addTag(e,t){de()?this.doNodeLongPoll(e,t):setTimeout(()=>{try{if(!this.sendNewPolls)return;let i=this.myIFrame.doc.createElement("script");i.type="text/javascript",i.async=!0,i.src=e,i.onload=i.onreadystatechange=function(){let r=i.readyState;(!r||r==="loaded"||r==="complete")&&(i.onload=i.onreadystatechange=null,i.parentNode&&i.parentNode.removeChild(i),t())},i.onerror=()=>{x("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(i)}catch{}},Math.floor(1))}};var vd=16384,Cd=45e3,ai=null;typeof MozWebSocket<"u"?ai=MozWebSocket:typeof WebSocket<"u"&&(ai=WebSocket);var st=(()=>{class n{constructor(t,i,r,s,o,a,l){this.connId=t,this.applicationId=r,this.appCheckToken=s,this.authToken=o,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=_n(this.connId),this.stats_=zs(i),this.connURL=n.connectionURL_(i,a,l,s,r),this.nodeAdmin=i.nodeAdmin}static connectionURL_(t,i,r,s,o){let a={};return a[Hl]=si,!de()&&typeof location<"u"&&location.hostname&&zl.test(location.hostname)&&(a[Kl]=ql),i&&(a[$l]=i),r&&(a[Yl]=r),s&&(a[qr]=s),o&&(a[Ql]=o),Zl(t,Xl,a)}open(t,i){this.onDisconnect=i,this.onMessage=t,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,We.set("previous_websocket_failure",!0);try{let r;if(de()){let s=this.nodeAdmin?"AdminNode":"Node";r={headers:{"User-Agent":`Firebase/${si}/${$s}/${process.platform}/${s}`,"X-Firebase-GMPID":this.applicationId||""}},this.authToken&&(r.headers.Authorization=`Bearer ${this.authToken}`),this.appCheckToken&&(r.headers["X-Firebase-AppCheck"]=this.appCheckToken);let o=process.env,a=this.connURL.indexOf("wss://")===0?o.HTTPS_PROXY||o.https_proxy:o.HTTP_PROXY||o.http_proxy;a&&(r.proxy={origin:a})}this.mySock=new ai(this.connURL,[],r)}catch(r){this.log_("Error instantiating WebSocket.");let s=r.message||r.data;s&&this.log_(s),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=r=>{this.handleIncomingFrame(r)},this.mySock.onerror=r=>{this.log_("WebSocket error.  Closing connection.");let s=r.message||r.data;s&&this.log_(s),this.onClosed_()}}start(){}static forceDisallow(){n.forceDisallow_=!0}static isAvailable(){let t=!1;if(typeof navigator<"u"&&navigator.userAgent){let i=/Android ([0-9]{0,}\.[0-9]{0,})/,r=navigator.userAgent.match(i);r&&r.length>1&&parseFloat(r[1])<4.4&&(t=!0)}return!t&&ai!==null&&!n.forceDisallow_}static previouslyFailed(){return We.isInMemoryStorage||We.get("previous_websocket_failure")===!0}markConnectionHealthy(){We.remove("previous_websocket_failure")}appendFrame_(t){if(this.frames.push(t),this.frames.length===this.totalFrames){let i=this.frames.join("");this.frames=null;let r=Pn(i);this.onMessage(r)}}handleNewFrameCount_(t){this.totalFrames=t,this.frames=[]}extractFrameCount_(t){if(f(this.frames===null,"We already have a frame buffer"),t.length<=6){let i=Number(t);if(!isNaN(i))return this.handleNewFrameCount_(i),null}return this.handleNewFrameCount_(1),t}handleIncomingFrame(t){if(this.mySock===null)return;let i=t.data;if(this.bytesReceived+=i.length,this.stats_.incrementCounter("bytes_received",i.length),this.resetKeepAlive(),this.frames!==null)this.appendFrame_(i);else{let r=this.extractFrameCount_(i);r!==null&&this.appendFrame_(r)}}send(t){this.resetKeepAlive();let i=R(t);this.bytesSent+=i.length,this.stats_.incrementCounter("bytes_sent",i.length);let r=jl(i,vd);r.length>1&&this.sendString_(String(r.length));for(let s=0;s<r.length;s++)this.sendString_(r[s])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(Cd))}sendString_(t){try{this.mySock.send(t)}catch(i){this.log_("Exception thrown from WebSocket.send():",i.message||i.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}n.responsesRequiredToBeHealthy=2,n.healthyTimeout=3e4;return n})(),sc=(()=>{class n{constructor(t){this.initTransports_(t)}static get ALL_TRANSPORTS(){return[Zt,st]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}initTransports_(t){let i=st&&st.isAvailable(),r=i&&!st.previouslyFailed();if(t.webSocketOnly&&(i||U("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),r=!0),r)this.transports_=[st];else{let s=this.transports_=[];for(let o of n.ALL_TRANSPORTS)o&&o.isAvailable()&&s.push(o);n.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}n.globalTransportInitialized_=!1;return n})(),Ed=6e4,wd=5e3,bd=10*1024,Id=100*1024,Or="t",hl="d",Ad="s",dl="r",Sd="e",fl="o",pl="a",_l="n",gl="p",Td="h",Xr=class{constructor(e,t,i,r,s,o,a,l,c,u){this.id=e,this.repoInfo_=t,this.applicationId_=i,this.appCheckToken_=r,this.authToken_=s,this.onMessage_=o,this.onReady_=a,this.onDisconnect_=l,this.onKill_=c,this.lastSessionId=u,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=_n("c:"+this.id+":"),this.transportManager_=new sc(t),this.log_("Connection created"),this.start_()}start_(){let e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;let t=this.connReceiver_(this.conn_),i=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(t,i)},Math.floor(0));let r=e.healthyTimeout||0;r>0&&(this.healthyTimeout_=zt(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>Id?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>bd?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(r)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return t=>{e===this.conn_?this.onConnectionLost_(t):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return t=>{this.state_!==2&&(e===this.rx_?this.onPrimaryMessageReceived_(t):e===this.secondaryConn_?this.onSecondaryMessageReceived_(t):this.log_("message on old connection"))}}sendRequest(e){let t={t:"d",d:e};this.sendData_(t)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if(Or in e){let t=e[Or];t===pl?this.upgradeIfSecondaryHealthy_():t===dl?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):t===fl&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){let t=Ht("t",e),i=Ht("d",e);if(t==="c")this.onSecondaryControl_(i);else if(t==="d")this.pendingDataMessages.push(i);else throw new Error("Unknown protocol layer: "+t)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:gl,d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:pl,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:_l,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){let t=Ht("t",e),i=Ht("d",e);t==="c"?this.onControl_(i):t==="d"&&this.onDataMessage_(i)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){let t=Ht(Or,e);if(hl in e){let i=e[hl];if(t===Td){let r=Object.assign({},i);this.repoInfo_.isUsingEmulator&&(r.h=this.repoInfo_.host),this.onHandshake_(r)}else if(t===_l){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let r=0;r<this.pendingDataMessages.length;++r)this.onDataMessage_(this.pendingDataMessages[r]);this.pendingDataMessages=[],this.tryCleanupConnection()}else t===Ad?this.onConnectionShutdown_(i):t===dl?this.onReset_(i):t===Sd?Hr("Server Error: "+i):t===fl?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):Hr("Unknown control packet command: "+t)}}onHandshake_(e){let t=e.ts,i=e.v,r=e.h;this.sessionId=e.s,this.repoInfo_.host=r,this.state_===0&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),si!==i&&U("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){let e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;let t=this.connReceiver_(this.secondaryConn_),i=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,i),zt(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(Ed))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,this.state_===1?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),this.primaryResponsesRequired_===0?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):zt(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(wd))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&this.state_===1&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:gl,d:{}}}))}onSecondaryConnectionLost_(){let e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,!e&&this.state_===0?(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(We.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)):this.state_===1&&this.log_("Realtime connection lost."),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(this.state_!==1)throw"Connection is not connected";this.tx_.send(e)}close(){this.state_!==2&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}};var li=class{put(e,t,i,r){}merge(e,t,i,r){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,i){}onDisconnectMerge(e,t,i){}onDisconnectCancel(e,t){}reportStats(e){}};var ci=class{constructor(e){this.allowedEvents_=e,this.listeners_={},f(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...t){if(Array.isArray(this.listeners_[e])){let i=[...this.listeners_[e]];for(let r=0;r<i.length;r++)i[r].callback.apply(i[r].context,t)}}on(e,t,i){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:i});let r=this.getInitialEvent(e);r&&t.apply(i,r)}off(e,t,i){this.validateEventType_(e);let r=this.listeners_[e]||[];for(let s=0;s<r.length;s++)if(r[s].callback===t&&(!i||i===r[s].context)){r.splice(s,1);return}}validateEventType_(e){f(this.allowedEvents_.find(t=>t===e),"Unknown event: "+e)}};var ui=class n extends ci{constructor(){super(["online"]),this.online_=!0,typeof window<"u"&&typeof window.addEventListener<"u"&&!rr()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}static getInstance(){return new n}getInitialEvent(e){return f(e==="online","Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}};var ml=32,yl=768,b=class{constructor(e,t){if(t===void 0){this.pieces_=e.split("/");let i=0;for(let r=0;r<this.pieces_.length;r++)this.pieces_[r].length>0&&(this.pieces_[i]=this.pieces_[r],i++);this.pieces_.length=i,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}toString(){let e="";for(let t=this.pieceNum_;t<this.pieces_.length;t++)this.pieces_[t]!==""&&(e+="/"+this.pieces_[t]);return e||"/"}};function w(){return new b("")}function y(n){return n.pieceNum_>=n.pieces_.length?null:n.pieces_[n.pieceNum_]}function xe(n){return n.pieces_.length-n.pieceNum_}function S(n){let e=n.pieceNum_;return e<n.pieces_.length&&e++,new b(n.pieces_,e)}function Ys(n){return n.pieceNum_<n.pieces_.length?n.pieces_[n.pieces_.length-1]:null}function Dd(n){let e="";for(let t=n.pieceNum_;t<n.pieces_.length;t++)n.pieces_[t]!==""&&(e+="/"+encodeURIComponent(String(n.pieces_[t])));return e||"/"}function en(n,e=0){return n.pieces_.slice(n.pieceNum_+e)}function oc(n){if(n.pieceNum_>=n.pieces_.length)return null;let e=[];for(let t=n.pieceNum_;t<n.pieces_.length-1;t++)e.push(n.pieces_[t]);return new b(e,0)}function N(n,e){let t=[];for(let i=n.pieceNum_;i<n.pieces_.length;i++)t.push(n.pieces_[i]);if(e instanceof b)for(let i=e.pieceNum_;i<e.pieces_.length;i++)t.push(e.pieces_[i]);else{let i=e.split("/");for(let r=0;r<i.length;r++)i[r].length>0&&t.push(i[r])}return new b(t,0)}function v(n){return n.pieceNum_>=n.pieces_.length}function j(n,e){let t=y(n),i=y(e);if(t===null)return e;if(t===i)return j(S(n),S(e));throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+n+")")}function Nd(n,e){let t=en(n,0),i=en(e,0);for(let r=0;r<t.length&&r<i.length;r++){let s=He(t[r],i[r]);if(s!==0)return s}return t.length===i.length?0:t.length<i.length?-1:1}function Qs(n,e){if(xe(n)!==xe(e))return!1;for(let t=n.pieceNum_,i=e.pieceNum_;t<=n.pieces_.length;t++,i++)if(n.pieces_[t]!==e.pieces_[i])return!1;return!0}function te(n,e){let t=n.pieceNum_,i=e.pieceNum_;if(xe(n)>xe(e))return!1;for(;t<n.pieces_.length;){if(n.pieces_[t]!==e.pieces_[i])return!1;++t,++i}return!0}var Jr=class{constructor(e,t){this.errorPrefix_=t,this.parts_=en(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let i=0;i<this.parts_.length;i++)this.byteLength_+=xt(this.parts_[i]);ac(this)}};function kd(n,e){n.parts_.length>0&&(n.byteLength_+=1),n.parts_.push(e),n.byteLength_+=xt(e),ac(n)}function Rd(n){let e=n.parts_.pop();n.byteLength_-=xt(e),n.parts_.length>0&&(n.byteLength_-=1)}function ac(n){if(n.byteLength_>yl)throw new Error(n.errorPrefix_+"has a key path longer than "+yl+" bytes ("+n.byteLength_+").");if(n.parts_.length>ml)throw new Error(n.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+ml+") or object contains a cycle "+Be(n))}function Be(n){return n.parts_.length===0?"":"in property '"+n.parts_.join(".")+"'"}var Zr=class n extends ci{constructor(){super(["visible"]);let e,t;typeof document<"u"&&typeof document.addEventListener<"u"&&(typeof document.hidden<"u"?(t="visibilitychange",e="hidden"):typeof document.mozHidden<"u"?(t="mozvisibilitychange",e="mozHidden"):typeof document.msHidden<"u"?(t="msvisibilitychange",e="msHidden"):typeof document.webkitHidden<"u"&&(t="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,t&&document.addEventListener(t,()=>{let i=!document[e];i!==this.visible_&&(this.visible_=i,this.trigger("visible",i))},!1)}static getInstance(){return new n}getInitialEvent(e){return f(e==="visible","Unknown event type: "+e),[this.visible_]}};var $t=1e3,Pd=60*5*1e3,vl=30*1e3,Md=1.3,xd=3e4,Fd="server_kill",Cl=3,Xs=(()=>{class n extends li{constructor(t,i,r,s,o,a,l,c){if(super(),this.repoInfo_=t,this.applicationId_=i,this.onDataUpdate_=r,this.onConnectStatus_=s,this.onServerInfoUpdate_=o,this.authTokenProvider_=a,this.appCheckTokenProvider_=l,this.authOverride_=c,this.id=n.nextPersistentConnectionId_++,this.log_=_n("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=$t,this.maxReconnectDelay_=Pd,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,c&&!de())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");Zr.getInstance().on("visible",this.onVisible_,this),t.host.indexOf("fblocal")===-1&&ui.getInstance().on("online",this.onOnline_,this)}sendRequest(t,i,r){let s=++this.requestNumber_,o={r:s,a:t,b:i};this.log_(R(o)),f(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(o),r&&(this.requestCBHash_[s]=r)}get(t){this.initConnection_();let i=new M,s={action:"g",request:{p:t._path.toString(),q:t._queryObject},onComplete:a=>{let l=a.d;a.s==="ok"?i.resolve(l):i.reject(l)}};this.outstandingGets_.push(s),this.outstandingGetCount_++;let o=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(o),i.promise}listen(t,i,r,s){this.initConnection_();let o=t._queryIdentifier,a=t._path.toString();this.log_("Listen called for "+a+" "+o),this.listens.has(a)||this.listens.set(a,new Map),f(t._queryParams.isDefault()||!t._queryParams.loadsAllData(),"listen() called for non-default but complete query"),f(!this.listens.get(a).has(o),"listen() called twice for same path/queryId.");let l={onComplete:s,hashFn:i,query:t,tag:r};this.listens.get(a).set(o,l),this.connected_&&this.sendListen_(l)}sendGet_(t){let i=this.outstandingGets_[t];this.sendRequest("g",i.request,r=>{delete this.outstandingGets_[t],this.outstandingGetCount_--,this.outstandingGetCount_===0&&(this.outstandingGets_=[]),i.onComplete&&i.onComplete(r)})}sendListen_(t){let i=t.query,r=i._path.toString(),s=i._queryIdentifier;this.log_("Listen on "+r+" for "+s);let o={p:r},a="q";t.tag&&(o.q=i._queryObject,o.t=t.tag),o.h=t.hashFn(),this.sendRequest(a,o,l=>{let c=l.d,u=l.s;n.warnOnListenWarnings_(c,i),(this.listens.get(r)&&this.listens.get(r).get(s))===t&&(this.log_("listen response",l),u!=="ok"&&this.removeListen_(r,s),t.onComplete&&t.onComplete(u,c))})}static warnOnListenWarnings_(t,i){if(t&&typeof t=="object"&&ee(t,"w")){let r=Se(t,"w");if(Array.isArray(r)&&~r.indexOf("no_index")){let s='".indexOn": "'+i._queryParams.getIndex().toString()+'"',o=i._path.toString();U(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${s} at ${o} to your security rules for better performance.`)}}}refreshAuthToken(t){this.authToken_=t,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(t)}reduceReconnectDelayIfAdminCredential_(t){(t&&t.length===40||ia(t))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=vl)}refreshAppCheckToken(t){this.appCheckToken_=t,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){let t=this.authToken_,i=na(t)?"auth":"gauth",r={cred:t};this.authOverride_===null?r.noauth=!0:typeof this.authOverride_=="object"&&(r.authvar=this.authOverride_),this.sendRequest(i,r,s=>{let o=s.s,a=s.d||"error";this.authToken_===t&&(o==="ok"?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(o,a))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},t=>{let i=t.s,r=t.d||"error";i==="ok"?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(i,r)})}unlisten(t,i){let r=t._path.toString(),s=t._queryIdentifier;this.log_("Unlisten called for "+r+" "+s),f(t._queryParams.isDefault()||!t._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(r,s)&&this.connected_&&this.sendUnlisten_(r,s,t._queryObject,i)}sendUnlisten_(t,i,r,s){this.log_("Unlisten on "+t+" for "+i);let o={p:t},a="n";s&&(o.q=r,o.t=s),this.sendRequest(a,o)}onDisconnectPut(t,i,r){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",t,i,r):this.onDisconnectRequestQueue_.push({pathString:t,action:"o",data:i,onComplete:r})}onDisconnectMerge(t,i,r){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",t,i,r):this.onDisconnectRequestQueue_.push({pathString:t,action:"om",data:i,onComplete:r})}onDisconnectCancel(t,i){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",t,null,i):this.onDisconnectRequestQueue_.push({pathString:t,action:"oc",data:null,onComplete:i})}sendOnDisconnect_(t,i,r,s){let o={p:i,d:r};this.log_("onDisconnect "+t,o),this.sendRequest(t,o,a=>{s&&setTimeout(()=>{s(a.s,a.d)},Math.floor(0))})}put(t,i,r,s){this.putInternal("p",t,i,r,s)}merge(t,i,r,s){this.putInternal("m",t,i,r,s)}putInternal(t,i,r,s,o){this.initConnection_();let a={p:i,d:r};o!==void 0&&(a.h=o),this.outstandingPuts_.push({action:t,request:a,onComplete:s}),this.outstandingPutCount_++;let l=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(l):this.log_("Buffering put: "+i)}sendPut_(t){let i=this.outstandingPuts_[t].action,r=this.outstandingPuts_[t].request,s=this.outstandingPuts_[t].onComplete;this.outstandingPuts_[t].queued=this.connected_,this.sendRequest(i,r,o=>{this.log_(i+" response",o),delete this.outstandingPuts_[t],this.outstandingPutCount_--,this.outstandingPutCount_===0&&(this.outstandingPuts_=[]),s&&s(o.s,o.d)})}reportStats(t){if(this.connected_){let i={c:t};this.log_("reportStats",i),this.sendRequest("s",i,r=>{if(r.s!=="ok"){let o=r.d;this.log_("reportStats","Error sending stats: "+o)}})}}onDataMessage_(t){if("r"in t){this.log_("from server: "+R(t));let i=t.r,r=this.requestCBHash_[i];r&&(delete this.requestCBHash_[i],r(t.b))}else{if("error"in t)throw"A server-side error has occurred: "+t.error;"a"in t&&this.onDataPush_(t.a,t.b)}}onDataPush_(t,i){this.log_("handleServerMessage",t,i),t==="d"?this.onDataUpdate_(i.p,i.d,!1,i.t):t==="m"?this.onDataUpdate_(i.p,i.d,!0,i.t):t==="c"?this.onListenRevoked_(i.p,i.q):t==="ac"?this.onAuthRevoked_(i.s,i.d):t==="apc"?this.onAppCheckRevoked_(i.s,i.d):t==="sd"?this.onSecurityDebugPacket_(i):Hr("Unrecognized action received from server: "+R(t)+`
Are you using the latest client?`)}onReady_(t,i){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(t),this.lastSessionId=i,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(t){f(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(t))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(t){t&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=$t,this.realtime_||this.scheduleConnect_(0)),this.visible_=t}onOnline_(t){t?(this.log_("Browser went online."),this.reconnectDelay_=$t,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>xd&&(this.reconnectDelay_=$t),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());let t=new Date().getTime()-this.lastConnectionAttemptTime_,i=Math.max(0,this.reconnectDelay_-t);i=Math.random()*i,this.log_("Trying to reconnect in "+i+"ms"),this.scheduleConnect_(i),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*Md)}this.onConnectStatus_(!1)}establishConnection_(){return ue(this,null,function*(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;let t=this.onDataMessage_.bind(this),i=this.onReady_.bind(this),r=this.onRealtimeDisconnect_.bind(this),s=this.id+":"+n.nextConnectionId_++,o=this.lastSessionId,a=!1,l=null,c=function(){l?l.close():(a=!0,r())},u=function(d){f(l,"sendRequest call when we're not connected not allowed."),l.sendRequest(d)};this.realtime_={close:c,sendRequest:u};let h=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{let[d,p]=yield Promise.all([this.authTokenProvider_.getToken(h),this.appCheckTokenProvider_.getToken(h)]);a?x("getToken() completed but was canceled"):(x("getToken() completed. Creating connection."),this.authToken_=d&&d.accessToken,this.appCheckToken_=p&&p.token,l=new Xr(s,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,t,i,r,_=>{U(_+" ("+this.repoInfo_.toString()+")"),this.interrupt(Fd)},o))}catch(d){this.log_("Failed to get token: "+d),a||(this.repoInfo_.nodeAdmin&&U(d),c())}}})}interrupt(t){x("Interrupting connection for reason: "+t),this.interruptReasons_[t]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(t){x("Resuming connection for reason: "+t),delete this.interruptReasons_[t],Mn(this.interruptReasons_)&&(this.reconnectDelay_=$t,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(t){let i=t-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:i})}cancelSentTransactions_(){for(let t=0;t<this.outstandingPuts_.length;t++){let i=this.outstandingPuts_[t];i&&"h"in i.request&&i.queued&&(i.onComplete&&i.onComplete("disconnect"),delete this.outstandingPuts_[t],this.outstandingPutCount_--)}this.outstandingPutCount_===0&&(this.outstandingPuts_=[])}onListenRevoked_(t,i){let r;i?r=i.map(o=>qs(o)).join("$"):r="default";let s=this.removeListen_(t,r);s&&s.onComplete&&s.onComplete("permission_denied")}removeListen_(t,i){let r=new b(t).toString(),s;if(this.listens.has(r)){let o=this.listens.get(r);s=o.get(i),o.delete(i),o.size===0&&this.listens.delete(r)}else s=void 0;return s}onAuthRevoked_(t,i){x("Auth token revoked: "+t+"/"+i),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),(t==="invalid_token"||t==="permission_denied")&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=Cl&&(this.reconnectDelay_=vl,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(t,i){x("App check token revoked: "+t+"/"+i),this.appCheckToken_=null,this.forceTokenRefresh_=!0,(t==="invalid_token"||t==="permission_denied")&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=Cl&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(t){this.securityDebugCallback_?this.securityDebugCallback_(t):"msg"in t&&console.log("FIREBASE: "+t.msg.replace(`
`,`
FIREBASE: `))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(let t of this.listens.values())for(let i of t.values())this.sendListen_(i);for(let t=0;t<this.outstandingPuts_.length;t++)this.outstandingPuts_[t]&&this.sendPut_(t);for(;this.onDisconnectRequestQueue_.length;){let t=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(t.action,t.pathString,t.data,t.onComplete)}for(let t=0;t<this.outstandingGets_.length;t++)this.outstandingGets_[t]&&this.sendGet_(t)}sendConnectStats_(){let t={},i="js";de()&&(this.repoInfo_.nodeAdmin?i="admin_node":i="node"),t["sdk."+i+"."+$s.replace(/\./g,"-")]=1,rr()?t["framework.cordova"]=1:Zo()&&(t["framework.reactnative"]=1),this.reportStats(t)}shouldReconnect_(){let t=ui.getInstance().currentlyOnline();return Mn(this.interruptReasons_)&&t}}n.nextPersistentConnectionId_=0,n.nextConnectionId_=0;return n})(),C=class n{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new n(e,t)}};var lt=class{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){let i=new C(Me,e),r=new C(Me,t);return this.compare(i,r)!==0}minPost(){return C.MIN}};var ri,hi=class extends lt{static get __EMPTY_NODE(){return ri}static set __EMPTY_NODE(e){ri=e}compare(e,t){return He(e.name,t.name)}isDefinedOn(e){throw Ye("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return C.MIN}maxPost(){return new C(we,ri)}makePost(e,t){return f(typeof e=="string","KeyIndex indexValue must always be a string."),new C(e,ri)}toString(){return".key"}},pe=new hi;var ot=class{constructor(e,t,i,r,s=null){this.isReverse_=r,this.resultGenerator_=s,this.nodeStack_=[];let o=1;for(;!e.isEmpty();)if(e=e,o=t?i(e.key,t):1,r&&(o*=-1),o<0)this.isReverse_?e=e.left:e=e.right;else if(o===0){this.nodeStack_.push(e);break}else this.nodeStack_.push(e),this.isReverse_?e=e.right:e=e.left}getNext(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_.pop(),t;if(this.resultGenerator_?t=this.resultGenerator_(e.key,e.value):t={key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return t}hasNext(){return this.nodeStack_.length>0}peek(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}},le=(()=>{class n{constructor(t,i,r,s,o){this.key=t,this.value=i,this.color=r??n.RED,this.left=s??ne.EMPTY_NODE,this.right=o??ne.EMPTY_NODE}copy(t,i,r,s,o){return new n(t??this.key,i??this.value,r??this.color,s??this.left,o??this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||!!t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,i,r){let s=this,o=r(t,s.key);return o<0?s=s.copy(null,null,null,s.left.insert(t,i,r),null):o===0?s=s.copy(null,i,null,null,null):s=s.copy(null,null,null,null,s.right.insert(t,i,r)),s.fixUp_()}removeMin_(){if(this.left.isEmpty())return ne.EMPTY_NODE;let t=this;return!t.left.isRed_()&&!t.left.left.isRed_()&&(t=t.moveRedLeft_()),t=t.copy(null,null,null,t.left.removeMin_(),null),t.fixUp_()}remove(t,i){let r,s;if(r=this,i(t,r.key)<0)!r.left.isEmpty()&&!r.left.isRed_()&&!r.left.left.isRed_()&&(r=r.moveRedLeft_()),r=r.copy(null,null,null,r.left.remove(t,i),null);else{if(r.left.isRed_()&&(r=r.rotateRight_()),!r.right.isEmpty()&&!r.right.isRed_()&&!r.right.left.isRed_()&&(r=r.moveRedRight_()),i(t,r.key)===0){if(r.right.isEmpty())return ne.EMPTY_NODE;s=r.right.min_(),r=r.copy(s.key,s.value,null,null,r.right.removeMin_())}r=r.copy(null,null,null,null,r.right.remove(t,i))}return r.fixUp_()}isRed_(){return this.color}fixUp_(){let t=this;return t.right.isRed_()&&!t.left.isRed_()&&(t=t.rotateLeft_()),t.left.isRed_()&&t.left.left.isRed_()&&(t=t.rotateRight_()),t.left.isRed_()&&t.right.isRed_()&&(t=t.colorFlip_()),t}moveRedLeft_(){let t=this.colorFlip_();return t.right.left.isRed_()&&(t=t.copy(null,null,null,null,t.right.rotateRight_()),t=t.rotateLeft_(),t=t.colorFlip_()),t}moveRedRight_(){let t=this.colorFlip_();return t.left.left.isRed_()&&(t=t.rotateRight_(),t=t.colorFlip_()),t}rotateLeft_(){let t=this.copy(null,null,n.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight_(){let t=this.copy(null,null,n.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip_(){let t=this.left.copy(null,null,!this.left.color,null,null),i=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,i)}checkMaxDepth_(){let t=this.check_();return Math.pow(2,t)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");let t=this.left.check_();if(t!==this.right.check_())throw new Error("Black depths differ");return t+(this.isRed_()?0:1)}}return n.RED=!0,n.BLACK=!1,n})(),es=class{copy(e,t,i,r,s){return this}insert(e,t,i){return new le(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}},ne=class n{constructor(e,t=n.EMPTY_NODE){this.comparator_=e,this.root_=t}insert(e,t){return new n(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,le.BLACK,null,null))}remove(e){return new n(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,le.BLACK,null,null))}get(e){let t,i=this.root_;for(;!i.isEmpty();){if(t=this.comparator_(e,i.key),t===0)return i.value;t<0?i=i.left:t>0&&(i=i.right)}return null}getPredecessorKey(e){let t,i=this.root_,r=null;for(;!i.isEmpty();)if(t=this.comparator_(e,i.key),t===0){if(i.left.isEmpty())return r?r.key:null;for(i=i.left;!i.right.isEmpty();)i=i.right;return i.key}else t<0?i=i.left:t>0&&(r=i,i=i.right);throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new ot(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new ot(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new ot(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new ot(this.root_,null,this.comparator_,!0,e)}};ne.EMPTY_NODE=new es;function Od(n,e){return He(n.name,e.name)}function Js(n,e){return He(n,e)}var ts;function Vd(n){ts=n}var lc=function(n){return typeof n=="number"?"number:"+Gl(n):"string:"+n},cc=function(n){if(n.isLeafNode()){let e=n.val();f(typeof e=="string"||typeof e=="number"||typeof e=="object"&&ee(e,".sv"),"Priority must be a string or number.")}else f(n===ts||n.isEmpty(),"priority of unexpected type.");f(n===ts||n.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};var El,ct=(()=>{class n{constructor(t,i=n.__childrenNodeConstructor.EMPTY_NODE){this.value_=t,this.priorityNode_=i,this.lazyHash_=null,f(this.value_!==void 0&&this.value_!==null,"LeafNode shouldn't be created with null/undefined value."),cc(this.priorityNode_)}static set __childrenNodeConstructor(t){El=t}static get __childrenNodeConstructor(){return El}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(t){return new n(this.value_,t)}getImmediateChild(t){return t===".priority"?this.priorityNode_:n.__childrenNodeConstructor.EMPTY_NODE}getChild(t){return v(t)?this:y(t)===".priority"?this.priorityNode_:n.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(t,i){return null}updateImmediateChild(t,i){return t===".priority"?this.updatePriority(i):i.isEmpty()&&t!==".priority"?this:n.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(t,i).updatePriority(this.priorityNode_)}updateChild(t,i){let r=y(t);return r===null?i:i.isEmpty()&&r!==".priority"?this:(f(r!==".priority"||xe(t)===1,".priority must be the last token in a path"),this.updateImmediateChild(r,n.__childrenNodeConstructor.EMPTY_NODE.updateChild(S(t),i)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(t,i){return!1}val(t){return t&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(this.lazyHash_===null){let t="";this.priorityNode_.isEmpty()||(t+="priority:"+lc(this.priorityNode_.val())+":");let i=typeof this.value_;t+=i+":",i==="number"?t+=Gl(this.value_):t+=this.value_,this.lazyHash_=Bl(t)}return this.lazyHash_}getValue(){return this.value_}compareTo(t){return t===n.__childrenNodeConstructor.EMPTY_NODE?1:t instanceof n.__childrenNodeConstructor?-1:(f(t.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(t))}compareToLeafNode_(t){let i=typeof t.value_,r=typeof this.value_,s=n.VALUE_TYPE_ORDER.indexOf(i),o=n.VALUE_TYPE_ORDER.indexOf(r);return f(s>=0,"Unknown leaf type: "+i),f(o>=0,"Unknown leaf type: "+r),s===o?r==="object"?0:this.value_<t.value_?-1:this.value_===t.value_?0:1:o-s}withIndex(){return this}isIndexed(){return!0}equals(t){if(t===this)return!0;if(t.isLeafNode()){let i=t;return this.value_===i.value_&&this.priorityNode_.equals(i.priorityNode_)}else return!1}}n.VALUE_TYPE_ORDER=["object","boolean","number","string"];return n})(),uc,hc;function Ld(n){uc=n}function Ud(n){hc=n}var ns=class extends lt{compare(e,t){let i=e.node.getPriority(),r=t.node.getPriority(),s=i.compareTo(r);return s===0?He(e.name,t.name):s}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return C.MIN}maxPost(){return new C(we,new ct("[PRIORITY-POST]",hc))}makePost(e,t){let i=uc(e);return new C(t,new ct("[PRIORITY-POST]",i))}toString(){return".priority"}},T=new ns;var Bd=Math.log(2),is=class{constructor(e){let t=s=>parseInt(Math.log(s)/Bd,10),i=s=>parseInt(Array(s+1).join("1"),2);this.count=t(e+1),this.current_=this.count-1;let r=i(this.count);this.bits_=e+1&r}nextBitIsOne(){let e=!(this.bits_&1<<this.current_);return this.current_--,e}},di=function(n,e,t,i){n.sort(e);let r=function(l,c){let u=c-l,h,d;if(u===0)return null;if(u===1)return h=n[l],d=t?t(h):h,new le(d,h.node,le.BLACK,null,null);{let p=parseInt(u/2,10)+l,_=r(l,p),E=r(p+1,c);return h=n[p],d=t?t(h):h,new le(d,h.node,le.BLACK,_,E)}},s=function(l){let c=null,u=null,h=n.length,d=function(_,E){let A=h-_,K=h;h-=_;let q=r(A+1,K),D=n[A],re=t?t(D):D;p(new le(re,D.node,E,null,q))},p=function(_){c?(c.left=_,c=_):(u=_,c=_)};for(let _=0;_<l.count;++_){let E=l.nextBitIsOne(),A=Math.pow(2,l.count-(_+1));E?d(A,le.BLACK):(d(A,le.BLACK),d(A,le.RED))}return u},o=new is(n.length),a=s(o);return new ne(i||e,a)};var Vr,rt={},ut=class n{constructor(e,t){this.indexes_=e,this.indexSet_=t}static get Default(){return f(rt&&T,"ChildrenNode.ts has not been loaded"),Vr=Vr||new n({".priority":rt},{".priority":T}),Vr}get(e){let t=Se(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof ne?t:null}hasIndex(e){return ee(this.indexSet_,e.toString())}addIndex(e,t){f(e!==pe,"KeyIndex always exists and isn't meant to be added to the IndexMap.");let i=[],r=!1,s=t.getIterator(C.Wrap),o=s.getNext();for(;o;)r=r||e.isDefinedOn(o.node),i.push(o),o=s.getNext();let a;r?a=di(i,e.getCompare()):a=rt;let l=e.toString(),c=Object.assign({},this.indexSet_);c[l]=e;let u=Object.assign({},this.indexes_);return u[l]=a,new n(u,c)}addToIndexes(e,t){let i=Mt(this.indexes_,(r,s)=>{let o=Se(this.indexSet_,s);if(f(o,"Missing index implementation for "+s),r===rt)if(o.isDefinedOn(e.node)){let a=[],l=t.getIterator(C.Wrap),c=l.getNext();for(;c;)c.name!==e.name&&a.push(c),c=l.getNext();return a.push(e),di(a,o.getCompare())}else return rt;else{let a=t.get(e.name),l=r;return a&&(l=l.remove(new C(e.name,a))),l.insert(e,e.node)}});return new n(i,this.indexSet_)}removeFromIndexes(e,t){let i=Mt(this.indexes_,r=>{if(r===rt)return r;{let s=t.get(e.name);return s?r.remove(new C(e.name,s)):r}});return new n(i,this.indexSet_)}};var Kt,m=(()=>{class n{constructor(t,i,r){this.children_=t,this.priorityNode_=i,this.indexMap_=r,this.lazyHash_=null,this.priorityNode_&&cc(this.priorityNode_),this.children_.isEmpty()&&f(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}static get EMPTY_NODE(){return Kt||(Kt=new n(new ne(Js),null,ut.Default))}isLeafNode(){return!1}getPriority(){return this.priorityNode_||Kt}updatePriority(t){return this.children_.isEmpty()?this:new n(this.children_,t,this.indexMap_)}getImmediateChild(t){if(t===".priority")return this.getPriority();{let i=this.children_.get(t);return i===null?Kt:i}}getChild(t){let i=y(t);return i===null?this:this.getImmediateChild(i).getChild(S(t))}hasChild(t){return this.children_.get(t)!==null}updateImmediateChild(t,i){if(f(i,"We should always be passing snapshot nodes"),t===".priority")return this.updatePriority(i);{let r=new C(t,i),s,o;i.isEmpty()?(s=this.children_.remove(t),o=this.indexMap_.removeFromIndexes(r,this.children_)):(s=this.children_.insert(t,i),o=this.indexMap_.addToIndexes(r,this.children_));let a=s.isEmpty()?Kt:this.priorityNode_;return new n(s,a,o)}}updateChild(t,i){let r=y(t);if(r===null)return i;{f(y(t)!==".priority"||xe(t)===1,".priority must be the last token in a path");let s=this.getImmediateChild(r).updateChild(S(t),i);return this.updateImmediateChild(r,s)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(t){if(this.isEmpty())return null;let i={},r=0,s=0,o=!0;if(this.forEachChild(T,(a,l)=>{i[a]=l.val(t),r++,o&&n.INTEGER_REGEXP_.test(a)?s=Math.max(s,Number(a)):o=!1}),!t&&o&&s<2*r){let a=[];for(let l in i)a[l]=i[l];return a}else return t&&!this.getPriority().isEmpty()&&(i[".priority"]=this.getPriority().val()),i}hash(){if(this.lazyHash_===null){let t="";this.getPriority().isEmpty()||(t+="priority:"+lc(this.getPriority().val())+":"),this.forEachChild(T,(i,r)=>{let s=r.hash();s!==""&&(t+=":"+i+":"+s)}),this.lazyHash_=t===""?"":Bl(t)}return this.lazyHash_}getPredecessorChildName(t,i,r){let s=this.resolveIndex_(r);if(s){let o=s.getPredecessorKey(new C(t,i));return o?o.name:null}else return this.children_.getPredecessorKey(t)}getFirstChildName(t){let i=this.resolveIndex_(t);if(i){let r=i.minKey();return r&&r.name}else return this.children_.minKey()}getFirstChild(t){let i=this.getFirstChildName(t);return i?new C(i,this.children_.get(i)):null}getLastChildName(t){let i=this.resolveIndex_(t);if(i){let r=i.maxKey();return r&&r.name}else return this.children_.maxKey()}getLastChild(t){let i=this.getLastChildName(t);return i?new C(i,this.children_.get(i)):null}forEachChild(t,i){let r=this.resolveIndex_(t);return r?r.inorderTraversal(s=>i(s.name,s.node)):this.children_.inorderTraversal(i)}getIterator(t){return this.getIteratorFrom(t.minPost(),t)}getIteratorFrom(t,i){let r=this.resolveIndex_(i);if(r)return r.getIteratorFrom(t,s=>s);{let s=this.children_.getIteratorFrom(t.name,C.Wrap),o=s.peek();for(;o!=null&&i.compare(o,t)<0;)s.getNext(),o=s.peek();return s}}getReverseIterator(t){return this.getReverseIteratorFrom(t.maxPost(),t)}getReverseIteratorFrom(t,i){let r=this.resolveIndex_(i);if(r)return r.getReverseIteratorFrom(t,s=>s);{let s=this.children_.getReverseIteratorFrom(t.name,C.Wrap),o=s.peek();for(;o!=null&&i.compare(o,t)>0;)s.getNext(),o=s.peek();return s}}compareTo(t){return this.isEmpty()?t.isEmpty()?0:-1:t.isLeafNode()||t.isEmpty()?1:t===gn?-1:0}withIndex(t){if(t===pe||this.indexMap_.hasIndex(t))return this;{let i=this.indexMap_.addIndex(t,this.children_);return new n(this.children_,this.priorityNode_,i)}}isIndexed(t){return t===pe||this.indexMap_.hasIndex(t)}equals(t){if(t===this)return!0;if(t.isLeafNode())return!1;{let i=t;if(this.getPriority().equals(i.getPriority()))if(this.children_.count()===i.children_.count()){let r=this.getIterator(T),s=i.getIterator(T),o=r.getNext(),a=s.getNext();for(;o&&a;){if(o.name!==a.name||!o.node.equals(a.node))return!1;o=r.getNext(),a=s.getNext()}return o===null&&a===null}else return!1;else return!1}}resolveIndex_(t){return t===pe?null:this.indexMap_.get(t.toString())}}return n.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/,n})(),rs=class extends m{constructor(){super(new ne(Js),m.EMPTY_NODE,ut.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return m.EMPTY_NODE}isEmpty(){return!1}},gn=new rs;Object.defineProperties(C,{MIN:{value:new C(Me,m.EMPTY_NODE)},MAX:{value:new C(we,gn)}});hi.__EMPTY_NODE=m.EMPTY_NODE;ct.__childrenNodeConstructor=m;Vd(gn);Ud(gn);var Wd=!0;function k(n,e=null){if(n===null)return m.EMPTY_NODE;if(typeof n=="object"&&".priority"in n&&(e=n[".priority"]),f(e===null||typeof e=="string"||typeof e=="number"||typeof e=="object"&&".sv"in e,"Invalid priority type found: "+typeof e),typeof n=="object"&&".value"in n&&n[".value"]!==null&&(n=n[".value"]),typeof n!="object"||".sv"in n){let t=n;return new ct(t,k(e))}if(!(n instanceof Array)&&Wd){let t=[],i=!1;if(F(n,(o,a)=>{if(o.substring(0,1)!=="."){let l=k(a);l.isEmpty()||(i=i||!l.getPriority().isEmpty(),t.push(new C(o,l)))}}),t.length===0)return m.EMPTY_NODE;let s=di(t,Od,o=>o.name,Js);if(i){let o=di(t,T.getCompare());return new m(s,k(e),new ut({".priority":o},{".priority":T}))}else return new m(s,k(e),ut.Default)}else{let t=m.EMPTY_NODE;return F(n,(i,r)=>{if(ee(n,i)&&i.substring(0,1)!=="."){let s=k(r);(s.isLeafNode()||!s.isEmpty())&&(t=t.updateImmediateChild(i,s))}}),t.updatePriority(k(e))}}Ld(k);var tn=class extends lt{constructor(e){super(),this.indexPath_=e,f(!v(e)&&y(e)!==".priority","Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){let i=this.extractChild(e.node),r=this.extractChild(t.node),s=i.compareTo(r);return s===0?He(e.name,t.name):s}makePost(e,t){let i=k(e),r=m.EMPTY_NODE.updateChild(this.indexPath_,i);return new C(t,r)}maxPost(){let e=m.EMPTY_NODE.updateChild(this.indexPath_,gn);return new C(we,e)}toString(){return en(this.indexPath_,0).join("/")}};var ss=class extends lt{compare(e,t){let i=e.node.compareTo(t.node);return i===0?He(e.name,t.name):i}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return C.MIN}maxPost(){return C.MAX}makePost(e,t){let i=k(e);return new C(t,i)}toString(){return".value"}},Zs=new ss;function dc(n){return{type:"value",snapshotNode:n}}function ht(n,e){return{type:"child_added",snapshotNode:e,childName:n}}function nn(n,e){return{type:"child_removed",snapshotNode:e,childName:n}}function rn(n,e,t){return{type:"child_changed",snapshotNode:e,childName:n,oldSnap:t}}function jd(n,e){return{type:"child_moved",snapshotNode:e,childName:n}}var sn=class{constructor(e){this.index_=e}updateChild(e,t,i,r,s,o){f(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");let a=e.getImmediateChild(t);return a.getChild(r).equals(i.getChild(r))&&a.isEmpty()===i.isEmpty()||(o!=null&&(i.isEmpty()?e.hasChild(t)?o.trackChildChange(nn(t,a)):f(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):a.isEmpty()?o.trackChildChange(ht(t,i)):o.trackChildChange(rn(t,i,a))),e.isLeafNode()&&i.isEmpty())?e:e.updateImmediateChild(t,i).withIndex(this.index_)}updateFullNode(e,t,i){return i!=null&&(e.isLeafNode()||e.forEachChild(T,(r,s)=>{t.hasChild(r)||i.trackChildChange(nn(r,s))}),t.isLeafNode()||t.forEachChild(T,(r,s)=>{if(e.hasChild(r)){let o=e.getImmediateChild(r);o.equals(s)||i.trackChildChange(rn(r,s,o))}else i.trackChildChange(ht(r,s))})),t.withIndex(this.index_)}updatePriority(e,t){return e.isEmpty()?m.EMPTY_NODE:e.updatePriority(t)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}};var fi=class n{constructor(e){this.indexedFilter_=new sn(e.getIndex()),this.index_=e.getIndex(),this.startPost_=n.getStartPost_(e),this.endPost_=n.getEndPost_(e),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){let t=this.startIsInclusive_?this.index_.compare(this.getStartPost(),e)<=0:this.index_.compare(this.getStartPost(),e)<0,i=this.endIsInclusive_?this.index_.compare(e,this.getEndPost())<=0:this.index_.compare(e,this.getEndPost())<0;return t&&i}updateChild(e,t,i,r,s,o){return this.matches(new C(t,i))||(i=m.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,i,r,s,o)}updateFullNode(e,t,i){t.isLeafNode()&&(t=m.EMPTY_NODE);let r=t.withIndex(this.index_);r=r.updatePriority(m.EMPTY_NODE);let s=this;return t.forEachChild(T,(o,a)=>{s.matches(new C(o,a))||(r=r.updateImmediateChild(o,m.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,r,i)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){let t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}else return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){let t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}else return e.getIndex().maxPost()}};var os=class{constructor(e){this.withinDirectionalStart=t=>this.reverse_?this.withinEndPost(t):this.withinStartPost(t),this.withinDirectionalEnd=t=>this.reverse_?this.withinStartPost(t):this.withinEndPost(t),this.withinStartPost=t=>{let i=this.index_.compare(this.rangedFilter_.getStartPost(),t);return this.startIsInclusive_?i<=0:i<0},this.withinEndPost=t=>{let i=this.index_.compare(t,this.rangedFilter_.getEndPost());return this.endIsInclusive_?i<=0:i<0},this.rangedFilter_=new fi(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,t,i,r,s,o){return this.rangedFilter_.matches(new C(t,i))||(i=m.EMPTY_NODE),e.getImmediateChild(t).equals(i)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,i,r,s,o):this.fullLimitUpdateChild_(e,t,i,s,o)}updateFullNode(e,t,i){let r;if(t.isLeafNode()||t.isEmpty())r=m.EMPTY_NODE.withIndex(this.index_);else if(this.limit_*2<t.numChildren()&&t.isIndexed(this.index_)){r=m.EMPTY_NODE.withIndex(this.index_);let s;this.reverse_?s=t.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):s=t.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let o=0;for(;s.hasNext()&&o<this.limit_;){let a=s.getNext();if(this.withinDirectionalStart(a))if(this.withinDirectionalEnd(a))r=r.updateImmediateChild(a.name,a.node),o++;else break;else continue}}else{r=t.withIndex(this.index_),r=r.updatePriority(m.EMPTY_NODE);let s;this.reverse_?s=r.getReverseIterator(this.index_):s=r.getIterator(this.index_);let o=0;for(;s.hasNext();){let a=s.getNext();o<this.limit_&&this.withinDirectionalStart(a)&&this.withinDirectionalEnd(a)?o++:r=r.updateImmediateChild(a.name,m.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,r,i)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,t,i,r,s){let o;if(this.reverse_){let h=this.index_.getCompare();o=(d,p)=>h(p,d)}else o=this.index_.getCompare();let a=e;f(a.numChildren()===this.limit_,"");let l=new C(t,i),c=this.reverse_?a.getFirstChild(this.index_):a.getLastChild(this.index_),u=this.rangedFilter_.matches(l);if(a.hasChild(t)){let h=a.getImmediateChild(t),d=r.getChildAfterChild(this.index_,c,this.reverse_);for(;d!=null&&(d.name===t||a.hasChild(d.name));)d=r.getChildAfterChild(this.index_,d,this.reverse_);let p=d==null?1:o(d,l);if(u&&!i.isEmpty()&&p>=0)return s?.trackChildChange(rn(t,i,h)),a.updateImmediateChild(t,i);{s?.trackChildChange(nn(t,h));let E=a.updateImmediateChild(t,m.EMPTY_NODE);return d!=null&&this.rangedFilter_.matches(d)?(s?.trackChildChange(ht(d.name,d.node)),E.updateImmediateChild(d.name,d.node)):E}}else return i.isEmpty()?e:u&&o(c,l)>=0?(s!=null&&(s.trackChildChange(nn(c.name,c.node)),s.trackChildChange(ht(t,i))),a.updateImmediateChild(t,i).updateImmediateChild(c.name,m.EMPTY_NODE)):e}};var on=class n{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=T}hasStart(){return this.startSet_}isViewFromLeft(){return this.viewFrom_===""?this.startSet_:this.viewFrom_==="l"}getIndexStartValue(){return f(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return f(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:Me}hasEnd(){return this.endSet_}getIndexEndValue(){return f(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return f(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:we}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&this.viewFrom_!==""}getLimit(){return f(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===T}copy(){let e=new n;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}};function Gd(n){return n.loadsAllData()?new sn(n.getIndex()):n.hasLimit()?new os(n):new fi(n)}function Hd(n,e){let t=n.copy();return t.limitSet_=!0,t.limit_=e,t.viewFrom_="l",t}function $d(n,e){let t=n.copy();return t.limitSet_=!0,t.limit_=e,t.viewFrom_="r",t}function as(n,e,t){let i=n.copy();return i.startSet_=!0,e===void 0&&(e=null),i.indexStartValue_=e,t!=null?(i.startNameSet_=!0,i.indexStartName_=t):(i.startNameSet_=!1,i.indexStartName_=""),i}function Kd(n,e,t){let i;return n.index_===pe||t?i=as(n,e,t):i=as(n,e,we),i.startAfterSet_=!0,i}function ls(n,e,t){let i=n.copy();return i.endSet_=!0,e===void 0&&(e=null),i.indexEndValue_=e,t!==void 0?(i.endNameSet_=!0,i.indexEndName_=t):(i.endNameSet_=!1,i.indexEndName_=""),i}function qd(n,e,t){let i;return n.index_===pe||t?i=ls(n,e,t):i=ls(n,e,Me),i.endBeforeSet_=!0,i}function Pi(n,e){let t=n.copy();return t.index_=e,t}function wl(n){let e={};if(n.isDefault())return e;let t;if(n.index_===T?t="$priority":n.index_===Zs?t="$value":n.index_===pe?t="$key":(f(n.index_ instanceof tn,"Unrecognized index type!"),t=n.index_.toString()),e.orderBy=R(t),n.startSet_){let i=n.startAfterSet_?"startAfter":"startAt";e[i]=R(n.indexStartValue_),n.startNameSet_&&(e[i]+=","+R(n.indexStartName_))}if(n.endSet_){let i=n.endBeforeSet_?"endBefore":"endAt";e[i]=R(n.indexEndValue_),n.endNameSet_&&(e[i]+=","+R(n.indexEndName_))}return n.limitSet_&&(n.isViewFromLeft()?e.limitToFirst=n.limit_:e.limitToLast=n.limit_),e}function bl(n){let e={};if(n.startSet_&&(e.sp=n.indexStartValue_,n.startNameSet_&&(e.sn=n.indexStartName_),e.sin=!n.startAfterSet_),n.endSet_&&(e.ep=n.indexEndValue_,n.endNameSet_&&(e.en=n.indexEndName_),e.ein=!n.endBeforeSet_),n.limitSet_){e.l=n.limit_;let t=n.viewFrom_;t===""&&(n.isViewFromLeft()?t="l":t="r"),e.vf=t}return n.index_!==T&&(e.i=n.index_.toString()),e}var cs=class n extends li{constructor(e,t,i,r){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=i,this.appCheckTokenProvider_=r,this.log_=_n("p:rest:"),this.listens_={}}reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,t){return t!==void 0?"tag$"+t:(f(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}listen(e,t,i,r){let s=e._path.toString();this.log_("Listen called for "+s+" "+e._queryIdentifier);let o=n.getListenId_(e,i),a={};this.listens_[o]=a;let l=wl(e._queryParams);this.restRequest_(s+".json",l,(c,u)=>{let h=u;if(c===404&&(h=null,c=null),c===null&&this.onDataUpdate_(s,h,!1,i),Se(this.listens_,o)===a){let d;c?c===401?d="permission_denied":d="rest_error:"+c:d="ok",r(d,null)}})}unlisten(e,t){let i=n.getListenId_(e,t);delete this.listens_[i]}get(e){let t=wl(e._queryParams),i=e._path.toString(),r=new M;return this.restRequest_(i+".json",t,(s,o)=>{let a=o;s===404&&(a=null,s=null),s===null?(this.onDataUpdate_(i,a,!1,null),r.resolve(a)):r.reject(new Error(a))}),r.promise}refreshAuthToken(e){}restRequest_(e,t={},i){return t.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([r,s])=>{r&&r.accessToken&&(t.auth=r.accessToken),s&&s.token&&(t.ac=s.token);let o=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+ra(t);this.log_("Sending REST request for "+o);let a=new XMLHttpRequest;a.onreadystatechange=()=>{if(i&&a.readyState===4){this.log_("REST Response for "+o+" received. status:",a.status,"response:",a.responseText);let l=null;if(a.status>=200&&a.status<300){try{l=Pn(a.responseText)}catch{U("Failed to parse JSON response for "+o+": "+a.responseText)}i(null,l)}else a.status!==401&&a.status!==404&&U("Got unsuccessful REST response for "+o+" Status: "+a.status),i(a.status);i=null}},a.open("GET",o,!0),a.send()})}};var us=class{constructor(){this.rootNode_=m.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}};function pi(){return{value:null,children:new Map}}function mt(n,e,t){if(v(e))n.value=t,n.children.clear();else if(n.value!==null)n.value=n.value.updateChild(e,t);else{let i=y(e);n.children.has(i)||n.children.set(i,pi());let r=n.children.get(i);e=S(e),mt(r,e,t)}}function hs(n,e){if(v(e))return n.value=null,n.children.clear(),!0;if(n.value!==null){if(n.value.isLeafNode())return!1;{let t=n.value;return n.value=null,t.forEachChild(T,(i,r)=>{mt(n,new b(i),r)}),hs(n,e)}}else if(n.children.size>0){let t=y(e);return e=S(e),n.children.has(t)&&hs(n.children.get(t),e)&&n.children.delete(t),n.children.size===0}else return!0}function ds(n,e,t){n.value!==null?t(e,n.value):zd(n,(i,r)=>{let s=new b(e.toString()+"/"+i);ds(r,s,t)})}function zd(n,e){n.children.forEach((t,i)=>{e(i,t)})}var fs=class{constructor(e){this.collection_=e,this.last_=null}get(){let e=this.collection_.get(),t=Object.assign({},e);return this.last_&&F(this.last_,(i,r)=>{t[i]=t[i]-r}),this.last_=e,t}};var Il=10*1e3,Yd=30*1e3,Qd=5*60*1e3,ps=class{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new fs(e);let i=Il+(Yd-Il)*Math.random();zt(this.reportStats_.bind(this),Math.floor(i))}reportStats_(){let e=this.statsListener_.get(),t={},i=!1;F(e,(r,s)=>{s>0&&ee(this.statsToReport_,r)&&(t[r]=s,i=!0)}),i&&this.server_.reportStats(t),zt(this.reportStats_.bind(this),Math.floor(Math.random()*2*Qd))}};var fe=function(n){return n[n.OVERWRITE=0]="OVERWRITE",n[n.MERGE=1]="MERGE",n[n.ACK_USER_WRITE=2]="ACK_USER_WRITE",n[n.LISTEN_COMPLETE=3]="LISTEN_COMPLETE",n}(fe||{});function eo(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function to(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function no(n){return{fromUser:!1,fromServer:!0,queryId:n,tagged:!0}}var _s=class n{constructor(e,t,i){this.path=e,this.affectedTree=t,this.revert=i,this.type=fe.ACK_USER_WRITE,this.source=eo()}operationForChild(e){if(v(this.path)){if(this.affectedTree.value!=null)return f(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{let t=this.affectedTree.subtree(new b(e));return new n(w(),t,this.revert)}}else return f(y(this.path)===e,"operationForChild called for unrelated child."),new n(S(this.path),this.affectedTree,this.revert)}};var _i=class n{constructor(e,t){this.source=e,this.path=t,this.type=fe.LISTEN_COMPLETE}operationForChild(e){return v(this.path)?new n(this.source,w()):new n(this.source,S(this.path))}};var dt=class n{constructor(e,t,i){this.source=e,this.path=t,this.snap=i,this.type=fe.OVERWRITE}operationForChild(e){return v(this.path)?new n(this.source,w(),this.snap.getImmediateChild(e)):new n(this.source,S(this.path),this.snap)}};var an=class n{constructor(e,t,i){this.source=e,this.path=t,this.children=i,this.type=fe.MERGE}operationForChild(e){if(v(this.path)){let t=this.children.subtree(new b(e));return t.isEmpty()?null:t.value?new dt(this.source,w(),t.value):new n(this.source,w(),t)}else return f(y(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new n(this.source,S(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}};var ge=class{constructor(e,t,i){this.node_=e,this.fullyInitialized_=t,this.filtered_=i}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(v(e))return this.isFullyInitialized()&&!this.filtered_;let t=y(e);return this.isCompleteForChild(t)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}};var gs=class{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}};function Xd(n,e,t,i){let r=[],s=[];return e.forEach(o=>{o.type==="child_changed"&&n.index_.indexedValueChanged(o.oldSnap,o.snapshotNode)&&s.push(jd(o.childName,o.snapshotNode))}),qt(n,r,"child_removed",e,i,t),qt(n,r,"child_added",e,i,t),qt(n,r,"child_moved",s,i,t),qt(n,r,"child_changed",e,i,t),qt(n,r,"value",e,i,t),r}function qt(n,e,t,i,r,s){let o=i.filter(a=>a.type===t);o.sort((a,l)=>Zd(n,a,l)),o.forEach(a=>{let l=Jd(n,a,s);r.forEach(c=>{c.respondsTo(a.type)&&e.push(c.createEvent(l,n.query_))})})}function Jd(n,e,t){return e.type==="value"||e.type==="child_removed"||(e.prevName=t.getPredecessorChildName(e.childName,e.snapshotNode,n.index_)),e}function Zd(n,e,t){if(e.childName==null||t.childName==null)throw Ye("Should only compare child_ events.");let i=new C(e.childName,e.snapshotNode),r=new C(t.childName,t.snapshotNode);return n.index_.compare(i,r)}function Mi(n,e){return{eventCache:n,serverCache:e}}function Qt(n,e,t,i){return Mi(new ge(e,t,i),n.serverCache)}function fc(n,e,t,i){return Mi(n.eventCache,new ge(e,t,i))}function gi(n){return n.eventCache.isFullyInitialized()?n.eventCache.getNode():null}function Ge(n){return n.serverCache.isFullyInitialized()?n.serverCache.getNode():null}var Lr,ef=()=>(Lr||(Lr=new ne(Jh)),Lr),G=class n{constructor(e,t=ef()){this.value=e,this.children=t}static fromObject(e){let t=new n(null);return F(e,(i,r)=>{t=t.set(new b(i),r)}),t}isEmpty(){return this.value===null&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(this.value!=null&&t(this.value))return{path:w(),value:this.value};if(v(e))return null;{let i=y(e),r=this.children.get(i);if(r!==null){let s=r.findRootMostMatchingPathAndValue(S(e),t);return s!=null?{path:N(new b(i),s.path),value:s.value}:null}else return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(v(e))return this;{let t=y(e),i=this.children.get(t);return i!==null?i.subtree(S(e)):new n(null)}}set(e,t){if(v(e))return new n(t,this.children);{let i=y(e),s=(this.children.get(i)||new n(null)).set(S(e),t),o=this.children.insert(i,s);return new n(this.value,o)}}remove(e){if(v(e))return this.children.isEmpty()?new n(null):new n(null,this.children);{let t=y(e),i=this.children.get(t);if(i){let r=i.remove(S(e)),s;return r.isEmpty()?s=this.children.remove(t):s=this.children.insert(t,r),this.value===null&&s.isEmpty()?new n(null):new n(this.value,s)}else return this}}get(e){if(v(e))return this.value;{let t=y(e),i=this.children.get(t);return i?i.get(S(e)):null}}setTree(e,t){if(v(e))return t;{let i=y(e),s=(this.children.get(i)||new n(null)).setTree(S(e),t),o;return s.isEmpty()?o=this.children.remove(i):o=this.children.insert(i,s),new n(this.value,o)}}fold(e){return this.fold_(w(),e)}fold_(e,t){let i={};return this.children.inorderTraversal((r,s)=>{i[r]=s.fold_(N(e,r),t)}),t(e,this.value,i)}findOnPath(e,t){return this.findOnPath_(e,w(),t)}findOnPath_(e,t,i){let r=this.value?i(t,this.value):!1;if(r)return r;if(v(e))return null;{let s=y(e),o=this.children.get(s);return o?o.findOnPath_(S(e),N(t,s),i):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,w(),t)}foreachOnPath_(e,t,i){if(v(e))return this;{this.value&&i(t,this.value);let r=y(e),s=this.children.get(r);return s?s.foreachOnPath_(S(e),N(t,r),i):new n(null)}}foreach(e){this.foreach_(w(),e)}foreach_(e,t){this.children.inorderTraversal((i,r)=>{r.foreach_(N(e,i),t)}),this.value&&t(e,this.value)}foreachChild(e){this.children.inorderTraversal((t,i)=>{i.value&&e(t,i.value)})}};var ce=class n{constructor(e){this.writeTree_=e}static empty(){return new n(new G(null))}};function Xt(n,e,t){if(v(e))return new ce(new G(t));{let i=n.writeTree_.findRootMostValueAndPath(e);if(i!=null){let r=i.path,s=i.value,o=j(r,e);return s=s.updateChild(o,t),new ce(n.writeTree_.set(r,s))}else{let r=new G(t),s=n.writeTree_.setTree(e,r);return new ce(s)}}}function ms(n,e,t){let i=n;return F(t,(r,s)=>{i=Xt(i,N(e,r),s)}),i}function Al(n,e){if(v(e))return ce.empty();{let t=n.writeTree_.setTree(e,new G(null));return new ce(t)}}function ys(n,e){return $e(n,e)!=null}function $e(n,e){let t=n.writeTree_.findRootMostValueAndPath(e);return t!=null?n.writeTree_.get(t.path).getChild(j(t.path,e)):null}function Sl(n){let e=[],t=n.writeTree_.value;return t!=null?t.isLeafNode()||t.forEachChild(T,(i,r)=>{e.push(new C(i,r))}):n.writeTree_.children.inorderTraversal((i,r)=>{r.value!=null&&e.push(new C(i,r.value))}),e}function Re(n,e){if(v(e))return n;{let t=$e(n,e);return t!=null?new ce(new G(t)):new ce(n.writeTree_.subtree(e))}}function vs(n){return n.writeTree_.isEmpty()}function ft(n,e){return pc(w(),n.writeTree_,e)}function pc(n,e,t){if(e.value!=null)return t.updateChild(n,e.value);{let i=null;return e.children.inorderTraversal((r,s)=>{r===".priority"?(f(s.value!==null,"Priority writes must always be leaf nodes"),i=s.value):t=pc(N(n,r),s,t)}),!t.getChild(n).isEmpty()&&i!==null&&(t=t.updateChild(N(n,".priority"),i)),t}}function xi(n,e){return yc(e,n)}function tf(n,e,t,i,r){f(i>n.lastWriteId,"Stacking an older write on top of newer ones"),r===void 0&&(r=!0),n.allWrites.push({path:e,snap:t,writeId:i,visible:r}),r&&(n.visibleWrites=Xt(n.visibleWrites,e,t)),n.lastWriteId=i}function nf(n,e,t,i){f(i>n.lastWriteId,"Stacking an older merge on top of newer ones"),n.allWrites.push({path:e,children:t,writeId:i,visible:!0}),n.visibleWrites=ms(n.visibleWrites,e,t),n.lastWriteId=i}function rf(n,e){for(let t=0;t<n.allWrites.length;t++){let i=n.allWrites[t];if(i.writeId===e)return i}return null}function sf(n,e){let t=n.allWrites.findIndex(a=>a.writeId===e);f(t>=0,"removeWrite called with nonexistent writeId.");let i=n.allWrites[t];n.allWrites.splice(t,1);let r=i.visible,s=!1,o=n.allWrites.length-1;for(;r&&o>=0;){let a=n.allWrites[o];a.visible&&(o>=t&&of(a,i.path)?r=!1:te(i.path,a.path)&&(s=!0)),o--}if(r){if(s)return af(n),!0;if(i.snap)n.visibleWrites=Al(n.visibleWrites,i.path);else{let a=i.children;F(a,l=>{n.visibleWrites=Al(n.visibleWrites,N(i.path,l))})}return!0}else return!1}function of(n,e){if(n.snap)return te(n.path,e);for(let t in n.children)if(n.children.hasOwnProperty(t)&&te(N(n.path,t),e))return!0;return!1}function af(n){n.visibleWrites=_c(n.allWrites,lf,w()),n.allWrites.length>0?n.lastWriteId=n.allWrites[n.allWrites.length-1].writeId:n.lastWriteId=-1}function lf(n){return n.visible}function _c(n,e,t){let i=ce.empty();for(let r=0;r<n.length;++r){let s=n[r];if(e(s)){let o=s.path,a;if(s.snap)te(t,o)?(a=j(t,o),i=Xt(i,a,s.snap)):te(o,t)&&(a=j(o,t),i=Xt(i,w(),s.snap.getChild(a)));else if(s.children){if(te(t,o))a=j(t,o),i=ms(i,a,s.children);else if(te(o,t))if(a=j(o,t),v(a))i=ms(i,w(),s.children);else{let l=Se(s.children,y(a));if(l){let c=l.getChild(S(a));i=Xt(i,w(),c)}}}else throw Ye("WriteRecord should have .snap or .children")}}return i}function gc(n,e,t,i,r){if(!i&&!r){let s=$e(n.visibleWrites,e);if(s!=null)return s;{let o=Re(n.visibleWrites,e);if(vs(o))return t;if(t==null&&!ys(o,w()))return null;{let a=t||m.EMPTY_NODE;return ft(o,a)}}}else{let s=Re(n.visibleWrites,e);if(!r&&vs(s))return t;if(!r&&t==null&&!ys(s,w()))return null;{let o=function(c){return(c.visible||r)&&(!i||!~i.indexOf(c.writeId))&&(te(c.path,e)||te(e,c.path))},a=_c(n.allWrites,o,e),l=t||m.EMPTY_NODE;return ft(a,l)}}}function cf(n,e,t){let i=m.EMPTY_NODE,r=$e(n.visibleWrites,e);if(r)return r.isLeafNode()||r.forEachChild(T,(s,o)=>{i=i.updateImmediateChild(s,o)}),i;if(t){let s=Re(n.visibleWrites,e);return t.forEachChild(T,(o,a)=>{let l=ft(Re(s,new b(o)),a);i=i.updateImmediateChild(o,l)}),Sl(s).forEach(o=>{i=i.updateImmediateChild(o.name,o.node)}),i}else{let s=Re(n.visibleWrites,e);return Sl(s).forEach(o=>{i=i.updateImmediateChild(o.name,o.node)}),i}}function uf(n,e,t,i,r){f(i||r,"Either existingEventSnap or existingServerSnap must exist");let s=N(e,t);if(ys(n.visibleWrites,s))return null;{let o=Re(n.visibleWrites,s);return vs(o)?r.getChild(t):ft(o,r.getChild(t))}}function hf(n,e,t,i){let r=N(e,t),s=$e(n.visibleWrites,r);if(s!=null)return s;if(i.isCompleteForChild(t)){let o=Re(n.visibleWrites,r);return ft(o,i.getNode().getImmediateChild(t))}else return null}function df(n,e){return $e(n.visibleWrites,e)}function ff(n,e,t,i,r,s,o){let a,l=Re(n.visibleWrites,e),c=$e(l,w());if(c!=null)a=c;else if(t!=null)a=ft(l,t);else return[];if(a=a.withIndex(o),!a.isEmpty()&&!a.isLeafNode()){let u=[],h=o.getCompare(),d=s?a.getReverseIteratorFrom(i,o):a.getIteratorFrom(i,o),p=d.getNext();for(;p&&u.length<r;)h(p,i)!==0&&u.push(p),p=d.getNext();return u}else return[]}function pf(){return{visibleWrites:ce.empty(),allWrites:[],lastWriteId:-1}}function mi(n,e,t,i){return gc(n.writeTree,n.treePath,e,t,i)}function io(n,e){return cf(n.writeTree,n.treePath,e)}function Tl(n,e,t,i){return uf(n.writeTree,n.treePath,e,t,i)}function yi(n,e){return df(n.writeTree,N(n.treePath,e))}function _f(n,e,t,i,r,s){return ff(n.writeTree,n.treePath,e,t,i,r,s)}function ro(n,e,t){return hf(n.writeTree,n.treePath,e,t)}function mc(n,e){return yc(N(n.treePath,e),n.writeTree)}function yc(n,e){return{treePath:n,writeTree:e}}var Cs=class{constructor(){this.changeMap=new Map}trackChildChange(e){let t=e.type,i=e.childName;f(t==="child_added"||t==="child_changed"||t==="child_removed","Only child changes supported for tracking"),f(i!==".priority","Only non-priority child changes can be tracked.");let r=this.changeMap.get(i);if(r){let s=r.type;if(t==="child_added"&&s==="child_removed")this.changeMap.set(i,rn(i,e.snapshotNode,r.snapshotNode));else if(t==="child_removed"&&s==="child_added")this.changeMap.delete(i);else if(t==="child_removed"&&s==="child_changed")this.changeMap.set(i,nn(i,r.oldSnap));else if(t==="child_changed"&&s==="child_added")this.changeMap.set(i,ht(i,e.snapshotNode));else if(t==="child_changed"&&s==="child_changed")this.changeMap.set(i,rn(i,e.snapshotNode,r.oldSnap));else throw Ye("Illegal combination of changes: "+e+" occurred after "+r)}else this.changeMap.set(i,e)}getChanges(){return Array.from(this.changeMap.values())}};var Es=class{getCompleteChild(e){return null}getChildAfterChild(e,t,i){return null}},vc=new Es,ln=class{constructor(e,t,i=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=i}getCompleteChild(e){let t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);{let i=this.optCompleteServerCache_!=null?new ge(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return ro(this.writes_,e,i)}}getChildAfterChild(e,t,i){let r=this.optCompleteServerCache_!=null?this.optCompleteServerCache_:Ge(this.viewCache_),s=_f(this.writes_,r,t,1,i,e);return s.length===0?null:s[0]}};function gf(n){return{filter:n}}function mf(n,e){f(e.eventCache.getNode().isIndexed(n.filter.getIndex()),"Event snap not indexed"),f(e.serverCache.getNode().isIndexed(n.filter.getIndex()),"Server snap not indexed")}function yf(n,e,t,i,r){let s=new Cs,o,a;if(t.type===fe.OVERWRITE){let c=t;c.source.fromUser?o=ws(n,e,c.path,c.snap,i,r,s):(f(c.source.fromServer,"Unknown source."),a=c.source.tagged||e.serverCache.isFiltered()&&!v(c.path),o=vi(n,e,c.path,c.snap,i,r,a,s))}else if(t.type===fe.MERGE){let c=t;c.source.fromUser?o=Cf(n,e,c.path,c.children,i,r,s):(f(c.source.fromServer,"Unknown source."),a=c.source.tagged||e.serverCache.isFiltered(),o=bs(n,e,c.path,c.children,i,r,a,s))}else if(t.type===fe.ACK_USER_WRITE){let c=t;c.revert?o=bf(n,e,c.path,i,r,s):o=Ef(n,e,c.path,c.affectedTree,i,r,s)}else if(t.type===fe.LISTEN_COMPLETE)o=wf(n,e,t.path,i,s);else throw Ye("Unknown operation type: "+t.type);let l=s.getChanges();return vf(e,o,l),{viewCache:o,changes:l}}function vf(n,e,t){let i=e.eventCache;if(i.isFullyInitialized()){let r=i.getNode().isLeafNode()||i.getNode().isEmpty(),s=gi(n);(t.length>0||!n.eventCache.isFullyInitialized()||r&&!i.getNode().equals(s)||!i.getNode().getPriority().equals(s.getPriority()))&&t.push(dc(gi(e)))}}function Cc(n,e,t,i,r,s){let o=e.eventCache;if(yi(i,t)!=null)return e;{let a,l;if(v(t))if(f(e.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),e.serverCache.isFiltered()){let c=Ge(e),u=c instanceof m?c:m.EMPTY_NODE,h=io(i,u);a=n.filter.updateFullNode(e.eventCache.getNode(),h,s)}else{let c=mi(i,Ge(e));a=n.filter.updateFullNode(e.eventCache.getNode(),c,s)}else{let c=y(t);if(c===".priority"){f(xe(t)===1,"Can't have a priority with additional path components");let u=o.getNode();l=e.serverCache.getNode();let h=Tl(i,t,u,l);h!=null?a=n.filter.updatePriority(u,h):a=o.getNode()}else{let u=S(t),h;if(o.isCompleteForChild(c)){l=e.serverCache.getNode();let d=Tl(i,t,o.getNode(),l);d!=null?h=o.getNode().getImmediateChild(c).updateChild(u,d):h=o.getNode().getImmediateChild(c)}else h=ro(i,c,e.serverCache);h!=null?a=n.filter.updateChild(o.getNode(),c,h,u,r,s):a=o.getNode()}}return Qt(e,a,o.isFullyInitialized()||v(t),n.filter.filtersNodes())}}function vi(n,e,t,i,r,s,o,a){let l=e.serverCache,c,u=o?n.filter:n.filter.getIndexedFilter();if(v(t))c=u.updateFullNode(l.getNode(),i,null);else if(u.filtersNodes()&&!l.isFiltered()){let p=l.getNode().updateChild(t,i);c=u.updateFullNode(l.getNode(),p,null)}else{let p=y(t);if(!l.isCompleteForPath(t)&&xe(t)>1)return e;let _=S(t),A=l.getNode().getImmediateChild(p).updateChild(_,i);p===".priority"?c=u.updatePriority(l.getNode(),A):c=u.updateChild(l.getNode(),p,A,_,vc,null)}let h=fc(e,c,l.isFullyInitialized()||v(t),u.filtersNodes()),d=new ln(r,h,s);return Cc(n,h,t,r,d,a)}function ws(n,e,t,i,r,s,o){let a=e.eventCache,l,c,u=new ln(r,e,s);if(v(t))c=n.filter.updateFullNode(e.eventCache.getNode(),i,o),l=Qt(e,c,!0,n.filter.filtersNodes());else{let h=y(t);if(h===".priority")c=n.filter.updatePriority(e.eventCache.getNode(),i),l=Qt(e,c,a.isFullyInitialized(),a.isFiltered());else{let d=S(t),p=a.getNode().getImmediateChild(h),_;if(v(d))_=i;else{let E=u.getCompleteChild(h);E!=null?Ys(d)===".priority"&&E.getChild(oc(d)).isEmpty()?_=E:_=E.updateChild(d,i):_=m.EMPTY_NODE}if(p.equals(_))l=e;else{let E=n.filter.updateChild(a.getNode(),h,_,d,u,o);l=Qt(e,E,a.isFullyInitialized(),n.filter.filtersNodes())}}}return l}function Dl(n,e){return n.eventCache.isCompleteForChild(e)}function Cf(n,e,t,i,r,s,o){let a=e;return i.foreach((l,c)=>{let u=N(t,l);Dl(e,y(u))&&(a=ws(n,a,u,c,r,s,o))}),i.foreach((l,c)=>{let u=N(t,l);Dl(e,y(u))||(a=ws(n,a,u,c,r,s,o))}),a}function Nl(n,e,t){return t.foreach((i,r)=>{e=e.updateChild(i,r)}),e}function bs(n,e,t,i,r,s,o,a){if(e.serverCache.getNode().isEmpty()&&!e.serverCache.isFullyInitialized())return e;let l=e,c;v(t)?c=i:c=new G(null).setTree(t,i);let u=e.serverCache.getNode();return c.children.inorderTraversal((h,d)=>{if(u.hasChild(h)){let p=e.serverCache.getNode().getImmediateChild(h),_=Nl(n,p,d);l=vi(n,l,new b(h),_,r,s,o,a)}}),c.children.inorderTraversal((h,d)=>{let p=!e.serverCache.isCompleteForChild(h)&&d.value===null;if(!u.hasChild(h)&&!p){let _=e.serverCache.getNode().getImmediateChild(h),E=Nl(n,_,d);l=vi(n,l,new b(h),E,r,s,o,a)}}),l}function Ef(n,e,t,i,r,s,o){if(yi(r,t)!=null)return e;let a=e.serverCache.isFiltered(),l=e.serverCache;if(i.value!=null){if(v(t)&&l.isFullyInitialized()||l.isCompleteForPath(t))return vi(n,e,t,l.getNode().getChild(t),r,s,a,o);if(v(t)){let c=new G(null);return l.getNode().forEachChild(pe,(u,h)=>{c=c.set(new b(u),h)}),bs(n,e,t,c,r,s,a,o)}else return e}else{let c=new G(null);return i.foreach((u,h)=>{let d=N(t,u);l.isCompleteForPath(d)&&(c=c.set(u,l.getNode().getChild(d)))}),bs(n,e,t,c,r,s,a,o)}}function wf(n,e,t,i,r){let s=e.serverCache,o=fc(e,s.getNode(),s.isFullyInitialized()||v(t),s.isFiltered());return Cc(n,o,t,i,vc,r)}function bf(n,e,t,i,r,s){let o;if(yi(i,t)!=null)return e;{let a=new ln(i,e,r),l=e.eventCache.getNode(),c;if(v(t)||y(t)===".priority"){let u;if(e.serverCache.isFullyInitialized())u=mi(i,Ge(e));else{let h=e.serverCache.getNode();f(h instanceof m,"serverChildren would be complete if leaf node"),u=io(i,h)}u=u,c=n.filter.updateFullNode(l,u,s)}else{let u=y(t),h=ro(i,u,e.serverCache);h==null&&e.serverCache.isCompleteForChild(u)&&(h=l.getImmediateChild(u)),h!=null?c=n.filter.updateChild(l,u,h,S(t),a,s):e.eventCache.getNode().hasChild(u)?c=n.filter.updateChild(l,u,m.EMPTY_NODE,S(t),a,s):c=l,c.isEmpty()&&e.serverCache.isFullyInitialized()&&(o=mi(i,Ge(e)),o.isLeafNode()&&(c=n.filter.updateFullNode(c,o,s)))}return o=e.serverCache.isFullyInitialized()||yi(i,w())!=null,Qt(e,c,o,n.filter.filtersNodes())}}var Is=class{constructor(e,t){this.query_=e,this.eventRegistrations_=[];let i=this.query_._queryParams,r=new sn(i.getIndex()),s=Gd(i);this.processor_=gf(s);let o=t.serverCache,a=t.eventCache,l=r.updateFullNode(m.EMPTY_NODE,o.getNode(),null),c=s.updateFullNode(m.EMPTY_NODE,a.getNode(),null),u=new ge(l,o.isFullyInitialized(),r.filtersNodes()),h=new ge(c,a.isFullyInitialized(),s.filtersNodes());this.viewCache_=Mi(h,u),this.eventGenerator_=new gs(this.query_)}get query(){return this.query_}};function If(n){return n.viewCache_.serverCache.getNode()}function Af(n){return gi(n.viewCache_)}function Sf(n,e){let t=Ge(n.viewCache_);return t&&(n.query._queryParams.loadsAllData()||!v(e)&&!t.getImmediateChild(y(e)).isEmpty())?t.getChild(e):null}function kl(n){return n.eventRegistrations_.length===0}function Tf(n,e){n.eventRegistrations_.push(e)}function Rl(n,e,t){let i=[];if(t){f(e==null,"A cancel should cancel all event registrations.");let r=n.query._path;n.eventRegistrations_.forEach(s=>{let o=s.createCancelEvent(t,r);o&&i.push(o)})}if(e){let r=[];for(let s=0;s<n.eventRegistrations_.length;++s){let o=n.eventRegistrations_[s];if(!o.matches(e))r.push(o);else if(e.hasAnyCallback()){r=r.concat(n.eventRegistrations_.slice(s+1));break}}n.eventRegistrations_=r}else n.eventRegistrations_=[];return i}function Pl(n,e,t,i){e.type===fe.MERGE&&e.source.queryId!==null&&(f(Ge(n.viewCache_),"We should always have a full cache before handling merges"),f(gi(n.viewCache_),"Missing event cache, even though we have a server cache"));let r=n.viewCache_,s=yf(n.processor_,r,e,t,i);return mf(n.processor_,s.viewCache),f(s.viewCache.serverCache.isFullyInitialized()||!r.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),n.viewCache_=s.viewCache,Ec(n,s.changes,s.viewCache.eventCache.getNode(),null)}function Df(n,e){let t=n.viewCache_.eventCache,i=[];return t.getNode().isLeafNode()||t.getNode().forEachChild(T,(s,o)=>{i.push(ht(s,o))}),t.isFullyInitialized()&&i.push(dc(t.getNode())),Ec(n,i,t.getNode(),e)}function Ec(n,e,t,i){let r=i?[i]:n.eventRegistrations_;return Xd(n.eventGenerator_,e,t,r)}var Ci,Ei=class{constructor(){this.views=new Map}};function Nf(n){f(!Ci,"__referenceConstructor has already been defined"),Ci=n}function kf(){return f(Ci,"Reference.ts has not been loaded"),Ci}function Rf(n){return n.views.size===0}function so(n,e,t,i){let r=e.source.queryId;if(r!==null){let s=n.views.get(r);return f(s!=null,"SyncTree gave us an op for an invalid query."),Pl(s,e,t,i)}else{let s=[];for(let o of n.views.values())s=s.concat(Pl(o,e,t,i));return s}}function wc(n,e,t,i,r){let s=e._queryIdentifier,o=n.views.get(s);if(!o){let a=mi(t,r?i:null),l=!1;a?l=!0:i instanceof m?(a=io(t,i),l=!1):(a=m.EMPTY_NODE,l=!1);let c=Mi(new ge(a,l,!1),new ge(i,r,!1));return new Is(e,c)}return o}function Pf(n,e,t,i,r,s){let o=wc(n,e,i,r,s);return n.views.has(e._queryIdentifier)||n.views.set(e._queryIdentifier,o),Tf(o,t),Df(o,t)}function Mf(n,e,t,i){let r=e._queryIdentifier,s=[],o=[],a=Fe(n);if(r==="default")for(let[l,c]of n.views.entries())o=o.concat(Rl(c,t,i)),kl(c)&&(n.views.delete(l),c.query._queryParams.loadsAllData()||s.push(c.query));else{let l=n.views.get(r);l&&(o=o.concat(Rl(l,t,i)),kl(l)&&(n.views.delete(r),l.query._queryParams.loadsAllData()||s.push(l.query)))}return a&&!Fe(n)&&s.push(new(kf())(e._repo,e._path)),{removed:s,events:o}}function bc(n){let e=[];for(let t of n.views.values())t.query._queryParams.loadsAllData()||e.push(t);return e}function Pe(n,e){let t=null;for(let i of n.views.values())t=t||Sf(i,e);return t}function Ic(n,e){if(e._queryParams.loadsAllData())return Fi(n);{let i=e._queryIdentifier;return n.views.get(i)}}function Ac(n,e){return Ic(n,e)!=null}function Fe(n){return Fi(n)!=null}function Fi(n){for(let e of n.views.values())if(e.query._queryParams.loadsAllData())return e;return null}var wi;function xf(n){f(!wi,"__referenceConstructor has already been defined"),wi=n}function Ff(){return f(wi,"Reference.ts has not been loaded"),wi}var Of=1,bi=class{constructor(e){this.listenProvider_=e,this.syncPointTree_=new G(null),this.pendingWriteTree_=pf(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}};function oo(n,e,t,i,r){return tf(n.pendingWriteTree_,e,t,i,r),r?yt(n,new dt(eo(),e,t)):[]}function Vf(n,e,t,i){nf(n.pendingWriteTree_,e,t,i);let r=G.fromObject(t);return yt(n,new an(eo(),e,r))}function ke(n,e,t=!1){let i=rf(n.pendingWriteTree_,e);if(sf(n.pendingWriteTree_,e)){let s=new G(null);return i.snap!=null?s=s.set(w(),!0):F(i.children,o=>{s=s.set(new b(o),!0)}),yt(n,new _s(i.path,s,t))}else return[]}function mn(n,e,t){return yt(n,new dt(to(),e,t))}function Lf(n,e,t){let i=G.fromObject(t);return yt(n,new an(to(),e,i))}function Uf(n,e){return yt(n,new _i(to(),e))}function Bf(n,e,t){let i=ao(n,t);if(i){let r=lo(i),s=r.path,o=r.queryId,a=j(s,e),l=new _i(no(o),a);return co(n,s,l)}else return[]}function Ii(n,e,t,i,r=!1){let s=e._path,o=n.syncPointTree_.get(s),a=[];if(o&&(e._queryIdentifier==="default"||Ac(o,e))){let l=Mf(o,e,t,i);Rf(o)&&(n.syncPointTree_=n.syncPointTree_.remove(s));let c=l.removed;if(a=l.events,!r){let u=c.findIndex(d=>d._queryParams.loadsAllData())!==-1,h=n.syncPointTree_.findOnPath(s,(d,p)=>Fe(p));if(u&&!h){let d=n.syncPointTree_.subtree(s);if(!d.isEmpty()){let p=Gf(d);for(let _=0;_<p.length;++_){let E=p[_],A=E.query,K=Nc(n,E);n.listenProvider_.startListening(Jt(A),cn(n,A),K.hashFn,K.onComplete)}}}!h&&c.length>0&&!i&&(u?n.listenProvider_.stopListening(Jt(e),null):c.forEach(d=>{let p=n.queryToTagMap.get(Vi(d));n.listenProvider_.stopListening(Jt(d),p)}))}Hf(n,c)}return a}function Sc(n,e,t,i){let r=ao(n,i);if(r!=null){let s=lo(r),o=s.path,a=s.queryId,l=j(o,e),c=new dt(no(a),l,t);return co(n,o,c)}else return[]}function Wf(n,e,t,i){let r=ao(n,i);if(r){let s=lo(r),o=s.path,a=s.queryId,l=j(o,e),c=G.fromObject(t),u=new an(no(a),l,c);return co(n,o,u)}else return[]}function As(n,e,t,i=!1){let r=e._path,s=null,o=!1;n.syncPointTree_.foreachOnPath(r,(d,p)=>{let _=j(d,r);s=s||Pe(p,_),o=o||Fe(p)});let a=n.syncPointTree_.get(r);a?(o=o||Fe(a),s=s||Pe(a,w())):(a=new Ei,n.syncPointTree_=n.syncPointTree_.set(r,a));let l;s!=null?l=!0:(l=!1,s=m.EMPTY_NODE,n.syncPointTree_.subtree(r).foreachChild((p,_)=>{let E=Pe(_,w());E&&(s=s.updateImmediateChild(p,E))}));let c=Ac(a,e);if(!c&&!e._queryParams.loadsAllData()){let d=Vi(e);f(!n.queryToTagMap.has(d),"View does not exist, but we have a tag");let p=$f();n.queryToTagMap.set(d,p),n.tagToQueryMap.set(p,d)}let u=xi(n.pendingWriteTree_,r),h=Pf(a,e,t,u,s,l);if(!c&&!o&&!i){let d=Ic(a,e);h=h.concat(Kf(n,e,d))}return h}function Oi(n,e,t){let r=n.pendingWriteTree_,s=n.syncPointTree_.findOnPath(e,(o,a)=>{let l=j(o,e),c=Pe(a,l);if(c)return c});return gc(r,e,s,t,!0)}function jf(n,e){let t=e._path,i=null;n.syncPointTree_.foreachOnPath(t,(c,u)=>{let h=j(c,t);i=i||Pe(u,h)});let r=n.syncPointTree_.get(t);r?i=i||Pe(r,w()):(r=new Ei,n.syncPointTree_=n.syncPointTree_.set(t,r));let s=i!=null,o=s?new ge(i,!0,!1):null,a=xi(n.pendingWriteTree_,e._path),l=wc(r,e,a,s?o.getNode():m.EMPTY_NODE,s);return Af(l)}function yt(n,e){return Tc(e,n.syncPointTree_,null,xi(n.pendingWriteTree_,w()))}function Tc(n,e,t,i){if(v(n.path))return Dc(n,e,t,i);{let r=e.get(w());t==null&&r!=null&&(t=Pe(r,w()));let s=[],o=y(n.path),a=n.operationForChild(o),l=e.children.get(o);if(l&&a){let c=t?t.getImmediateChild(o):null,u=mc(i,o);s=s.concat(Tc(a,l,c,u))}return r&&(s=s.concat(so(r,n,i,t))),s}}function Dc(n,e,t,i){let r=e.get(w());t==null&&r!=null&&(t=Pe(r,w()));let s=[];return e.children.inorderTraversal((o,a)=>{let l=t?t.getImmediateChild(o):null,c=mc(i,o),u=n.operationForChild(o);u&&(s=s.concat(Dc(u,a,l,c)))}),r&&(s=s.concat(so(r,n,i,t))),s}function Nc(n,e){let t=e.query,i=cn(n,t);return{hashFn:()=>(If(e)||m.EMPTY_NODE).hash(),onComplete:r=>{if(r==="ok")return i?Bf(n,t._path,i):Uf(n,t._path);{let s=td(r,t);return Ii(n,t,null,s)}}}}function cn(n,e){let t=Vi(e);return n.queryToTagMap.get(t)}function Vi(n){return n._path.toString()+"$"+n._queryIdentifier}function ao(n,e){return n.tagToQueryMap.get(e)}function lo(n){let e=n.indexOf("$");return f(e!==-1&&e<n.length-1,"Bad queryKey."),{queryId:n.substr(e+1),path:new b(n.substr(0,e))}}function co(n,e,t){let i=n.syncPointTree_.get(e);f(i,"Missing sync point for query tag that we're tracking");let r=xi(n.pendingWriteTree_,e);return so(i,t,r,null)}function Gf(n){return n.fold((e,t,i)=>{if(t&&Fe(t))return[Fi(t)];{let r=[];return t&&(r=bc(t)),F(i,(s,o)=>{r=r.concat(o)}),r}})}function Jt(n){return n._queryParams.loadsAllData()&&!n._queryParams.isDefault()?new(Ff())(n._repo,n._path):n}function Hf(n,e){for(let t=0;t<e.length;++t){let i=e[t];if(!i._queryParams.loadsAllData()){let r=Vi(i),s=n.queryToTagMap.get(r);n.queryToTagMap.delete(r),n.tagToQueryMap.delete(s)}}}function $f(){return Of++}function Kf(n,e,t){let i=e._path,r=cn(n,e),s=Nc(n,t),o=n.listenProvider_.startListening(Jt(e),r,s.hashFn,s.onComplete),a=n.syncPointTree_.subtree(i);if(r)f(!Fe(a.value),"If we're adding a query, it shouldn't be shadowed");else{let l=a.fold((c,u,h)=>{if(!v(c)&&u&&Fe(u))return[Fi(u).query];{let d=[];return u&&(d=d.concat(bc(u).map(p=>p.query))),F(h,(p,_)=>{d=d.concat(_)}),d}});for(let c=0;c<l.length;++c){let u=l[c];n.listenProvider_.stopListening(Jt(u),cn(n,u))}}return o}var Ss=class n{constructor(e){this.node_=e}getImmediateChild(e){let t=this.node_.getImmediateChild(e);return new n(t)}node(){return this.node_}},Ts=class n{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){let t=N(this.path_,e);return new n(this.syncTree_,t)}node(){return Oi(this.syncTree_,this.path_)}},qf=function(n){return n=n||{},n.timestamp=n.timestamp||new Date().getTime(),n},Ml=function(n,e,t){if(!n||typeof n!="object")return n;if(f(".sv"in n,"Unexpected leaf node or priority contents"),typeof n[".sv"]=="string")return zf(n[".sv"],e,t);if(typeof n[".sv"]=="object")return Yf(n[".sv"],e);f(!1,"Unexpected server value: "+JSON.stringify(n,null,2))},zf=function(n,e,t){switch(n){case"timestamp":return t.timestamp;default:f(!1,"Unexpected server value: "+n)}},Yf=function(n,e,t){n.hasOwnProperty("increment")||f(!1,"Unexpected server value: "+JSON.stringify(n,null,2));let i=n.increment;typeof i!="number"&&f(!1,"Unexpected increment value: "+i);let r=e.node();if(f(r!==null&&typeof r<"u","Expected ChildrenNode.EMPTY_NODE for nulls"),!r.isLeafNode())return i;let o=r.getValue();return typeof o!="number"?i:o+i},kc=function(n,e,t,i){return ho(e,new Ts(t,n),i)},uo=function(n,e,t){return ho(n,new Ss(e),t)};function ho(n,e,t){let i=n.getPriority().val(),r=Ml(i,e.getImmediateChild(".priority"),t),s;if(n.isLeafNode()){let o=n,a=Ml(o.getValue(),e,t);return a!==o.getValue()||r!==o.getPriority().val()?new ct(a,k(r)):n}else{let o=n;return s=o,r!==o.getPriority().val()&&(s=s.updatePriority(new ct(r))),o.forEachChild(T,(a,l)=>{let c=ho(l,e.getImmediateChild(a),t);c!==l&&(s=s.updateImmediateChild(a,c))}),s}}var un=class{constructor(e="",t=null,i={children:{},childCount:0}){this.name=e,this.parent=t,this.node=i}};function Li(n,e){let t=e instanceof b?e:new b(e),i=n,r=y(t);for(;r!==null;){let s=Se(i.node.children,r)||{children:{},childCount:0};i=new un(r,i,s),t=S(t),r=y(t)}return i}function Ke(n){return n.node.value}function fo(n,e){n.node.value=e,Ds(n)}function Rc(n){return n.node.childCount>0}function Qf(n){return Ke(n)===void 0&&!Rc(n)}function Ui(n,e){F(n.node.children,(t,i)=>{e(new un(t,n,i))})}function Pc(n,e,t,i){t&&!i&&e(n),Ui(n,r=>{Pc(r,e,!0,i)}),t&&i&&e(n)}function Xf(n,e,t){let i=t?n:n.parent;for(;i!==null;){if(e(i))return!0;i=i.parent}return!1}function yn(n){return new b(n.parent===null?n.name:yn(n.parent)+"/"+n.name)}function Ds(n){n.parent!==null&&Jf(n.parent,n.name,n)}function Jf(n,e,t){let i=Qf(t),r=ee(n.node.children,e);i&&r?(delete n.node.children[e],n.node.childCount--,Ds(n)):!i&&!r&&(n.node.children[e]=t.node,n.node.childCount++,Ds(n))}var Zf=/[\[\].#$\/\u0000-\u001F\u007F]/,ep=/[\[\].#$\u0000-\u001F\u007F]/,Ur=10*1024*1024,Bi=function(n){return typeof n=="string"&&n.length!==0&&!Zf.test(n)},Mc=function(n){return typeof n=="string"&&n.length!==0&&!ep.test(n)},tp=function(n){return n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),Mc(n)},hn=function(n){return n===null||typeof n=="string"||typeof n=="number"&&!Ri(n)||n&&typeof n=="object"&&ee(n,".sv")},me=function(n,e,t,i){i&&e===void 0||vn($(n,"value"),e,t)},vn=function(n,e,t){let i=t instanceof b?new Jr(t,n):t;if(e===void 0)throw new Error(n+"contains undefined "+Be(i));if(typeof e=="function")throw new Error(n+"contains a function "+Be(i)+" with contents = "+e.toString());if(Ri(e))throw new Error(n+"contains "+e.toString()+" "+Be(i));if(typeof e=="string"&&e.length>Ur/3&&xt(e)>Ur)throw new Error(n+"contains a string greater than "+Ur+" utf8 bytes "+Be(i)+" ('"+e.substring(0,50)+"...')");if(e&&typeof e=="object"){let r=!1,s=!1;if(F(e,(o,a)=>{if(o===".value")r=!0;else if(o!==".priority"&&o!==".sv"&&(s=!0,!Bi(o)))throw new Error(n+" contains an invalid key ("+o+") "+Be(i)+`.  Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`);kd(i,o),vn(n,a,i),Rd(i)}),r&&s)throw new Error(n+' contains ".value" child '+Be(i)+" in addition to actual children.")}},np=function(n,e){let t,i;for(t=0;t<e.length;t++){i=e[t];let s=en(i);for(let o=0;o<s.length;o++)if(!(s[o]===".priority"&&o===s.length-1)){if(!Bi(s[o]))throw new Error(n+"contains an invalid key ("+s[o]+") in path "+i.toString()+`. Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`)}}e.sort(Nd);let r=null;for(t=0;t<e.length;t++){if(i=e[t],r!==null&&te(r,i))throw new Error(n+"contains a path "+r.toString()+" that is ancestor of another path "+i.toString());r=i}},xc=function(n,e,t,i){if(i&&e===void 0)return;let r=$(n,"values");if(!(e&&typeof e=="object")||Array.isArray(e))throw new Error(r+" must be an object containing the children to replace.");let s=[];F(e,(o,a)=>{let l=new b(o);if(vn(r,a,N(t,l)),Ys(l)===".priority"&&!hn(a))throw new Error(r+"contains an invalid value for '"+l.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");s.push(l)}),np(r,s)},po=function(n,e,t){if(!(t&&e===void 0)){if(Ri(e))throw new Error($(n,"priority")+"is "+e.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!hn(e))throw new Error($(n,"priority")+"must be a valid Firebase priority (a string, finite number, server value, or null).")}},Cn=function(n,e,t,i){if(!(i&&t===void 0)&&!Bi(t))throw new Error($(n,e)+'was an invalid key = "'+t+`".  Firebase keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]").`)},vt=function(n,e,t,i){if(!(i&&t===void 0)&&!Mc(t))throw new Error($(n,e)+'was an invalid path = "'+t+`". Paths must be non-empty strings and can't contain ".", "#", "$", "[", or "]"`)},ip=function(n,e,t,i){t&&(t=t.replace(/^\/*\.info(\/|$)/,"/")),vt(n,e,t,i)},Y=function(n,e){if(y(e)===".info")throw new Error(n+" failed = Can't modify data under /.info/")},Fc=function(n,e){let t=e.path.toString();if(typeof e.repoInfo.host!="string"||e.repoInfo.host.length===0||!Bi(e.repoInfo.namespace)&&e.repoInfo.host.split(":")[0]!=="localhost"||t.length!==0&&!tp(t))throw new Error($(n,"url")+`must be a valid firebase URL and the path can't contain ".", "#", "$", "[", or "]".`)};var Ns=class{constructor(){this.eventLists_=[],this.recursionDepth_=0}};function Wi(n,e){let t=null;for(let i=0;i<e.length;i++){let r=e[i],s=r.getPath();t!==null&&!Qs(s,t.path)&&(n.eventLists_.push(t),t=null),t===null&&(t={events:[],path:s}),t.events.push(r)}t&&n.eventLists_.push(t)}function Oc(n,e,t){Wi(n,t),Vc(n,i=>Qs(i,e))}function Q(n,e,t){Wi(n,t),Vc(n,i=>te(i,e)||te(e,i))}function Vc(n,e){n.recursionDepth_++;let t=!0;for(let i=0;i<n.eventLists_.length;i++){let r=n.eventLists_[i];if(r){let s=r.path;e(s)?(rp(n.eventLists_[i]),n.eventLists_[i]=null):t=!1}}t&&(n.eventLists_=[]),n.recursionDepth_--}function rp(n){for(let e=0;e<n.events.length;e++){let t=n.events[e];if(t!==null){n.events[e]=null;let i=t.getEventRunner();je&&x("event: "+t.toString()),gt(i)}}}var Lc="repo_interrupt",sp=25,ks=class{constructor(e,t,i,r){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=i,this.appCheckProvider_=r,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new Ns,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=pi(),this.transactionQueueTree_=new un,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}};function op(n,e,t){if(n.stats_=zs(n.repoInfo_),n.forceRestClient_||sd())n.server_=new cs(n.repoInfo_,(i,r,s,o)=>{xl(n,i,r,s,o)},n.authTokenProvider_,n.appCheckProvider_),setTimeout(()=>Fl(n,!0),0);else{if(typeof t<"u"&&t!==null){if(typeof t!="object")throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{R(t)}catch(i){throw new Error("Invalid authOverride provided: "+i)}}n.persistentConnection_=new Xs(n.repoInfo_,e,(i,r,s,o)=>{xl(n,i,r,s,o)},i=>{Fl(n,i)},i=>{ap(n,i)},n.authTokenProvider_,n.appCheckProvider_,t),n.server_=n.persistentConnection_}n.authTokenProvider_.addTokenChangeListener(i=>{n.server_.refreshAuthToken(i)}),n.appCheckProvider_.addTokenChangeListener(i=>{n.server_.refreshAppCheckToken(i.token)}),n.statsReporter_=ad(n.repoInfo_,()=>new ps(n.stats_,n.server_)),n.infoData_=new us,n.infoSyncTree_=new bi({startListening:(i,r,s,o)=>{let a=[],l=n.infoData_.getNode(i._path);return l.isEmpty()||(a=mn(n.infoSyncTree_,i._path,l),setTimeout(()=>{o("ok")},0)),a},stopListening:()=>{}}),_o(n,"connected",!1),n.serverSyncTree_=new bi({startListening:(i,r,s,o)=>(n.server_.listen(i,s,r,(a,l)=>{let c=o(a,l);Q(n.eventQueue_,i._path,c)}),[]),stopListening:(i,r)=>{n.server_.unlisten(i,r)}})}function Uc(n){let t=n.infoData_.getNode(new b(".info/serverTimeOffset")).val()||0;return new Date().getTime()+t}function En(n){return qf({timestamp:Uc(n)})}function xl(n,e,t,i,r){n.dataUpdateCount++;let s=new b(e);t=n.interceptServerDataCallback_?n.interceptServerDataCallback_(e,t):t;let o=[];if(r)if(i){let l=Mt(t,c=>k(c));o=Wf(n.serverSyncTree_,s,l,r)}else{let l=k(t);o=Sc(n.serverSyncTree_,s,l,r)}else if(i){let l=Mt(t,c=>k(c));o=Lf(n.serverSyncTree_,s,l)}else{let l=k(t);o=mn(n.serverSyncTree_,s,l)}let a=s;o.length>0&&(a=pt(n,s)),Q(n.eventQueue_,a,o)}function Fl(n,e){_o(n,"connected",e),e===!1&&up(n)}function ap(n,e){F(e,(t,i)=>{_o(n,t,i)})}function _o(n,e,t){let i=new b("/.info/"+e),r=k(t);n.infoData_.updateSnapshot(i,r);let s=mn(n.infoSyncTree_,i,r);Q(n.eventQueue_,i,s)}function ji(n){return n.nextWriteId_++}function lp(n,e,t){let i=jf(n.serverSyncTree_,e);return i!=null?Promise.resolve(i):n.server_.get(e).then(r=>{let s=k(r).withIndex(e._queryParams.getIndex());As(n.serverSyncTree_,e,t,!0);let o;if(e._queryParams.loadsAllData())o=mn(n.serverSyncTree_,e._path,s);else{let a=cn(n.serverSyncTree_,e);o=Sc(n.serverSyncTree_,e._path,s,a)}return Q(n.eventQueue_,e._path,o),Ii(n.serverSyncTree_,e,t,null,!0),s},r=>(Ct(n,"get for query "+R(e)+" failed: "+r),Promise.reject(new Error(r))))}function go(n,e,t,i,r){Ct(n,"set",{path:e.toString(),value:t,priority:i});let s=En(n),o=k(t,i),a=Oi(n.serverSyncTree_,e),l=uo(o,a,s),c=ji(n),u=oo(n.serverSyncTree_,e,l,c,!0);Wi(n.eventQueue_,u),n.server_.put(e.toString(),o.val(!0),(d,p)=>{let _=d==="ok";_||U("set at "+e+" failed: "+d);let E=ke(n.serverSyncTree_,c,!_);Q(n.eventQueue_,e,E),Oe(n,r,d,p)});let h=yo(n,e);pt(n,h),Q(n.eventQueue_,h,[])}function cp(n,e,t,i){Ct(n,"update",{path:e.toString(),value:t});let r=!0,s=En(n),o={};if(F(t,(a,l)=>{r=!1,o[a]=kc(N(e,a),k(l),n.serverSyncTree_,s)}),r)x("update() called with empty data.  Don't do anything."),Oe(n,i,"ok",void 0);else{let a=ji(n),l=Vf(n.serverSyncTree_,e,o,a);Wi(n.eventQueue_,l),n.server_.merge(e.toString(),t,(c,u)=>{let h=c==="ok";h||U("update at "+e+" failed: "+c);let d=ke(n.serverSyncTree_,a,!h),p=d.length>0?pt(n,e):e;Q(n.eventQueue_,p,d),Oe(n,i,c,u)}),F(t,c=>{let u=yo(n,N(e,c));pt(n,u)}),Q(n.eventQueue_,e,[])}}function up(n){Ct(n,"onDisconnectEvents");let e=En(n),t=pi();ds(n.onDisconnect_,w(),(r,s)=>{let o=kc(r,s,n.serverSyncTree_,e);mt(t,r,o)});let i=[];ds(t,w(),(r,s)=>{i=i.concat(mn(n.serverSyncTree_,r,s));let o=yo(n,r);pt(n,o)}),n.onDisconnect_=pi(),Q(n.eventQueue_,w(),i)}function hp(n,e,t){n.server_.onDisconnectCancel(e.toString(),(i,r)=>{i==="ok"&&hs(n.onDisconnect_,e),Oe(n,t,i,r)})}function Ol(n,e,t,i){let r=k(t);n.server_.onDisconnectPut(e.toString(),r.val(!0),(s,o)=>{s==="ok"&&mt(n.onDisconnect_,e,r),Oe(n,i,s,o)})}function dp(n,e,t,i,r){let s=k(t,i);n.server_.onDisconnectPut(e.toString(),s.val(!0),(o,a)=>{o==="ok"&&mt(n.onDisconnect_,e,s),Oe(n,r,o,a)})}function fp(n,e,t,i){if(Mn(t)){x("onDisconnect().update() called with empty data.  Don't do anything."),Oe(n,i,"ok",void 0);return}n.server_.onDisconnectMerge(e.toString(),t,(r,s)=>{r==="ok"&&F(t,(o,a)=>{let l=k(a);mt(n.onDisconnect_,N(e,o),l)}),Oe(n,i,r,s)})}function pp(n,e,t){let i;y(e._path)===".info"?i=As(n.infoSyncTree_,e,t):i=As(n.serverSyncTree_,e,t),Oc(n.eventQueue_,e._path,i)}function Rs(n,e,t){let i;y(e._path)===".info"?i=Ii(n.infoSyncTree_,e,t):i=Ii(n.serverSyncTree_,e,t),Oc(n.eventQueue_,e._path,i)}function Bc(n){n.persistentConnection_&&n.persistentConnection_.interrupt(Lc)}function _p(n){n.persistentConnection_&&n.persistentConnection_.resume(Lc)}function Ct(n,...e){let t="";n.persistentConnection_&&(t=n.persistentConnection_.id+":"),x(t,...e)}function Oe(n,e,t,i){e&&gt(()=>{if(t==="ok")e(null);else{let r=(t||"error").toUpperCase(),s=r;i&&(s+=": "+i);let o=new Error(s);o.code=r,e(o)}})}function gp(n,e,t,i,r,s){Ct(n,"transaction on "+e);let o={path:e,update:t,onComplete:i,status:null,order:Ul(),applyLocally:s,retryCount:0,unwatcher:r,abortReason:null,currentWriteId:null,currentInputSnapshot:null,currentOutputSnapshotRaw:null,currentOutputSnapshotResolved:null},a=mo(n,e,void 0);o.currentInputSnapshot=a;let l=o.update(a.val());if(l===void 0)o.unwatcher(),o.currentOutputSnapshotRaw=null,o.currentOutputSnapshotResolved=null,o.onComplete&&o.onComplete(null,!1,o.currentInputSnapshot);else{vn("transaction failed: Data returned ",l,o.path),o.status=0;let c=Li(n.transactionQueueTree_,e),u=Ke(c)||[];u.push(o),fo(c,u);let h;typeof l=="object"&&l!==null&&ee(l,".priority")?(h=Se(l,".priority"),f(hn(h),"Invalid priority returned by transaction. Priority must be a valid string, finite number, server value, or null.")):h=(Oi(n.serverSyncTree_,e)||m.EMPTY_NODE).getPriority().val();let d=En(n),p=k(l,h),_=uo(p,a,d);o.currentOutputSnapshotRaw=p,o.currentOutputSnapshotResolved=_,o.currentWriteId=ji(n);let E=oo(n.serverSyncTree_,e,_,o.currentWriteId,o.applyLocally);Q(n.eventQueue_,e,E),Gi(n,n.transactionQueueTree_)}}function mo(n,e,t){return Oi(n.serverSyncTree_,e,t)||m.EMPTY_NODE}function Gi(n,e=n.transactionQueueTree_){if(e||Hi(n,e),Ke(e)){let t=jc(n,e);f(t.length>0,"Sending zero length transaction queue"),t.every(r=>r.status===0)&&mp(n,yn(e),t)}else Rc(e)&&Ui(e,t=>{Gi(n,t)})}function mp(n,e,t){let i=t.map(c=>c.currentWriteId),r=mo(n,e,i),s=r,o=r.hash();for(let c=0;c<t.length;c++){let u=t[c];f(u.status===0,"tryToSendTransactionQueue_: items in queue should all be run."),u.status=1,u.retryCount++;let h=j(e,u.path);s=s.updateChild(h,u.currentOutputSnapshotRaw)}let a=s.val(!0),l=e;n.server_.put(l.toString(),a,c=>{Ct(n,"transaction put response",{path:l.toString(),status:c});let u=[];if(c==="ok"){let h=[];for(let d=0;d<t.length;d++)t[d].status=2,u=u.concat(ke(n.serverSyncTree_,t[d].currentWriteId)),t[d].onComplete&&h.push(()=>t[d].onComplete(null,!0,t[d].currentOutputSnapshotResolved)),t[d].unwatcher();Hi(n,Li(n.transactionQueueTree_,e)),Gi(n,n.transactionQueueTree_),Q(n.eventQueue_,e,u);for(let d=0;d<h.length;d++)gt(h[d])}else{if(c==="datastale")for(let h=0;h<t.length;h++)t[h].status===3?t[h].status=4:t[h].status=0;else{U("transaction at "+l.toString()+" failed: "+c);for(let h=0;h<t.length;h++)t[h].status=4,t[h].abortReason=c}pt(n,e)}},o)}function pt(n,e){let t=Wc(n,e),i=yn(t),r=jc(n,t);return yp(n,r,i),i}function yp(n,e,t){if(e.length===0)return;let i=[],r=[],o=e.filter(a=>a.status===0).map(a=>a.currentWriteId);for(let a=0;a<e.length;a++){let l=e[a],c=j(t,l.path),u=!1,h;if(f(c!==null,"rerunTransactionsUnderNode_: relativePath should not be null."),l.status===4)u=!0,h=l.abortReason,r=r.concat(ke(n.serverSyncTree_,l.currentWriteId,!0));else if(l.status===0)if(l.retryCount>=sp)u=!0,h="maxretry",r=r.concat(ke(n.serverSyncTree_,l.currentWriteId,!0));else{let d=mo(n,l.path,o);l.currentInputSnapshot=d;let p=e[a].update(d.val());if(p!==void 0){vn("transaction failed: Data returned ",p,l.path);let _=k(p);typeof p=="object"&&p!=null&&ee(p,".priority")||(_=_.updatePriority(d.getPriority()));let A=l.currentWriteId,K=En(n),q=uo(_,d,K);l.currentOutputSnapshotRaw=_,l.currentOutputSnapshotResolved=q,l.currentWriteId=ji(n),o.splice(o.indexOf(A),1),r=r.concat(oo(n.serverSyncTree_,l.path,q,l.currentWriteId,l.applyLocally)),r=r.concat(ke(n.serverSyncTree_,A,!0))}else u=!0,h="nodata",r=r.concat(ke(n.serverSyncTree_,l.currentWriteId,!0))}Q(n.eventQueue_,t,r),r=[],u&&(e[a].status=2,function(d){setTimeout(d,Math.floor(0))}(e[a].unwatcher),e[a].onComplete&&(h==="nodata"?i.push(()=>e[a].onComplete(null,!1,e[a].currentInputSnapshot)):i.push(()=>e[a].onComplete(new Error(h),!1,null))))}Hi(n,n.transactionQueueTree_);for(let a=0;a<i.length;a++)gt(i[a]);Gi(n,n.transactionQueueTree_)}function Wc(n,e){let t,i=n.transactionQueueTree_;for(t=y(e);t!==null&&Ke(i)===void 0;)i=Li(i,t),e=S(e),t=y(e);return i}function jc(n,e){let t=[];return Gc(n,e,t),t.sort((i,r)=>i.order-r.order),t}function Gc(n,e,t){let i=Ke(e);if(i)for(let r=0;r<i.length;r++)t.push(i[r]);Ui(e,r=>{Gc(n,r,t)})}function Hi(n,e){let t=Ke(e);if(t){let i=0;for(let r=0;r<t.length;r++)t[r].status!==2&&(t[i]=t[r],i++);t.length=i,fo(e,t.length>0?t:void 0)}Ui(e,i=>{Hi(n,i)})}function yo(n,e){let t=yn(Wc(n,e)),i=Li(n.transactionQueueTree_,e);return Xf(i,r=>{Br(n,r)}),Br(n,i),Pc(i,r=>{Br(n,r)}),t}function Br(n,e){let t=Ke(e);if(t){let i=[],r=[],s=-1;for(let o=0;o<t.length;o++)t[o].status===3||(t[o].status===1?(f(s===o-1,"All SENT items should be at beginning of queue."),s=o,t[o].status=3,t[o].abortReason="set"):(f(t[o].status===0,"Unexpected transaction status in abort"),t[o].unwatcher(),r=r.concat(ke(n.serverSyncTree_,t[o].currentWriteId,!0)),t[o].onComplete&&i.push(t[o].onComplete.bind(null,new Error("set"),!1,null))));s===-1?fo(e,void 0):t.length=s+1,Q(n.eventQueue_,yn(e),r);for(let o=0;o<i.length;o++)gt(i[o])}}function vp(n){let e="",t=n.split("/");for(let i=0;i<t.length;i++)if(t[i].length>0){let r=t[i];try{r=decodeURIComponent(r.replace(/\+/g," "))}catch{}e+="/"+r}return e}function Cp(n){let e={};n.charAt(0)==="?"&&(n=n.substring(1));for(let t of n.split("&")){if(t.length===0)continue;let i=t.split("=");i.length===2?e[decodeURIComponent(i[0])]=decodeURIComponent(i[1]):U(`Invalid query segment '${t}' in query '${n}'`)}return e}var Ps=function(n,e){let t=Ep(n),i=t.namespace;t.domain==="firebase.com"&&_e(t.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!i||i==="undefined")&&t.domain!=="localhost"&&_e("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),t.secure||Qh();let r=t.scheme==="ws"||t.scheme==="wss";return{repoInfo:new oi(t.host,t.secure,i,r,e,"",i!==t.subdomain),path:new b(t.pathString)}},Ep=function(n){let e="",t="",i="",r="",s="",o=!0,a="https",l=443;if(typeof n=="string"){let c=n.indexOf("//");c>=0&&(a=n.substring(0,c-1),n=n.substring(c+2));let u=n.indexOf("/");u===-1&&(u=n.length);let h=n.indexOf("?");h===-1&&(h=n.length),e=n.substring(0,Math.min(u,h)),u<h&&(r=vp(n.substring(u,h)));let d=Cp(n.substring(Math.min(n.length,h)));c=e.indexOf(":"),c>=0?(o=a==="https"||a==="wss",l=parseInt(e.substring(c+1),10)):c=e.length;let p=e.slice(0,c);if(p.toLowerCase()==="localhost")t="localhost";else if(p.split(".").length<=2)t=p;else{let _=e.indexOf(".");i=e.substring(0,_).toLowerCase(),t=e.substring(_+1),s=i}"ns"in d&&(s=d.ns)}return{host:e,port:l,domain:t,subdomain:i,secure:o,scheme:a,pathString:r,namespace:s}};var Vl="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",wp=function(){let n=0,e=[];return function(t){let i=t===n;n=t;let r,s=new Array(8);for(r=7;r>=0;r--)s[r]=Vl.charAt(t%64),t=Math.floor(t/64);f(t===0,"Cannot push at time == 0");let o=s.join("");if(i){for(r=11;r>=0&&e[r]===63;r--)e[r]=0;e[r]++}else for(r=0;r<12;r++)e[r]=Math.floor(Math.random()*64);for(r=0;r<12;r++)o+=Vl.charAt(e[r]);return f(o.length===20,"nextPushId: Length should be 20."),o}}();var Ai=class{constructor(e,t,i,r){this.eventType=e,this.eventRegistration=t,this.snapshot=i,this.prevName=r}getPath(){let e=this.snapshot.ref;return this.eventType==="value"?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+R(this.snapshot.exportVal())}},Si=class{constructor(e,t,i){this.eventRegistration=e,this.error=t,this.path=i}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}};var dn=class{constructor(e,t){this.snapshotCallback=e,this.cancelCallback=t}onValue(e,t){this.snapshotCallback.call(null,e,t)}onCancel(e){return f(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||this.snapshotCallback.userCallback!==void 0&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}};var Ti=class{constructor(e,t){this._repo=e,this._path=t}cancel(){let e=new M;return hp(this._repo,this._path,e.wrapCallback(()=>{})),e.promise}remove(){Y("OnDisconnect.remove",this._path);let e=new M;return Ol(this._repo,this._path,null,e.wrapCallback(()=>{})),e.promise}set(e){Y("OnDisconnect.set",this._path),me("OnDisconnect.set",e,this._path,!1);let t=new M;return Ol(this._repo,this._path,e,t.wrapCallback(()=>{})),t.promise}setWithPriority(e,t){Y("OnDisconnect.setWithPriority",this._path),me("OnDisconnect.setWithPriority",e,this._path,!1),po("OnDisconnect.setWithPriority",t,!1);let i=new M;return dp(this._repo,this._path,e,t,i.wrapCallback(()=>{})),i.promise}update(e){Y("OnDisconnect.update",this._path),xc("OnDisconnect.update",e,this._path,!1);let t=new M;return fp(this._repo,this._path,e,t.wrapCallback(()=>{})),t.promise}};var H=class n{constructor(e,t,i,r){this._repo=e,this._path=t,this._queryParams=i,this._orderByCalled=r}get key(){return v(this._path)?null:Ys(this._path)}get ref(){return new X(this._repo,this._path)}get _queryIdentifier(){let e=bl(this._queryParams),t=qs(e);return t==="{}"?"default":t}get _queryObject(){return bl(this._queryParams)}isEqual(e){if(e=W(e),!(e instanceof n))return!1;let t=this._repo===e._repo,i=Qs(this._path,e._path),r=this._queryIdentifier===e._queryIdentifier;return t&&i&&r}toJSON(){return this.toString()}toString(){return this._repo.toString()+Dd(this._path)}};function $i(n,e){if(n._orderByCalled===!0)throw new Error(e+": You can't combine multiple orderBy calls.")}function Le(n){let e=null,t=null;if(n.hasStart()&&(e=n.getIndexStartValue()),n.hasEnd()&&(t=n.getIndexEndValue()),n.getIndex()===pe){let i="Query: When ordering by key, you may only pass one argument to startAt(), endAt(), or equalTo().",r="Query: When ordering by key, the argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() must be a string.";if(n.hasStart()){if(n.getIndexStartName()!==Me)throw new Error(i);if(typeof e!="string")throw new Error(r)}if(n.hasEnd()){if(n.getIndexEndName()!==we)throw new Error(i);if(typeof t!="string")throw new Error(r)}}else if(n.getIndex()===T){if(e!=null&&!hn(e)||t!=null&&!hn(t))throw new Error("Query: When ordering by priority, the first argument passed to startAt(), startAfter() endAt(), endBefore(), or equalTo() must be a valid priority value (null, a number, or a string).")}else if(f(n.getIndex()instanceof tn||n.getIndex()===Zs,"unknown index type."),e!=null&&typeof e=="object"||t!=null&&typeof t=="object")throw new Error("Query: First argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() cannot be an object.")}function Ki(n){if(n.hasStart()&&n.hasEnd()&&n.hasLimit()&&!n.hasAnchoredLimit())throw new Error("Query: Can't combine startAt(), startAfter(), endAt(), endBefore(), and limit(). Use limitToFirst() or limitToLast() instead.")}var X=class n extends H{constructor(e,t){super(e,t,new on,!1)}get parent(){let e=oc(this._path);return e===null?null:new n(this._repo,e)}get root(){let e=this;for(;e.parent!==null;)e=e.parent;return e}},_t=class n{constructor(e,t,i){this._node=e,this.ref=t,this._index=i}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){let t=new b(e),i=Ve(this.ref,e);return new n(this._node.getChild(t),i,T)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){return this._node.isLeafNode()?!1:!!this._node.forEachChild(this._index,(i,r)=>e(new n(r,Ve(this.ref,i),T)))}hasChild(e){let t=new b(e);return!this._node.getChild(t).isEmpty()}hasChildren(){return this._node.isLeafNode()?!1:!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}};function vo(n,e){return n=W(n),n._checkNotDeleted("ref"),e!==void 0?Ve(n._root,e):n._root}function Co(n,e){n=W(n),n._checkNotDeleted("refFromURL");let t=Ps(e,n._repo.repoInfo_.nodeAdmin);Fc("refFromURL",t);let i=t.repoInfo;return!n._repo.repoInfo_.isCustomHost()&&i.host!==n._repo.repoInfo_.host&&_e("refFromURL: Host name does not match the current database: (found "+i.host+" but expected "+n._repo.repoInfo_.host+")"),vo(n,t.path.toString())}function Ve(n,e){return n=W(n),y(n._path)===null?ip("child","path",e,!1):vt("child","path",e,!1),new X(n._repo,N(n._path,e))}function Hc(n,e){n=W(n),Y("push",n._path),me("push",e,n._path,!0);let t=Uc(n._repo),i=wp(t),r=Ve(n,i),s=Ve(n,i),o;return e!=null?o=qi(s,e).then(()=>s):o=Promise.resolve(s),r.then=o.then.bind(o),r.catch=o.then.bind(o,void 0),r}function $c(n){return Y("remove",n._path),qi(n,null)}function qi(n,e){n=W(n),Y("set",n._path),me("set",e,n._path,!1);let t=new M;return go(n._repo,n._path,e,null,t.wrapCallback(()=>{})),t.promise}function Kc(n,e){n=W(n),Y("setPriority",n._path),po("setPriority",e,!1);let t=new M;return go(n._repo,N(n._path,".priority"),e,null,t.wrapCallback(()=>{})),t.promise}function qc(n,e,t){if(Y("setWithPriority",n._path),me("setWithPriority",e,n._path,!1),po("setWithPriority",t,!1),n.key===".length"||n.key===".keys")throw"setWithPriority failed: "+n.key+" is a read-only object.";let i=new M;return go(n._repo,n._path,e,t,i.wrapCallback(()=>{})),i.promise}function zc(n,e){xc("update",e,n._path,!1);let t=new M;return cp(n._repo,n._path,e,t.wrapCallback(()=>{})),t.promise}function Yc(n){n=W(n);let e=new dn(()=>{}),t=new fn(e);return lp(n._repo,n,t).then(i=>new _t(i,new X(n._repo,n._path),n._queryParams.getIndex()))}var fn=class n{constructor(e){this.callbackContext=e}respondsTo(e){return e==="value"}createEvent(e,t){let i=t._queryParams.getIndex();return new Ai("value",this,new _t(e.snapshotNode,new X(t._repo,t._path),i))}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new Si(this,e,t):null}matches(e){return e instanceof n?!e.callbackContext||!this.callbackContext?!0:e.callbackContext.matches(this.callbackContext):!1}hasAnyCallback(){return this.callbackContext!==null}},Di=class n{constructor(e,t){this.eventType=e,this.callbackContext=t}respondsTo(e){let t=e==="children_added"?"child_added":e;return t=t==="children_removed"?"child_removed":t,this.eventType===t}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new Si(this,e,t):null}createEvent(e,t){f(e.childName!=null,"Child events should have a childName.");let i=Ve(new X(t._repo,t._path),e.childName),r=t._queryParams.getIndex();return new Ai(e.type,this,new _t(e.snapshotNode,i,r),e.prevName)}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,e.prevName)}matches(e){return e instanceof n?this.eventType===e.eventType&&(!this.callbackContext||!e.callbackContext||this.callbackContext.matches(e.callbackContext)):!1}hasAnyCallback(){return!!this.callbackContext}};function wn(n,e,t,i,r){let s;if(typeof i=="object"&&(s=void 0,r=i),typeof i=="function"&&(s=i),r&&r.onlyOnce){let l=t,c=(u,h)=>{Rs(n._repo,n,a),l(u,h)};c.userCallback=t.userCallback,c.context=t.context,t=c}let o=new dn(t,s||void 0),a=e==="value"?new fn(o):new Di(e,o);return pp(n._repo,n,a),()=>Rs(n._repo,n,a)}function zi(n,e,t,i){return wn(n,"value",e,t,i)}function Eo(n,e,t,i){return wn(n,"child_added",e,t,i)}function wo(n,e,t,i){return wn(n,"child_changed",e,t,i)}function bo(n,e,t,i){return wn(n,"child_moved",e,t,i)}function Io(n,e,t,i){return wn(n,"child_removed",e,t,i)}function Ao(n,e,t){let i=null,r=t?new dn(t):null;e==="value"?i=new fn(r):e&&(i=new Di(e,r)),Rs(n._repo,n,i)}var J=class{},Ni=class extends J{constructor(e,t){super(),this._value=e,this._key=t,this.type="endAt"}_apply(e){me("endAt",this._value,e._path,!0);let t=ls(e._queryParams,this._value,this._key);if(Ki(t),Le(t),e._queryParams.hasEnd())throw new Error("endAt: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new H(e._repo,e._path,t,e._orderByCalled)}};function Qc(n,e){return Cn("endAt","key",e,!0),new Ni(n,e)}var Ms=class extends J{constructor(e,t){super(),this._value=e,this._key=t,this.type="endBefore"}_apply(e){me("endBefore",this._value,e._path,!1);let t=qd(e._queryParams,this._value,this._key);if(Ki(t),Le(t),e._queryParams.hasEnd())throw new Error("endBefore: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new H(e._repo,e._path,t,e._orderByCalled)}};function Xc(n,e){return Cn("endBefore","key",e,!0),new Ms(n,e)}var ki=class extends J{constructor(e,t){super(),this._value=e,this._key=t,this.type="startAt"}_apply(e){me("startAt",this._value,e._path,!0);let t=as(e._queryParams,this._value,this._key);if(Ki(t),Le(t),e._queryParams.hasStart())throw new Error("startAt: Starting point was already set (by another call to startAt, startBefore or equalTo).");return new H(e._repo,e._path,t,e._orderByCalled)}};function Jc(n=null,e){return Cn("startAt","key",e,!0),new ki(n,e)}var xs=class extends J{constructor(e,t){super(),this._value=e,this._key=t,this.type="startAfter"}_apply(e){me("startAfter",this._value,e._path,!1);let t=Kd(e._queryParams,this._value,this._key);if(Ki(t),Le(t),e._queryParams.hasStart())throw new Error("startAfter: Starting point was already set (by another call to startAt, startAfter, or equalTo).");return new H(e._repo,e._path,t,e._orderByCalled)}};function Zc(n,e){return Cn("startAfter","key",e,!0),new xs(n,e)}var Fs=class extends J{constructor(e){super(),this._limit=e,this.type="limitToFirst"}_apply(e){if(e._queryParams.hasLimit())throw new Error("limitToFirst: Limit was already set (by another call to limitToFirst or limitToLast).");return new H(e._repo,e._path,Hd(e._queryParams,this._limit),e._orderByCalled)}};function eu(n){if(typeof n!="number"||Math.floor(n)!==n||n<=0)throw new Error("limitToFirst: First argument must be a positive integer.");return new Fs(n)}var Os=class extends J{constructor(e){super(),this._limit=e,this.type="limitToLast"}_apply(e){if(e._queryParams.hasLimit())throw new Error("limitToLast: Limit was already set (by another call to limitToFirst or limitToLast).");return new H(e._repo,e._path,$d(e._queryParams,this._limit),e._orderByCalled)}};function tu(n){if(typeof n!="number"||Math.floor(n)!==n||n<=0)throw new Error("limitToLast: First argument must be a positive integer.");return new Os(n)}var Vs=class extends J{constructor(e){super(),this._path=e,this.type="orderByChild"}_apply(e){$i(e,"orderByChild");let t=new b(this._path);if(v(t))throw new Error("orderByChild: cannot pass in empty path. Use orderByValue() instead.");let i=new tn(t),r=Pi(e._queryParams,i);return Le(r),new H(e._repo,e._path,r,!0)}};function nu(n){if(n==="$key")throw new Error('orderByChild: "$key" is invalid.  Use orderByKey() instead.');if(n==="$priority")throw new Error('orderByChild: "$priority" is invalid.  Use orderByPriority() instead.');if(n==="$value")throw new Error('orderByChild: "$value" is invalid.  Use orderByValue() instead.');return vt("orderByChild","path",n,!1),new Vs(n)}var Ls=class extends J{constructor(){super(...arguments),this.type="orderByKey"}_apply(e){$i(e,"orderByKey");let t=Pi(e._queryParams,pe);return Le(t),new H(e._repo,e._path,t,!0)}};function iu(){return new Ls}var Us=class extends J{constructor(){super(...arguments),this.type="orderByPriority"}_apply(e){$i(e,"orderByPriority");let t=Pi(e._queryParams,T);return Le(t),new H(e._repo,e._path,t,!0)}};function ru(){return new Us}var Bs=class extends J{constructor(){super(...arguments),this.type="orderByValue"}_apply(e){$i(e,"orderByValue");let t=Pi(e._queryParams,Zs);return Le(t),new H(e._repo,e._path,t,!0)}};function su(){return new Bs}var Ws=class extends J{constructor(e,t){super(),this._value=e,this._key=t,this.type="equalTo"}_apply(e){if(me("equalTo",this._value,e._path,!1),e._queryParams.hasStart())throw new Error("equalTo: Starting point was already set (by another call to startAt/startAfter or equalTo).");if(e._queryParams.hasEnd())throw new Error("equalTo: Ending point was already set (by another call to endAt/endBefore or equalTo).");return new Ni(this._value,this._key)._apply(new ki(this._value,this._key)._apply(e))}};function ou(n,e){return Cn("equalTo","key",e,!0),new Ws(n,e)}function ie(n,...e){let t=W(n);for(let i of e)t=i._apply(t);return t}Nf(X);xf(X);var bp="FIREBASE_DATABASE_EMULATOR_HOST",js={},Ip=!1;function Ap(n,e,t,i){n.repoInfo_=new oi(`${e}:${t}`,!1,n.repoInfo_.namespace,n.repoInfo_.webSocketOnly,n.repoInfo_.nodeAdmin,n.repoInfo_.persistenceKey,n.repoInfo_.includeNamespaceInQueryParams,!0),i&&(n.authTokenProvider_=i)}function So(n,e,t,i,r){let s=i||n.options.databaseURL;s===void 0&&(n.options.projectId||_e("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),x("Using default host for project ",n.options.projectId),s=`${n.options.projectId}-default-rtdb.firebaseio.com`);let o=Ps(s,r),a=o.repoInfo,l,c;typeof process<"u"&&process.env&&(c=process.env[bp]),c?(l=!0,s=`http://${c}?ns=${a.namespace}`,o=Ps(s,r),a=o.repoInfo):l=!o.repoInfo.secure;let u=r&&l?new Yt(Yt.OWNER):new Kr(n.name,n.options,e);Fc("Invalid Firebase Database URL",o),v(o.path)||_e("Database URL must point to the root of a Firebase Database (not including a child path).");let h=Tp(a,n,u,new $r(n.name,t));return new Gs(h,n)}function Sp(n,e){let t=js[e];(!t||t[n.key]!==n)&&_e(`Database ${e}(${n.repoInfo_}) has already been deleted.`),Bc(n),delete t[n.key]}function Tp(n,e,t,i){let r=js[e.name];r||(r={},js[e.name]=r);let s=r[n.toURLString()];return s&&_e("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),s=new ks(n,Ip,t,i),r[n.toURLString()]=s,s}var Gs=class{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(op(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new X(this._repo,w())),this._rootInternal}_delete(){return this._rootInternal!==null&&(Sp(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){this._rootInternal===null&&_e("Cannot call "+e+" on a deleted database.")}};function au(){sc.IS_TRANSPORT_INITIALIZED&&U("Transport has already been initialized. Please call this function before calling ref or setting up a listener")}function lu(){au(),Zt.forceDisallow()}function cu(){au(),st.forceDisallow(),Zt.forceAllow()}function uu(n,e,t,i={}){n=W(n),n._checkNotDeleted("useEmulator"),n._instanceStarted&&_e("Cannot call useEmulator() after instance has already been initialized.");let r=n._repoInternal,s;if(r.repoInfo_.nodeAdmin)i.mockUserToken&&_e('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),s=new Yt(Yt.OWNER);else if(i.mockUserToken){let o=typeof i.mockUserToken=="string"?i.mockUserToken:Jo(i.mockUserToken,n.app.options.projectId);s=new Yt(o)}Ap(r,e,t,s)}function hu(n){n=W(n),n._checkNotDeleted("goOffline"),Bc(n._repo)}function du(n){n=W(n),n._checkNotDeleted("goOnline"),_p(n._repo)}function fu(n,e){Wl(n,e)}function Dp(n){Ks(la),Ft(new Ce("database",(e,{instanceIdentifier:t})=>{let i=e.getProvider("app").getImmediate(),r=e.getProvider("auth-internal"),s=e.getProvider("app-check-internal");return So(i,r,s,t)},"PUBLIC").setMultipleInstances(!0)),Xe(ol,al,n),Xe(ol,al,"esm2017")}var Np={".sv":"timestamp"};function pu(){return Np}function _u(n){return{".sv":{increment:n}}}var Hs=class{constructor(e,t){this.committed=e,this.snapshot=t}toJSON(){return{committed:this.committed,snapshot:this.snapshot.toJSON()}}};function gu(n,e,t){var i;if(n=W(n),Y("Reference.transaction",n._path),n.key===".length"||n.key===".keys")throw"Reference.transaction failed: "+n.key+" is a read-only object.";let r=(i=t?.applyLocally)!==null&&i!==void 0?i:!0,s=new M,o=(l,c,u)=>{let h=null;l?s.reject(l):(h=new _t(u,new X(n._repo,n._path),T),s.resolve(new Hs(c,h)))},a=zi(n,()=>{});return gp(n._repo,n._path,e,o,a,r),s.promise}Xs.prototype.simpleListen=function(n,e){this.sendRequest("q",{p:n},e)};Xs.prototype.echo=function(n,e){this.sendRequest("echo",{d:n},e)};Dp();var kp="@firebase/database-compat",Rp="1.0.8";var Pp=new Qe("@firebase/database-compat"),mu=function(n){let e="FIREBASE WARNING: "+n;Pp.warn(e)};var Mp=function(n,e,t,i){if(!(i&&t===void 0)&&typeof t!="boolean")throw new Error($(n,e)+"must be a boolean.")},xp=function(n,e,t){if(!(t&&e===void 0))switch(e){case"value":case"child_added":case"child_removed":case"child_changed":case"child_moved":break;default:throw new Error($(n,"eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}};var To=class{constructor(e){this._delegate=e}cancel(e){g("OnDisconnect.cancel",0,1,arguments.length),P("OnDisconnect.cancel","onComplete",e,!0);let t=this._delegate.cancel();return e&&t.then(()=>e(null),i=>e(i)),t}remove(e){g("OnDisconnect.remove",0,1,arguments.length),P("OnDisconnect.remove","onComplete",e,!0);let t=this._delegate.remove();return e&&t.then(()=>e(null),i=>e(i)),t}set(e,t){g("OnDisconnect.set",1,2,arguments.length),P("OnDisconnect.set","onComplete",t,!0);let i=this._delegate.set(e);return t&&i.then(()=>t(null),r=>t(r)),i}setWithPriority(e,t,i){g("OnDisconnect.setWithPriority",2,3,arguments.length),P("OnDisconnect.setWithPriority","onComplete",i,!0);let r=this._delegate.setWithPriority(e,t);return i&&r.then(()=>i(null),s=>i(s)),r}update(e,t){if(g("OnDisconnect.update",1,2,arguments.length),Array.isArray(e)){let r={};for(let s=0;s<e.length;++s)r[""+s]=e[s];e=r,mu("Passing an Array to firebase.database.onDisconnect().update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}P("OnDisconnect.update","onComplete",t,!0);let i=this._delegate.update(e);return t&&i.then(()=>t(null),r=>t(r)),i}};var Do=class{constructor(e,t){this.committed=e,this.snapshot=t}toJSON(){return g("TransactionResult.toJSON",0,1,arguments.length),{committed:this.committed,snapshot:this.snapshot.toJSON()}}};var qe=class n{constructor(e,t){this._database=e,this._delegate=t}val(){return g("DataSnapshot.val",0,0,arguments.length),this._delegate.val()}exportVal(){return g("DataSnapshot.exportVal",0,0,arguments.length),this._delegate.exportVal()}toJSON(){return g("DataSnapshot.toJSON",0,1,arguments.length),this._delegate.toJSON()}exists(){return g("DataSnapshot.exists",0,0,arguments.length),this._delegate.exists()}child(e){return g("DataSnapshot.child",0,1,arguments.length),e=String(e),vt("DataSnapshot.child","path",e,!1),new n(this._database,this._delegate.child(e))}hasChild(e){return g("DataSnapshot.hasChild",1,1,arguments.length),vt("DataSnapshot.hasChild","path",e,!1),this._delegate.hasChild(e)}getPriority(){return g("DataSnapshot.getPriority",0,0,arguments.length),this._delegate.priority}forEach(e){return g("DataSnapshot.forEach",1,1,arguments.length),P("DataSnapshot.forEach","action",e,!1),this._delegate.forEach(t=>e(new n(this._database,t)))}hasChildren(){return g("DataSnapshot.hasChildren",0,0,arguments.length),this._delegate.hasChildren()}get key(){return this._delegate.key}numChildren(){return g("DataSnapshot.numChildren",0,0,arguments.length),this._delegate.size}getRef(){return g("DataSnapshot.ref",0,0,arguments.length),new be(this._database,this._delegate.ref)}get ref(){return this.getRef()}},Yi=class n{constructor(e,t){this.database=e,this._delegate=t}on(e,t,i,r){var s;g("Query.on",2,4,arguments.length),P("Query.on","callback",t,!1);let o=n.getCancelAndContextArgs_("Query.on",i,r),a=(c,u)=>{t.call(o.context,new qe(this.database,c),u)};a.userCallback=t,a.context=o.context;let l=(s=o.cancel)===null||s===void 0?void 0:s.bind(o.context);switch(e){case"value":return zi(this._delegate,a,l),t;case"child_added":return Eo(this._delegate,a,l),t;case"child_removed":return Io(this._delegate,a,l),t;case"child_changed":return wo(this._delegate,a,l),t;case"child_moved":return bo(this._delegate,a,l),t;default:throw new Error($("Query.on","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}}off(e,t,i){if(g("Query.off",0,3,arguments.length),xp("Query.off",e,!0),P("Query.off","callback",t,!0),sr("Query.off","context",i,!0),t){let r=()=>{};r.userCallback=t,r.context=i,Ao(this._delegate,e,r)}else Ao(this._delegate,e)}get(){return Yc(this._delegate).then(e=>new qe(this.database,e))}once(e,t,i,r){g("Query.once",1,4,arguments.length),P("Query.once","callback",t,!0);let s=n.getCancelAndContextArgs_("Query.once",i,r),o=new M,a=(c,u)=>{let h=new qe(this.database,c);t&&t.call(s.context,h,u),o.resolve(h)};a.userCallback=t,a.context=s.context;let l=c=>{s.cancel&&s.cancel.call(s.context,c),o.reject(c)};switch(e){case"value":zi(this._delegate,a,l,{onlyOnce:!0});break;case"child_added":Eo(this._delegate,a,l,{onlyOnce:!0});break;case"child_removed":Io(this._delegate,a,l,{onlyOnce:!0});break;case"child_changed":wo(this._delegate,a,l,{onlyOnce:!0});break;case"child_moved":bo(this._delegate,a,l,{onlyOnce:!0});break;default:throw new Error($("Query.once","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}return o.promise}limitToFirst(e){return g("Query.limitToFirst",1,1,arguments.length),new n(this.database,ie(this._delegate,eu(e)))}limitToLast(e){return g("Query.limitToLast",1,1,arguments.length),new n(this.database,ie(this._delegate,tu(e)))}orderByChild(e){return g("Query.orderByChild",1,1,arguments.length),new n(this.database,ie(this._delegate,nu(e)))}orderByKey(){return g("Query.orderByKey",0,0,arguments.length),new n(this.database,ie(this._delegate,iu()))}orderByPriority(){return g("Query.orderByPriority",0,0,arguments.length),new n(this.database,ie(this._delegate,ru()))}orderByValue(){return g("Query.orderByValue",0,0,arguments.length),new n(this.database,ie(this._delegate,su()))}startAt(e=null,t){return g("Query.startAt",0,2,arguments.length),new n(this.database,ie(this._delegate,Jc(e,t)))}startAfter(e=null,t){return g("Query.startAfter",0,2,arguments.length),new n(this.database,ie(this._delegate,Zc(e,t)))}endAt(e=null,t){return g("Query.endAt",0,2,arguments.length),new n(this.database,ie(this._delegate,Qc(e,t)))}endBefore(e=null,t){return g("Query.endBefore",0,2,arguments.length),new n(this.database,ie(this._delegate,Xc(e,t)))}equalTo(e,t){return g("Query.equalTo",1,2,arguments.length),new n(this.database,ie(this._delegate,ou(e,t)))}toString(){return g("Query.toString",0,0,arguments.length),this._delegate.toString()}toJSON(){return g("Query.toJSON",0,1,arguments.length),this._delegate.toJSON()}isEqual(e){if(g("Query.isEqual",1,1,arguments.length),!(e instanceof n)){let t="Query.isEqual failed: First argument must be an instance of firebase.database.Query.";throw new Error(t)}return this._delegate.isEqual(e._delegate)}static getCancelAndContextArgs_(e,t,i){let r={cancel:void 0,context:void 0};if(t&&i)r.cancel=t,P(e,"cancel",r.cancel,!0),r.context=i,sr(e,"context",r.context,!0);else if(t)if(typeof t=="object"&&t!==null)r.context=t;else if(typeof t=="function")r.cancel=t;else throw new Error($(e,"cancelOrContext")+" must either be a cancel callback or a context object.");return r}get ref(){return new be(this.database,new X(this._delegate._repo,this._delegate._path))}},be=class n extends Yi{constructor(e,t){super(e,new H(t._repo,t._path,new on,!1)),this.database=e,this._delegate=t}getKey(){return g("Reference.key",0,0,arguments.length),this._delegate.key}child(e){return g("Reference.child",1,1,arguments.length),typeof e=="number"&&(e=String(e)),new n(this.database,Ve(this._delegate,e))}getParent(){g("Reference.parent",0,0,arguments.length);let e=this._delegate.parent;return e?new n(this.database,e):null}getRoot(){return g("Reference.root",0,0,arguments.length),new n(this.database,this._delegate.root)}set(e,t){g("Reference.set",1,2,arguments.length),P("Reference.set","onComplete",t,!0);let i=qi(this._delegate,e);return t&&i.then(()=>t(null),r=>t(r)),i}update(e,t){if(g("Reference.update",1,2,arguments.length),Array.isArray(e)){let r={};for(let s=0;s<e.length;++s)r[""+s]=e[s];e=r,mu("Passing an Array to Firebase.update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}Y("Reference.update",this._delegate._path),P("Reference.update","onComplete",t,!0);let i=zc(this._delegate,e);return t&&i.then(()=>t(null),r=>t(r)),i}setWithPriority(e,t,i){g("Reference.setWithPriority",2,3,arguments.length),P("Reference.setWithPriority","onComplete",i,!0);let r=qc(this._delegate,e,t);return i&&r.then(()=>i(null),s=>i(s)),r}remove(e){g("Reference.remove",0,1,arguments.length),P("Reference.remove","onComplete",e,!0);let t=$c(this._delegate);return e&&t.then(()=>e(null),i=>e(i)),t}transaction(e,t,i){g("Reference.transaction",1,3,arguments.length),P("Reference.transaction","transactionUpdate",e,!1),P("Reference.transaction","onComplete",t,!0),Mp("Reference.transaction","applyLocally",i,!0);let r=gu(this._delegate,e,{applyLocally:i}).then(s=>new Do(s.committed,new qe(this.database,s.snapshot)));return t&&r.then(s=>t(null,s.committed,s.snapshot),s=>t(s,!1,null)),r}setPriority(e,t){g("Reference.setPriority",1,2,arguments.length),P("Reference.setPriority","onComplete",t,!0);let i=Kc(this._delegate,e);return t&&i.then(()=>t(null),r=>t(r)),i}push(e,t){g("Reference.push",0,2,arguments.length),P("Reference.push","onComplete",t,!0);let i=Hc(this._delegate,e),r=i.then(o=>new n(this.database,o));t&&r.then(()=>t(null),o=>t(o));let s=new n(this.database,i);return s.then=r.then.bind(r),s.catch=r.catch.bind(r,void 0),s}onDisconnect(){return Y("Reference.onDisconnect",this._delegate._path),new To(new Ti(this._delegate._repo,this._delegate._path))}get key(){return this.getKey()}get parent(){return this.getParent()}get root(){return this.getRoot()}};var ze=class{constructor(e,t){this._delegate=e,this.app=t,this.INTERNAL={delete:()=>this._delegate._delete(),forceWebSockets:lu,forceLongPolling:cu}}useEmulator(e,t,i={}){uu(this._delegate,e,t,i)}ref(e){if(g("database.ref",0,1,arguments.length),e instanceof be){let t=Co(this._delegate,e.toString());return new be(this,t)}else{let t=vo(this._delegate,e);return new be(this,t)}}refFromURL(e){g("database.refFromURL",1,1,arguments.length);let i=Co(this._delegate,e);return new be(this,i)}goOffline(){return g("database.goOffline",0,0,arguments.length),hu(this._delegate)}goOnline(){return g("database.goOnline",0,0,arguments.length),du(this._delegate)}};ze.ServerValue={TIMESTAMP:pu(),increment:n=>_u(n)};function Fp({app:n,url:e,version:t,customAuthImpl:i,customAppCheckImpl:r,namespace:s,nodeAdmin:o=!1}){Ks(t);let a=new or("database-standalone"),l=new xn("auth-internal",a);l.setComponent(new Ce("auth-internal",()=>i,"PRIVATE"));let c;return r&&(c=new xn("app-check-internal",a),c.setComponent(new Ce("app-check-internal",()=>r,"PRIVATE"))),{instance:new ze(So(n,l,c,e,o),n),namespace:s}}var Op=Object.freeze({__proto__:null,initStandalone:Fp});var Vp=ze.ServerValue;function Lp(n){n.INTERNAL.registerComponent(new Ce("database-compat",(e,{instanceIdentifier:t})=>{let i=e.getProvider("app-compat").getImmediate(),r=e.getProvider("database").getImmediate({identifier:t});return new ze(r,i)},"PUBLIC").setServiceProps({Reference:be,Query:Yi,Database:ze,DataSnapshot:qe,enableLogging:fu,INTERNAL:Op,ServerValue:Vp}).setMultipleInstances(!0)),n.registerVersion(kp,Rp)}Lp(On);function bn(n,e,t="on",i=No){return new Et(r=>{let s=null;return s=n[t](e,(o,a)=>{i.schedule(()=>{r.next({snapshot:o,prevKey:a})}),t==="once"&&i.schedule(()=>r.complete())},o=>{i.schedule(()=>r.error(o))}),t==="on"?{unsubscribe(){s!=null&&n.off(e,s)}}:{unsubscribe(){}}}).pipe(O(r=>{let{snapshot:s,prevKey:o}=r,a=null;return s.exists()&&(a=s.key),{type:e,payload:s,prevKey:o,key:a}}),Oo())}function Up(n){return typeof n=="string"}function Bp(n){return typeof n.exportVal=="function"}function wu(n){return n==null}function bu(n){return typeof n.set=="function"}function yu(n,e){return bu(e)?e:n.ref(e)}function Iu(n,e){if(Up(n))return e.stringCase();if(bu(n))return e.firebaseCase();if(Bp(n))return e.snapshotCase();throw new Error(`Expects a string, snapshot, or reference. Got: ${typeof n}`)}function Au(n){return(wu(n)||n.length===0)&&(n=["child_added","child_removed","child_changed","child_moved"]),n}function Su(n,e,t){e=Au(e);let i=e.map(r=>bn(n,r,"on",t));return bt(...i)}function Wp(n,e,t){let i=Su(n,e).pipe(Qi((r,s)=>[...r,s],[]));return Gp(n,i,t)}function jp(n,e){return bn(n,"value","on",e).pipe(O(t=>{let i;return t.payload.forEach(r=>(i=r.key,!1)),{data:t,lastKeyToLoad:i}}))}function Gp(n,e,t){return jp(n,t).pipe(Uo(e),O(([r,s])=>{let o=r.lastKeyToLoad,a=s.map(l=>l.key);return{actions:s,lastKeyToLoad:o,loadedKeys:a}}),Vo(r=>r.loadedKeys.indexOf(r.lastKeyToLoad)===-1),O(r=>r.actions))}function vu(n,e){return function(i,r){return Iu(i,{stringCase:()=>n.child(i)[e](r),firebaseCase:()=>i[e](r),snapshotCase:()=>i.ref[e](r)})}}function Hp(n){return function(t){return t?Iu(t,{stringCase:()=>n.child(t).remove(),firebaseCase:()=>t.remove(),snapshotCase:()=>t.ref.remove()}):n.remove()}}function $p(n,e,t){return bn(n,"value","once",t).pipe(se(i=>{let r=[ye(i)];return e.forEach(s=>r.push(bn(n,s,"on",t))),bt(...r).pipe(Qi(qp,[]))}),xo())}function Tu(n,e){let t=n.length;for(let i=0;i<t;i++)if(n[i].payload.key===e)return i;return-1}function Kp(n,e){if(wu(e))return 0;{let t=Tu(n,e);return t===-1?n.length:t+1}}function qp(n,e){let{payload:t,prevKey:i,key:r}=e,s=Tu(n,r),o=Kp(n,i);switch(e.type){case"value":if(e.payload?.exists()){let a=null;e.payload.forEach(l=>{let c={payload:l,type:"value",prevKey:a,key:l.key};return a=l.key,n=[...n,c],!1})}return n;case"child_added":if(s>-1)(n[s-1]?.key||null)!==i&&(n=n.filter(l=>l.payload.key!==t.key),n.splice(o,0,e));else{if(i==null)return[e,...n];n=n.slice(),n.splice(o,0,e)}return n;case"child_removed":return n.filter(a=>a.payload.key!==t.key);case"child_changed":return n.map(a=>a.payload.key===r?e:a);case"child_moved":if(s>-1){let a=n.splice(s,1)[0];return n=n.slice(),n.splice(o,0,a),n}return n;default:return n}}function Cu(n,e,t){return e=Au(e),$p(n,e,t)}function zp(n,e){let t=e.schedulers.outsideAngular,i=e.schedulers.ngZone.run(()=>n.ref);return{query:n,update:vu(i,"update"),set:vu(i,"set"),push:r=>i.push(r),remove:Hp(i),snapshotChanges(r){return Cu(n,r,t).pipe(Ee)},stateChanges(r){return Su(n,r,t).pipe(Ee)},auditTrail(r){return Wp(n,r,t).pipe(Ee)},valueChanges(r,s){return Cu(n,r,t).pipe(O(a=>a.map(l=>s&&s.idField?z(B({},l.payload.val()),{[s.idField]:l.key}):l.payload.val())),Ee)}}}function Eu(n,e){return function(){return bn(n,"value","on",e)}}function Yp(n,e){return{query:n,snapshotChanges(){return Eu(n,e.schedulers.outsideAngular)().pipe(Ee)},update(t){return n.ref.update(t)},set(t){return n.ref.set(t)},remove(){return n.ref.remove()},valueChanges(){return Eu(n,e.schedulers.outsideAngular)().pipe(Ee,O(i=>i.payload.exists()?i.payload.val():null))}}}var Qp=new V("angularfire2.realtimeDatabaseURL"),Xp=new V("angularfire2.database.use-emulator"),Du=(()=>{class n{schedulers;database;constructor(t,i,r,s,o,a,l,c,u,h,d,p,_,E,A){this.schedulers=a;let K=l,q=Un(t,o,i);c&&Mr(q,o,u,d,p,_,h,E),this.database=Bn(`${q.name}.database.${r}`,"AngularFireDatabase",q.name,()=>{let D=o.runOutsideAngular(()=>q.database(r||void 0));return K&&D.useEmulator(...K),D},[K])}list(t,i){let r=this.schedulers.ngZone.runOutsideAngular(()=>yu(this.database,t)),s=r;return i&&(s=i(r)),zp(s,this)}object(t){let i=this.schedulers.ngZone.runOutsideAngular(()=>yu(this.database,t));return Yp(i,this)}createPushId(){return this.schedulers.ngZone.runOutsideAngular(()=>this.database.ref()).push().key}static \u0275fac=function(i){return new(i||n)(I(Vn),I(Ln,8),I(Qp,8),I(Nn),I(Dn),I(Fn),I(Xp,8),I(sl,8),I(Tr,8),I(Dr,8),I(Nr,8),I(kr,8),I(Rr,8),I(Pr,8),I(Ot,8))};static \u0275prov=Z({token:n,factory:n.\u0275fac,providedIn:"any"})}return n})();var Nu=class n{db=ve(Du);playerService=ve(Ze);create(){let e=this.playerService.get();if(e){let t={createByPlayer:e.id,players:{},displayEstimates:!1},i=ni();return he(this.db.list("rooms").set(i,t)).pipe(Lo(()=>{e.roomId=i,this.playerService.update(e)}),O(()=>i))}return ko(()=>new Error("player was not registered"))}getById(e){return he(this.db.database.ref(`rooms/${e}`).get())}addPlayer(e){let t=this.playerService.get();t&&this.db.list(`rooms/${e}/players`).set(t.id,{name:t.name,card:null})}leave(e){let t=this.playerService.get();t&&this.db.object(`rooms/${e}/players/${t.id}`).remove()}getRoom(e){return this.db.object(`rooms/${e}`).valueChanges()}getPlayers(e){return this.db.list(`rooms/${e}/players`).valueChanges()}updateDisplayEstimated(e,t){this.db.object(`rooms/${e}`).update({displayEstimates:t})}updateEstimate(e,t){let i=this.playerService.get();i&&this.db.object(`rooms/${e}/players/${i.id}`).update({estimated:t})}deleteEstimates(e){return he(this.db.database.ref(`rooms/${e}/players`).get()).pipe(O(i=>i.val()),se(i=>{let r=Object.entries(i).map(([s])=>s?this.db.object(`rooms/${e}/players/${s}`).update({estimated:null}):Promise.resolve());return he(Promise.all(r))}),O(()=>{}),Mo(i=>{throw i}))}getEstimatedByPlayer(e){let t=this.playerService.get();return t?this.db.object(`rooms/${e}/players/${t.id}`).valueChanges():ye()}static \u0275fac=function(t){return new(t||n)};static \u0275prov=Z({token:n,factory:n.\u0275fac,providedIn:"root"})};export{Zn as a,Hn as b,xa as c,Fa as d,Ba as e,mr as f,yr as g,vr as h,ja as i,Ga as j,Ze as k,Ka as l,Nu as m};
